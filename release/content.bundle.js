(function(){if(window.apiTesterContentScript)return;window.apiTesterContentScript=!0,console.log("API Tester content script loaded on:",window.location.href);const p={interceptFetch:!0,interceptXHR:!0,logRequests:!0,autoCapture:!1},m=window.fetch,w=XMLHttpRequest.prototype.open,g=XMLHttpRequest.prototype.send;let c=0,a=new Map;function h(){y(),T(),P(),b()}function y(){const e=document.createElement("script");e.src=chrome.runtime.getURL("injected.js"),e.onload=function(){e.remove()},(document.head||document.documentElement).appendChild(e)}function T(){window.addEventListener("message",function(e){e.source===window&&(e.data.type==="API_TESTER_REQUEST"?u(e.data.payload):e.data.type==="API_TESTER_RESPONSE"&&d(e.data.payload))},!1),chrome.runtime.onMessage.addListener((e,t,n)=>{switch(e.action){case"getPageRequests":n({requests:Array.from(a.values()),url:window.location.href});break;case"clearPageRequests":a.clear(),n({success:!0});break;case"injectTestRequest":v(e.request),n({success:!0});break;case"enableAutoCapture":p.autoCapture=e.enabled,S(),n({success:!0});break;default:n({error:"Unknown action"})}return!0})}function u(e){const t={id:++c,timestamp:Date.now(),url:e.url,method:e.method,headers:e.headers,body:e.body,initiator:e.initiator||"unknown",status:"pending"};a.set(t.id,t),chrome.runtime.sendMessage({action:"pageRequestDetected",request:t,pageUrl:window.location.href}),console.log("API Tester: Request detected",t)}function d(e){const t=a.get(e.requestId);t&&(t.status=e.status,t.statusText=e.statusText,t.responseHeaders=e.headers,t.responseBody=e.body,t.duration=Date.now()-t.timestamp,t.size=e.size,a.set(t.id,t),chrome.runtime.sendMessage({action:"pageResponseDetected",request:t,pageUrl:window.location.href}),console.log("API Tester: Response detected",t))}function b(){window.fetch=function(...e){const t=Date.now(),n=R(e);return m.apply(this,e).then(o=>{const r={...n,status:o.status,statusText:o.statusText,headers:E(o.headers),duration:Date.now()-t};return x(r,o.clone()),o}).catch(o=>{const r={...n,error:o.message,duration:Date.now()-t};throw A(r),o})},XMLHttpRequest.prototype.open=function(e,t,n=!0,s,o){return this._apiTesterInfo={requestId:++c,method:e,url:t,startTime:Date.now(),headers:{},body:null},w.call(this,e,t,n,s,o)},XMLHttpRequest.prototype.send=function(e){return this._apiTesterInfo&&(this._apiTesterInfo.body=e,this.addEventListener("loadend",function(){if(!this._apiTesterInfo)return;const t={...this._apiTesterInfo,status:this.status,statusText:this.statusText,responseHeaders:I(this.getAllResponseHeaders()),responseBody:this.responseText,duration:Date.now()-this._apiTesterInfo.startTime};C(t)})),g.call(this,e)}}function R(e){const[t,n={}]=e,s=typeof t=="string"?t:t instanceof URL?t.href:t instanceof Request?t.url:"",o=n.method||"GET",r=q(n.headers),i=n.body;return{url:s,method:o.toUpperCase(),headers:r,body:i,initiator:"fetch"}}function q(e){if(!e)return{};if(e instanceof Headers){const t={};for(const[n,s]of e.entries())t[n]=s;return t}if(Array.isArray(e)){const t={};for(const[n,s]of e)t[n]=s;return t}return e||{}}function E(e){const t={};if(e instanceof Headers)for(const[n,s]of e.entries())t[n]=s;return t}function I(e){const t={};return e&&e.split(`\r
`).forEach(n=>{const s=n.split(": ");s.length===2&&(t[s[0]]=s[1])}),t}function x(e,t){t.text().then(n=>{const s={...e,responseBody:n,size:new Blob([n]).size};d({requestId:c,...s})}).catch(n=>{console.warn("Failed to read response body:",n),d({requestId:c,...e})}),u(e)}function A(e){u({...e,error:e.error})}function C(e){u(e),d({requestId:c,...e})}function P(){new MutationObserver(function(t){t.forEach(function(n){n.type==="childList"&&n.addedNodes.forEach(function(s){s.nodeType===Node.ELEMENT_NODE&&l(s)})})}).observe(document.body,{childList:!0,subtree:!0}),l(document.body)}function l(e){if(!e.querySelectorAll)return;const t=e.querySelectorAll('a[href*="api"], a[href*="/v1/"], a[href*="/v2/"], a[href*=".json"]'),n=[];t.forEach(o=>{var i;const r=o.href;r&&(r.includes("api")||r.includes("/v")||r.endsWith(".json"))&&n.push({url:r,text:((i=o.textContent)==null?void 0:i.trim())||"",context:"link"})}),e.querySelectorAll("script").forEach(o=>{o.textContent&&L(o.textContent).forEach(i=>{n.push({url:i,context:"script",text:"Found in script"})})}),n.length>0&&chrome.runtime.sendMessage({action:"endpointsDetected",endpoints:n,pageUrl:window.location.href})}function L(e){const t=[/https?:\/\/[^\s"']+\/api\/[^\s"']*/g,/https?:\/\/api\.[^\s"']+/g,/\/api\/[^\s"']*/g,/\/v\d+\/[^\s"']*/g],n=[];return t.forEach(s=>{const o=e.match(s);o&&n.push(...o)}),[...new Set(n)]}function v(e){const t=document.createElement("script");t.textContent=`
          (function() {
              const request = ${JSON.stringify(e)};
              
              fetch(request.url, {
                  method: request.method,
                  headers: request.headers,
                  body: request.body
              }).then(response => {
                  console.log('API Tester: Test request completed', response);
                  return response.text();
              }).then(text => {
                  console.log('API Tester: Response body', text);
              }).catch(error => {
                  console.error('API Tester: Test request failed', error);
              });
          })();
      `,document.head.appendChild(t),t.remove()}function S(){window.postMessage({type:"API_TESTER_CONFIG",payload:p},"*")}function k(){var s;const e=["graphql","apollo","relay","__schema","query","mutation","subscription"],t=((s=document.documentElement.textContent)==null?void 0:s.toLowerCase())||"",n=Array.from(document.querySelectorAll("script")).map(o=>o.src).join(" ");return e.some(o=>t.includes(o)||n.includes(o))}let f=window.location.href;function M(){new MutationObserver(function(){window.location.href!==f&&(f=window.location.href,chrome.runtime.sendMessage({action:"routeChanged",newUrl:f,timestamp:Date.now()}),setTimeout(()=>{l(document.body)},1e3))}).observe(document,{subtree:!0,childList:!0})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",h):h(),M();function H(){const e={framework:U(),hasGraphQL:k(),hasRestAPI:_(),hasWebSocket:F()};chrome.runtime.sendMessage({action:"pageTechnologyDetected",technologies:e,pageUrl:window.location.href})}function U(){return window.React?"React":window.Vue?"Vue":window.angular?"Angular":window.jQuery?"jQuery":"Unknown"}function _(){var t;const e=((t=document.documentElement.textContent)==null?void 0:t.toLowerCase())||"";return e.includes("rest")||e.includes("api")}function F(){var e;return"WebSocket"in window&&(((e=document.documentElement.textContent)==null?void 0:e.toLowerCase().includes("websocket"))||!1)}setTimeout(H,2e3),console.log("API Tester content script initialized")})();
