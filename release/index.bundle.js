const pn={apiUrl:{value:"https://reply.tukutano.jp",description:"基本となる API の URL"},baseUrl:{value:"https://reply.tukutano.jp",description:"基本となる API の URL"},timeout:{value:"30000",description:"タイムアウト（ミリ秒）"}},mn=[{id:"env_dev",name:"Development",created:new Date().toISOString(),variables:{}},{id:"env_prod",name:"Production",created:new Date().toISOString(),variables:{}}],ct={env_dev:{devToken:{value:"dev-abcdef12345",description:"開発用トークン"}},env_prod:{prodToken:{value:"prod-xyz987654",description:"本番用トークン"}}},yn=[{id:"col_sample",name:"Sample Collection",description:"サンプル用コレクション",requests:[{id:"req1",name:"POST Users",method:"POST",url:"{{apiUrl}}/api/auth/login",headers:{Accept:"application/json",removeHeader:"removeHeaderValue"},params:{page:"1"},body:JSON.stringify({username:"tomaru",password:""}),auth:{type:"bearer",token:"{{devToken}}"},folder:"",description:"ユーザー一覧を取得する",bodyType:"none",preRequestScript:`
// リクエスト/レスポンス実行結果の参照例
// リクエストのヘッダーを参照
addHeaderWithVar Authorization \${"collections"."Sample Collection"."POST Users"."request"."headers"."authorization"}

// レスポンスのステータスコードを参照
setVarFromHeader statusCode \${"collections"."Sample Collection"."POST Users"."response"."status"}

// レスポンスのボディから値を取得
setBodyWithVar \${"collections"."Sample Collection"."POST Users"."response"."body"."token"}

// 既存のプリリクエストスクリプト
setUrl https://reply.tukutano.jp/items?page=9
addHeader test scriptadd
removeHeader removeHeader
setBody setBodyWithScript
//setUrlWithVar apiBaseUrl
//addHeaderWithVar Authorization authtoken
//setBodyWithVar requestPayload
  `},{id:"req_sample_post_1",name:"サンプル POST 1",method:"POST",url:"https://reply.tukutano.jp/items?page=1",headers:{"Content-Type":"application/json",Cookie:"sessionId=abc123def456; userId=12345; theme=dark; language=ja"},params:{},body:"test body text",auth:{type:"none"},bodyType:"raw",preRequestScript:`
// リクエスト/レスポンス実行結果の参照例
// 前のリクエストのレスポンスから値を取得して使用

// 既存のプリリクエストスクリプト
setUrl https://reply.tukutano.jp/items?page=9
addHeader test scriptadd
addHeader authorization scriptadd-authorization11
removeHeader removeHeader
setBody setBodyWithScript2
//setUrlWithVar apiBaseUrl
//addHeaderWithVar Authorization authtoken
//setBodyWithVar requestPayload
  `},{id:"req_sample_post_2",name:"サンプル POST 2",method:"POST",url:"https://reply.tukutano.jp/items?page=2",headers:{"Content-Type":"application/json",Cookie:'authToken=xyz789ghi012; csrfToken=csrf_abc123; preferences={"notifications":true}'},params:{},body:"test body text",auth:{type:"none"},bodyType:"raw",preRequestScript:`
// リクエスト/レスポンス実行結果の参照例
// 前のリクエストのレスポンスから値を取得して使用
addHeaderWithVar Authorization \${"collections"."Sample Collection"."サンプル POST 1"."response"."headers"."authorization"}
setBodyWithVar \${"collections"."Sample Collection"."サンプル POST 1"."response"."body".jsonPath("$.headers.authorization")}

// 既存のプリリクエストスクリプト
setUrl https://reply.tukutano.jp/items?page=9
addHeader test scriptadd
removeHeader removeHeader
//setBody setBodyWithScript2
//setUrlWithVar apiBaseUrl
//addHeaderWithVar Authorization authtoken
//setBodyWithVar requestPayload
  `}]},{id:"col_integration_tests",name:"Integration Tests (Echo API)",description:"reply.tukutano.jpを使用した結合テスト用コレクション",requests:[{id:"req_echo_get",name:"GET Echo Test",method:"GET",url:"https://reply.tukutano.jp/api/users",headers:{Accept:"application/json","X-Test-Header":"test-value","User-Agent":"API-Tester"},params:{page:"1",limit:"10"},body:null,auth:{type:"none"},bodyType:"none",preRequestScript:"",testScript:`// Postman形式のテストスクリプト例
pm.test("Status code is 200", function () {
    pm.response.to.have.status(200);
});

pm.test("Response contains request echo", function () {
    const responseJson = pm.response.json();
    pm.expect(responseJson.method).to.equal("GET");
    pm.expect(responseJson.url).to.include("/api/users");
});

pm.test("Headers are echoed correctly", function () {
    const responseJson = pm.response.json();
    pm.expect(responseJson.headers['accept']).to.equal('application/json');
    pm.expect(responseJson.headers['x-test-header']).to.equal('test-value');
});

pm.test("Query parameters are included", function () {
    const responseJson = pm.response.json();
    pm.expect(responseJson.url).to.include("page=1");
    pm.expect(responseJson.url).to.include("limit=10");
});`},{id:"req_echo_post",name:"POST Echo Test",method:"POST",url:"https://reply.tukutano.jp/api/auth/login",headers:{"Content-Type":"application/json",Accept:"application/json","X-API-Key":"test-api-key",Cookie:"loginSession=sess_abc123xyz; rememberMe=true; lastActivity=1640995200"},params:{},body:JSON.stringify({username:"testuser",password:"testpass123",remember:!0}),auth:{type:"none"},bodyType:"json",preRequestScript:"",testScript:`// POSTリクエストのPostman形式テスト
pm.test("Status code is 200", function () {
    pm.response.to.have.status(200);
});

pm.test("Request method and URL are correct", function () {
    const responseJson = pm.response.json();
    pm.expect(responseJson.method).to.equal("POST");
    pm.expect(responseJson.url).to.include("/api/auth/login");
});

pm.test("Request headers are correct", function () {
    const responseJson = pm.response.json();
    pm.expect(responseJson.headers['content-type']).to.equal('application/json');
    pm.expect(responseJson.headers['x-api-key']).to.equal('test-api-key');
});

pm.test("Request body is correct", function () {
    const responseJson = pm.response.json();
    const requestBody = JSON.parse(responseJson.body);
    pm.expect(requestBody.username).to.equal("testuser");
    pm.expect(requestBody.password).to.equal("testpass123");
    pm.expect(requestBody.remember).to.be.true;
});

pm.test("Save auth token for next request", function () {
    // エコーAPIのため実際のトークンは返されないが、テスト例として
    pm.environment.set("authToken", "mock-token-from-login");
});`},{id:"req_echo_auth_test",name:"Bearer Auth Echo Test",method:"PUT",url:"https://reply.tukutano.jp/api/users/123",headers:{"Content-Type":"application/json",Accept:"application/json",Cookie:"userToken=bearer_token_sample; sessionTimeout=3600; secureFlag=true"},params:{},body:JSON.stringify({name:"Updated User",email:"updated@example.com"}),auth:{type:"bearer",token:"test-bearer-token-12345"},bodyType:"json",preRequestScript:"",testScript:`// Bearer認証付きリクエストの結合テスト
status 200
echoRequestMethodEquals PUT
echoRequestHeaderEquals Authorization Bearer test-bearer-token-12345
echoRequestHeaderEquals Content-Type application/json
echoRequestHeaderContains cookie userToken=bearer_token_sample; sessionTimeout=3600; secureFlag=true
echoRequestBodyEquals {"name":"Updated User","email":"updated@example.com"}
echoRequestUrlContains /api/users/123`}]}],fn={col_sample:{basePath:{value:"/v1",description:"エンドポイントのバージョン"},userId:{value:"123",description:"サンプルユーザーID"}}},hn=`
// ステータスコードが 200 かをチェック
//status 200
// Authorization ヘッダーの値を取得して、環境変数 authToken に保存
//setVarFromHeader authToken Authorization
// ボディの JSON に users プロパティがあるかをチェック
// jsonHasProperty users
// jsonArrayLengthEquals users 5
// jsonValueEquals data.id 1234
// bodyContains success
// headerExists Content - Type
                `,gn=[{id:"scenario_sample_post_flow",name:"Sample post Flow",requests:[{id:"req_sample_POST1",name:"サンプル POST",method:"POST",url:"https://reply.tukutano.jp/items?page=1",headers:{dummyHeader:"dummyHeaderValue"},params:{},body:"defaultBodyValue",auth:{type:"bearer",token:"dummyToken"},bodyType:"raw",preRequestScript:`
addHeader test scriptadd1
setBody setBodyWithScript1
                `,testScript:`
bodyJsonPathEquals $.body setBodyWithScript1
                `},{id:"req_sample_POST2",name:"サンプル POST",method:"POST",url:"https://reply.tukutano.jp/items?page=2",headers:{dummyBody:'${"scenarios"."Sample post Flow"."サンプル POST"."response"."body".jsonPath("$.body")}'},params:{dummyBody:'${"scenarios"."Sample post Flow"."サンプル POST"."response"."body".jsonPath("$.body")}'},body:'{"jsonKey" : "${"scenarios"."Sample post Flow"."サンプル POST"."response"."body".jsonPath("$.headers.authorization")} "}',auth:{type:"none"},bodyType:"json",preRequestScript:`
addHeader test scriptadd2
addHeaderWithVar authorization \${"scenarios"."Sample post Flow"."サンプル POST"."response"."headers"."test"}
//setBodyWithVar \${"scenarios"."Sample post Flow"."サンプル POST"."response"."body".jsonPath("$.headers.authorization")}
                `},{id:"req_sample_POST3",name:"サンプル POST",method:"POST",url:"https://reply.tukutano.jp/items?page=3",headers:{},params:{},body:'{"jsonKey" : "jsonValue"}',auth:{type:"none"},bodyType:"raw",preRequestScript:`
addHeader test scriptadd3
setBody setBodyWithScript3
                `}]},{id:"scenario_sample_get_flow2",name:"Sample get Flow",requests:[{id:"req_sample_get2_1",name:"サンプル GET",method:"GET",url:"https://reply.tukutano.jp/items?page=10",headers:{},params:{},body:"1",auth:{type:"none"},bodyType:"raw",preRequestScript:`
addHeader test scriptadd1
// bodyをセットしてもGETリクエストのため送信されない事に注意する
setBody setBodyWithScript1
                `},{id:"req_sample_get2_2",name:"サンプル GET",method:"GET",url:"https://reply.tukutano.jp/items?page=11",headers:{},params:{},body:'{"jsonKey" : "jsonValue"}',auth:{type:"none"},bodyType:"json",preRequestScript:`
// key＝test、value=scriptadd2
addHeader test scriptadd2
                `},{id:"req_sample_get2_3",name:"サンプル GET",method:"GET",url:"https://reply.tukutano.jp/items?page=12",headers:{},params:{},body:null,auth:{type:"none"},bodyType:"raw",preRequestScript:`
addHeader test scriptadd2
// bodyをセットしてもGETリクエストのため送信されない事に注意する
setBody setBodyWithScript3
                `}]},{id:"scenario_integration_tests",name:"Integration Test Flow (Echo API)",requests:[{id:"req_scenario_echo_auth",name:"Authentication Test",method:"POST",url:"https://reply.tukutano.jp/api/auth/login",headers:{"Content-Type":"application/json",Accept:"application/json",Cookie:"deviceId=dev123abc; trackingConsent=accepted; locale=ja-JP"},params:{},body:JSON.stringify({username:"testuser",password:"secret123"}),auth:{type:"none"},bodyType:"json",preRequestScript:`// 認証リクエストの前処理
addHeader X-Request-Source integration-test`,testScript:`// 認証リクエストの検証
status 200
echoRequestMethodEquals POST
echoRequestHeaderEquals Content-Type application/json
echoRequestHeaderEquals X-Request-Source integration-test
echoRequestHeaderContains cookie deviceId=dev123abc; trackingConsent=accepted; locale=ja-JP
echoRequestBodyEquals {"username":"testuser","password":"secret123"}
echoRequestUrlContains /api/auth/login`},{id:"req_scenario_echo_data",name:"Data Retrieval Test",method:"GET",url:"https://reply.tukutano.jp/api/users/profile",headers:{Accept:"application/json","X-Test-Flow":"integration"},params:{include:"details",format:"json"},body:null,auth:{type:"bearer",token:"mock-auth-token-from-previous-step"},bodyType:"none",preRequestScript:`// 前のステップの結果を利用（模擬）
// 実際のAPIでは前のレスポンスからトークンを取得
addHeader X-Previous-Step completed`,testScript:`// データ取得リクエストの検証
status 200
echoRequestMethodEquals GET
echoRequestHeaderEquals Authorization Bearer mock-auth-token-from-previous-step
echoRequestHeaderEquals X-Test-Flow integration
echoRequestHeaderEquals X-Previous-Step completed
echoRequestUrlContains /api/users/profile
echoRequestUrlContains include=details
echoRequestUrlContains format=json`},{id:"req_scenario_echo_update",name:"Data Update Test",method:"PUT",url:"https://reply.tukutano.jp/api/users/profile",headers:{"Content-Type":"application/json",Accept:"application/json","X-Test-Flow":"integration",Cookie:"updateSession=upd789xyz; editMode=true; lastEdit=1640995800"},params:{},body:JSON.stringify({name:"Updated Test User",email:"updated@test.com",preferences:{theme:"dark",notifications:!0}}),auth:{type:"bearer",token:"mock-auth-token-from-previous-step"},bodyType:"json",preRequestScript:`// 更新リクエストの前処理
addHeader X-Update-Source integration-flow`,testScript:`// データ更新リクエストの検証
status 200
echoRequestMethodEquals PUT
echoRequestHeaderEquals Authorization Bearer mock-auth-token-from-previous-step
echoRequestHeaderEquals Content-Type application/json
echoRequestHeaderEquals X-Test-Flow integration
echoRequestHeaderEquals X-Update-Source integration-flow
echoRequestHeaderContains cookie updateSession=upd789xyz; editMode=true; lastEdit=1640995800
echoRequestBodyEquals {"name":"Updated Test User","email":"updated@test.com","preferences":{"theme":"dark","notifications":true}}
echoRequestUrlContains /api/users/profile`}]}],vn="modulepreload",bn=function(e){return"/"+e},lt={},A=function(t,n,o){let r=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),i=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));r=Promise.allSettled(n.map(l=>{if(l=bn(l),l in lt)return;lt[l]=!0;const d=l.endsWith(".css"),u=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${u}`))return;const y=document.createElement("link");if(y.rel=d?"stylesheet":vn,d||(y.as="script"),y.crossOrigin="",y.href=l,i&&y.setAttribute("nonce",i),document.head.appendChild(y),d)return new Promise((f,m)=>{y.addEventListener("load",f),y.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${l}`)))})}))}function s(a){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=a,window.dispatchEvent(i),!i.defaultPrevented)throw a}return r.then(a=>{for(const i of a||[])i.status==="rejected"&&s(i.reason);return t().catch(s)})};function En(e,t,n){return t=ve(t),Bn(e,We()?Reflect.construct(t,n||[],ve(e).constructor):t.apply(e,n))}function yt(e,t,n){if(We())return Reflect.construct.apply(null,arguments);var o=[null];o.push.apply(o,t);var r=new(e.bind.apply(e,o));return n&&be(r,n.prototype),r}function We(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(We=function(){return!!e})()}function wn(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var o=n.call(e,t);if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function Sn(e){var t=wn(e,"string");return typeof t=="symbol"?t:String(t)}function z(e){"@babel/helpers - typeof";return z=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},z(e)}function ft(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Tn(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Sn(o.key),o)}}function ht(e,t,n){return t&&Tn(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Fn(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&be(e,t)}function ve(e){return ve=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},ve(e)}function be(e,t){return be=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,r){return o.__proto__=r,o},be(e,t)}function kn(e){try{return Function.toString.call(e).indexOf("[native code]")!==-1}catch{return typeof e=="function"}}function Me(e){var t=typeof Map=="function"?new Map:void 0;return Me=function(o){if(o===null||!kn(o))return o;if(typeof o!="function")throw new TypeError("Super expression must either be null or a function");if(typeof t<"u"){if(t.has(o))return t.get(o);t.set(o,r)}function r(){return yt(o,arguments,ve(this).constructor)}return r.prototype=Object.create(o.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),be(r,o)},Me(e)}function qn(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Bn(e,t){if(t&&(typeof t=="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return qn(e)}function Cn(e){return xn(e)||$n(e)||gt(e)||Rn()}function xn(e){if(Array.isArray(e))return Ve(e)}function $n(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function gt(e,t){if(e){if(typeof e=="string")return Ve(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ve(e,t)}}function Ve(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function Rn(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function In(e,t){var n=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=gt(e))||t){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(l){throw l},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,a=!1,i;return{s:function(){n=n.call(e)},n:function(){var l=n.next();return s=l.done,l},e:function(l){a=!0,i=l},f:function(){try{!s&&n.return!=null&&n.return()}finally{if(a)throw i}}}}var L=Object.prototype.hasOwnProperty;function X(e,t){return e=e.slice(),e.push(t),e}function He(e,t){return t=t.slice(),t.unshift(e),t}var _n=function(e){Fn(t,e);function t(n){var o;return ft(this,t),o=En(this,t,['JSONPath should not be called with "new" (it prevents return of (unwrapped) scalar values)']),o.avoidNew=!0,o.value=n,o.name="NewError",o}return ht(t)}(Me(Error));function T(e,t,n,o,r){if(!(this instanceof T))try{return new T(e,t,n,o,r)}catch(l){if(!l.avoidNew)throw l;return l.value}typeof e=="string"&&(r=o,o=n,n=t,t=e,e=null);var s=e&&z(e)==="object";if(e=e||{},this.json=e.json||n,this.path=e.path||t,this.resultType=e.resultType||"value",this.flatten=e.flatten||!1,this.wrap=L.call(e,"wrap")?e.wrap:!0,this.sandbox=e.sandbox||{},this.preventEval=e.preventEval||!1,this.parent=e.parent||null,this.parentProperty=e.parentProperty||null,this.callback=e.callback||o||null,this.otherTypeCallback=e.otherTypeCallback||r||function(){throw new TypeError("You must supply an otherTypeCallback callback option with the @other() operator.")},e.autostart!==!1){var a={path:s?e.path:t};s?"json"in e&&(a.json=e.json):a.json=n;var i=this.evaluate(a);if(!i||z(i)!=="object")throw new _n(i);return i}}T.prototype.evaluate=function(e,t,n,o){var r=this,s=this.parent,a=this.parentProperty,i=this.flatten,l=this.wrap;if(this.currResultType=this.resultType,this.currPreventEval=this.preventEval,this.currSandbox=this.sandbox,n=n||this.callback,this.currOtherTypeCallback=o||this.otherTypeCallback,t=t||this.json,e=e||this.path,e&&z(e)==="object"&&!Array.isArray(e)){if(!e.path&&e.path!=="")throw new TypeError('You must supply a "path" property when providing an object argument to JSONPath.evaluate().');if(!L.call(e,"json"))throw new TypeError('You must supply a "json" property when providing an object argument to JSONPath.evaluate().');var d=e;t=d.json,i=L.call(e,"flatten")?e.flatten:i,this.currResultType=L.call(e,"resultType")?e.resultType:this.currResultType,this.currSandbox=L.call(e,"sandbox")?e.sandbox:this.currSandbox,l=L.call(e,"wrap")?e.wrap:l,this.currPreventEval=L.call(e,"preventEval")?e.preventEval:this.currPreventEval,n=L.call(e,"callback")?e.callback:n,this.currOtherTypeCallback=L.call(e,"otherTypeCallback")?e.otherTypeCallback:this.currOtherTypeCallback,s=L.call(e,"parent")?e.parent:s,a=L.call(e,"parentProperty")?e.parentProperty:a,e=e.path}if(s=s||null,a=a||null,Array.isArray(e)&&(e=T.toPathString(e)),!(!e&&e!==""||!t)){var u=T.toPathArray(e);u[0]==="$"&&u.length>1&&u.shift(),this._hasParentSelector=null;var y=this._trace(u,t,["$"],s,a,n).filter(function(f){return f&&!f.isParentSelector});return y.length?!l&&y.length===1&&!y[0].hasArrExpr?this._getPreferredOutput(y[0]):y.reduce(function(f,m){var g=r._getPreferredOutput(m);return i&&Array.isArray(g)?f=f.concat(g):f.push(g),f},[]):l?[]:void 0}};T.prototype._getPreferredOutput=function(e){var t=this.currResultType;switch(t){case"all":{var n=Array.isArray(e.path)?e.path:T.toPathArray(e.path);return e.pointer=T.toPointer(n),e.path=typeof e.path=="string"?e.path:T.toPathString(e.path),e}case"value":case"parent":case"parentProperty":return e[t];case"path":return T.toPathString(e[t]);case"pointer":return T.toPointer(e.path);default:throw new TypeError("Unknown result type")}};T.prototype._handleCallback=function(e,t,n){if(t){var o=this._getPreferredOutput(e);e.path=typeof e.path=="string"?e.path:T.toPathString(e.path),t(o,n,e)}};T.prototype._trace=function(e,t,n,o,r,s,a,i){var l=this,d;if(!e.length)return d={path:n,value:t,parent:o,parentProperty:r,hasArrExpr:a},this._handleCallback(d,s,"value"),d;var u=e[0],y=e.slice(1),f=[];function m(F){Array.isArray(F)?F.forEach(function(re){f.push(re)}):f.push(F)}if((typeof u!="string"||i)&&t&&L.call(t,u))m(this._trace(y,t[u],X(n,u),t,u,s,a));else if(u==="*")this._walk(t,function(F){m(l._trace(y,t[F],X(n,F),t,F,s,!0,!0))});else if(u==="..")m(this._trace(y,t,n,o,r,s,a)),this._walk(t,function(F){z(t[F])==="object"&&m(l._trace(e.slice(),t[F],X(n,F),t,F,s,!0))});else{if(u==="^")return this._hasParentSelector=!0,{path:n.slice(0,-1),expr:y,isParentSelector:!0};if(u==="~")return d={path:X(n,u),value:r,parent:o,parentProperty:null},this._handleCallback(d,s,"property"),d;if(u==="$")m(this._trace(y,t,n,null,null,s,a));else if(/^(\x2D?[0-9]*):(\x2D?[0-9]*):?([0-9]*)$/.test(u))m(this._slice(u,y,t,n,o,r,s));else if(u.indexOf("?(")===0){if(this.currPreventEval)throw new Error("Eval [?(expr)] prevented in JSONPath expression.");var g=u.replace(/^\?\(((?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*?)\)$/,"$1"),p=/@(?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])?((?:[\0->@-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)['\[](\??\((?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*?\))(?!(?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])\)\])['\]]/g.exec(g);p?this._walk(t,function(F){var re=[p[2]],Be=p[1]?t[F][p[1]]:t[F],Ce=l._trace(re,Be,n,o,r,s,!0);Ce.length>0&&m(l._trace(y,t[F],X(n,F),t,F,s,!0))}):this._walk(t,function(F){l._eval(g,t[F],F,n,o,r)&&m(l._trace(y,t[F],X(n,F),t,F,s,!0))})}else if(u[0]==="("){if(this.currPreventEval)throw new Error("Eval [(expr)] prevented in JSONPath expression.");m(this._trace(He(this._eval(u,t,n[n.length-1],n.slice(0,-1),o,r),y),t,n,o,r,s,a))}else if(u[0]==="@"){var h=!1,v=u.slice(1,-2);switch(v){case"scalar":(!t||!["object","function"].includes(z(t)))&&(h=!0);break;case"boolean":case"string":case"undefined":case"function":z(t)===v&&(h=!0);break;case"integer":Number.isFinite(t)&&!(t%1)&&(h=!0);break;case"number":Number.isFinite(t)&&(h=!0);break;case"nonFinite":typeof t=="number"&&!Number.isFinite(t)&&(h=!0);break;case"object":t&&z(t)===v&&(h=!0);break;case"array":Array.isArray(t)&&(h=!0);break;case"other":h=this.currOtherTypeCallback(t,n,o,r);break;case"null":t===null&&(h=!0);break;default:throw new TypeError("Unknown value type "+v)}if(h)return d={path:n,value:t,parent:o,parentProperty:r},this._handleCallback(d,s,"value"),d}else if(u[0]==="`"&&t&&L.call(t,u.slice(1))){var b=u.slice(1);m(this._trace(y,t[b],X(n,b),t,b,s,a,!0))}else if(u.includes(",")){var k=u.split(","),q=In(k),x;try{for(q.s();!(x=q.n()).done;){var I=x.value;m(this._trace(He(I,y),t,n,o,r,s,!0))}}catch(F){q.e(F)}finally{q.f()}}else!i&&t&&L.call(t,u)&&m(this._trace(y,t[u],X(n,u),t,u,s,a,!0))}if(this._hasParentSelector)for(var P=0;P<f.length;P++){var _=f[P];if(_&&_.isParentSelector){var K=this._trace(_.expr,t,_.path,o,r,s,a);if(Array.isArray(K)){f[P]=K[0];for(var qe=K.length,oe=1;oe<qe;oe++)P++,f.splice(P,0,K[oe])}else f[P]=K}}return f};T.prototype._walk=function(e,t){if(Array.isArray(e))for(var n=e.length,o=0;o<n;o++)t(o);else e&&z(e)==="object"&&Object.keys(e).forEach(function(r){t(r)})};T.prototype._slice=function(e,t,n,o,r,s,a){if(Array.isArray(n)){var i=n.length,l=e.split(":"),d=l[2]&&Number.parseInt(l[2])||1,u=l[0]&&Number.parseInt(l[0])||0,y=l[1]&&Number.parseInt(l[1])||i;u=u<0?Math.max(0,u+i):Math.min(i,u),y=y<0?Math.max(0,y+i):Math.min(i,y);for(var f=[],m=u;m<y;m+=d){var g=this._trace(He(m,t),n,o,r,s,a,!0);g.forEach(function(p){f.push(p)})}return f}};T.prototype._eval=function(e,t,n,o,r,s){this.currSandbox._$_parentProperty=s,this.currSandbox._$_parent=r,this.currSandbox._$_property=n,this.currSandbox._$_root=this.json,this.currSandbox._$_v=t;var a=e.includes("@path");a&&(this.currSandbox._$_path=T.toPathString(o.concat([n])));var i="script:"+e;if(!T.cache[i]){var l=e.replace(/@parentProperty/g,"_$_parentProperty").replace(/@parent/g,"_$_parent").replace(/@property/g,"_$_property").replace(/@root/g,"_$_root").replace(/@([\t-\r \)\.\[\xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF])/g,"_$_v$1");a&&(l=l.replace(/@path/g,"_$_path")),T.cache[i]=new this.vm.Script(l)}try{return T.cache[i].runInNewContext(this.currSandbox)}catch(d){throw new Error("jsonPath: "+d.message+": "+e)}};T.cache={};T.toPathString=function(e){for(var t=e,n=t.length,o="$",r=1;r<n;r++)/^(~|\^|@(?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*?\(\))$/.test(t[r])||(o+=/^[\*0-9]+$/.test(t[r])?"["+t[r]+"]":"['"+t[r]+"']");return o};T.toPointer=function(e){for(var t=e,n=t.length,o="",r=1;r<n;r++)/^(~|\^|@(?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*?\(\))$/.test(t[r])||(o+="/"+t[r].toString().replace(/~/g,"~0").replace(/\//g,"~1"));return o};T.toPathArray=function(e){var t=T.cache;if(t[e])return t[e].concat();var n=[],o=e.replace(/@(?:null|boolean|number|string|integer|undefined|nonFinite|scalar|array|object|function|other)\(\)/g,";$&;").replace(/['\[](\??\((?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*?\))['\]](?!(?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])\])/g,function(s,a){return"[#"+(n.push(a)-1)+"]"}).replace(/\[["']((?:[\0-&\(-\\\^-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)["']\]/g,function(s,a){return"['"+a.replace(/\./g,"%@%").replace(/~/g,"%%@@%%")+"']"}).replace(/~/g,";~;").replace(/["']?\.["']?(?!(?:[\0-Z\\-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*\])|\[["']?/g,";").replace(/%@%/g,".").replace(/%%@@%%/g,"~").replace(/(?:;)?(\^+)(?:;)?/g,function(s,a){return";"+a.split("").join(";")+";"}).replace(/;;;|;;/g,";..;").replace(/;$|'?\]|'$/g,""),r=o.split(";").map(function(s){var a=s.match(/#([0-9]+)/);return!a||!a[1]?s:n[a[1]]});return t[e]=r,t[e].concat()};var Dn=function(t,n,o){for(var r=t.length,s=0;s<r;s++){var a=t[s];o(a)&&n.push(t.splice(s--,1)[0])}},Ln=function(){function e(t){ft(this,e),this.code=t}return ht(e,[{key:"runInNewContext",value:function(n){var o=this.code,r=Object.keys(n),s=[];Dn(r,s,function(u){return typeof n[u]=="function"});var a=r.map(function(u){return n[u]}),i=s.reduce(function(u,y){var f=n[y].toString();return/function/.test(f)||(f="function "+f),"var "+y+"="+f+";"+u},"");o=i+o,!/(["'])use strict\1/.test(o)&&!r.includes("arguments")&&(o="var arguments = undefined;"+o),o=o.replace(/;[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*$/,"");var l=o.lastIndexOf(";"),d=l>-1?o.slice(0,l+1)+" return "+o.slice(l+1):" return "+o;return yt(Function,r.concat([d])).apply(void 0,Cn(a))}}]),e}();T.prototype.vm={Script:Ln};let Re=[];class w extends Error{constructor(t){super(t),this.name="AssertionError"}}class On{constructor(t){this.responseData=t,this.headers=new Ge(this.responseData.headers),this.to=new Nn(this.responseData)}get code(){return this.responseData.status}get status(){return this.getStatusText(this.responseData.status)}get responseTime(){return this.responseData.duration}get responseSize(){return this.responseData.size}json(){return this.responseData.body}text(){return this.responseData.bodyText}getStatusText(t){return{200:"OK",201:"Created",204:"No Content",400:"Bad Request",401:"Unauthorized",403:"Forbidden",404:"Not Found",500:"Internal Server Error",502:"Bad Gateway",503:"Service Unavailable"}[t]||"Unknown"}}class Pn{constructor(t){this.requestData=t}get method(){return this.requestData.method}get url(){return new An(this.requestData.url)}get headers(){return new Ge(this.requestData.headers)}get body(){return this.requestData.body}}class Ge{constructor(t){this.headers=t||{}}get(t){const n=t.toLowerCase();for(const o in this.headers)if(o.toLowerCase()===n)return this.headers[o]}has(t){return this.get(t)!==void 0}all(){return{...this.headers}}}class An{constructor(t){this.urlString=t}toString(){return this.urlString}get protocol(){try{return new URL(this.urlString).protocol}catch{return""}}get host(){try{return new URL(this.urlString).host}catch{return""}}get path(){try{return new URL(this.urlString).pathname}catch{return""}}}class Nn{constructor(t){this.responseData=t,this.have={status:n=>{if(this.responseData.status!==n)throw new w(`Expected status ${n}, got ${this.responseData.status}`)},header:(n,o)=>{const r=new Ge(this.responseData.headers);if(!r.has(n))throw new w(`Expected header '${n}' to exist`);if(o!==void 0){const s=r.get(n);if(typeof o=="string"){if(s!==o)throw new w(`Expected header '${n}' to equal '${o}', got '${s}'`)}else if(o instanceof RegExp&&!o.test(s||""))throw new w(`Expected header '${n}' to match ${o}, got '${s}'`)}},property:(n,o)=>{const r=this.responseData.body;if(typeof r!="object"||r===null)throw new w("Response body is not a JSON object");const s=n.split(".");let a=r;for(const i of s){if(a==null||!(i in a))throw new w(`Property '${n}' does not exist in response`);a=a[i]}if(o!==void 0&&a!==o)throw new w(`Expected property '${n}' to equal ${JSON.stringify(o)}, got ${JSON.stringify(a)}`)}},this.be={ok:()=>{if(this.responseData.status<200||this.responseData.status>=300)throw new w(`Expected status to be successful (200-299), got ${this.responseData.status}`)},successful:()=>{if(this.responseData.status<200||this.responseData.status>=300)throw new w(`Expected status to be successful (200-299), got ${this.responseData.status}`)}},this.include=n=>{if(!(this.responseData.bodyText||"").includes(n))throw new w(`Expected response body to include '${n}'`)},this.match=n=>{const o=this.responseData.bodyText||"";if(!n.test(o))throw new w(`Expected response body to match ${n}`)}}}class jn{get(t){return W(t)}set(t,n){ue("environment",t,n).catch(console.error)}unset(t){ue("environment",t,"").catch(console.error)}clear(){console.warn("pm.environment.clear() not implemented")}}class Mn{get(t){return W(t)}set(t,n){ue("global",t,n).catch(console.error)}unset(t){ue("global",t,"").catch(console.error)}clear(){console.warn("pm.globals.clear() not implemented")}}class Vn{get(t){return W(t)}set(t,n){typeof window<"u"&&(window.__pmLocalVariables=window.__pmLocalVariables||{},window.__pmLocalVariables[t]=n)}}class Hn{constructor(t){this.to={equal:n=>{if(this.value!==n)throw new w(`Expected ${JSON.stringify(this.value)} to equal ${JSON.stringify(n)}`)},eql:n=>{if(JSON.stringify(this.value)!==JSON.stringify(n))throw new w(`Expected ${JSON.stringify(this.value)} to deep equal ${JSON.stringify(n)}`)},be:{ok:()=>{if(!this.value)throw new w(`Expected ${JSON.stringify(this.value)} to be truthy`)},true:()=>{if(this.value!==!0)throw new w(`Expected ${JSON.stringify(this.value)} to be true`)},false:()=>{if(this.value!==!1)throw new w(`Expected ${JSON.stringify(this.value)} to be false`)},null:()=>{if(this.value!==null)throw new w(`Expected ${JSON.stringify(this.value)} to be null`)},undefined:()=>{if(this.value!==void 0)throw new w(`Expected ${JSON.stringify(this.value)} to be undefined`)},above:n=>{if(typeof this.value!="number"||this.value<=n)throw new w(`Expected ${this.value} to be above ${n}`)},below:n=>{if(typeof this.value!="number"||this.value>=n)throw new w(`Expected ${this.value} to be below ${n}`)},at:{least:n=>{if(typeof this.value!="number"||this.value<n)throw new w(`Expected ${this.value} to be at least ${n}`)},most:n=>{if(typeof this.value!="number"||this.value>n)throw new w(`Expected ${this.value} to be at most ${n}`)}},an:n=>{const o=Array.isArray(this.value)?"array":typeof this.value;if(o!==n)throw new w(`Expected ${JSON.stringify(this.value)} to be an ${n}, got ${o}`)},a:n=>{const o=Array.isArray(this.value)?"array":typeof this.value;if(o!==n)throw new w(`Expected ${JSON.stringify(this.value)} to be a ${n}, got ${o}`)}},include:n=>{if(typeof this.value=="string"){if(!this.value.includes(n))throw new w(`Expected '${this.value}' to include '${n}'`)}else if(Array.isArray(this.value)){if(!this.value.includes(n))throw new w(`Expected array to include ${JSON.stringify(n)}`)}else throw new w(`Cannot check inclusion on ${typeof this.value}`)},match:n=>{if(typeof this.value!="string")throw new w(`Expected value to be a string, got ${typeof this.value}`);if(!n.test(this.value))throw new w(`Expected '${this.value}' to match ${n}`)},have:{property:(n,o)=>{if(typeof this.value!="object"||this.value===null)throw new w(`Expected ${JSON.stringify(this.value)} to be an object`);if(!(n in this.value))throw new w(`Expected object to have property '${n}'`);if(o!==void 0&&this.value[n]!==o)throw new w(`Expected property '${n}' to equal ${JSON.stringify(o)}, got ${JSON.stringify(this.value[n])}`)},length:n=>{if(!this.value||typeof this.value.length!="number")throw new w(`Expected ${JSON.stringify(this.value)} to have length property`);if(this.value.length!==n)throw new w(`Expected length ${n}, got ${this.value.length}`)}}},this.value=t}}class zn{constructor(){this.response=null,this.request=null,this.environment=new jn,this.globals=new Mn,this.variables=new Vn,this.info={requestName:"",requestId:"",iteration:1}}test(t,n){try{n(),Re.push({name:t,passed:!0}),console.log(`✓ ${t}`)}catch(o){Re.push({name:t,passed:!1,error:o.message}),console.error(`✗ ${t}: ${o.message}`)}}expect(t){return new Hn(t)}sendRequest(){console.warn("pm.sendRequest() not implemented in this environment")}}const se=new zn,Jn={log:(...e)=>console.log("[PM Console]",...e),info:(...e)=>console.info("[PM Console]",...e),warn:(...e)=>console.warn("[PM Console]",...e),error:(...e)=>console.error("[PM Console]",...e)};async function Un(e,t,n){Re=[],se.response=new On(t),se.request=new Pn(n),se.info.requestName=n.name,se.info.requestId=n.id;const o={pm:se,console:Jn,JSONPath:T,_:(typeof window<"u"?window._:void 0)||{},CryptoJS:(typeof window<"u"?window.CryptoJS:void 0)||{}};try{return new Function(...Object.keys(o),e)(...Object.values(o)),Re}catch(r){return console.error("Postman test script execution error:",r),[{name:"Script Execution Error",passed:!1,error:r.message}]}}function Wn(e){return/\bpm\.|pm\.test\(|pm\.expect\(|pm\.response|pm\.request|pm\.environment|pm\.globals/.test(e)}typeof window<"u"&&(window.pm=se);function Le(){const e=document.getElementById("historyContainer");if(c.history.length===0){e.innerHTML='<p class="empty-message">No request history</p>';return}e.innerHTML="",c.history.forEach(t=>{var a,i,l;const n=document.createElement("div");n.className="history-item",n.dataset.id=t.id.toString();const o=((a=t.request)==null?void 0:a.method)||"GET",r=((i=t.request)==null?void 0:i.url)||"",s=((l=t.response)==null?void 0:l.status)||0;n.innerHTML=`
            <span class="history-method method-${o}">${o}</span>
            <span class="history-url">${N(r)}</span>
            <span class="history-status status-${s<400?"success":"error"}">${s||"N/A"}</span>
            <span class="history-time">${new Date(t.timestamp).toLocaleTimeString()}</span>
        `,n.addEventListener("click",()=>bt(t.id)),e.appendChild(n)})}async function vt(e,t,n=[]){const o={id:Date.now().toString(),timestamp:new Date().toISOString(),request:{id:e.id,name:e.name,method:e.method,url:e.url,headers:e.headers,params:e.params,body:e.body,bodyType:e.bodyType,auth:e.auth,preRequestScript:e.preRequestScript,testScript:e.testScript},response:{status:t.status,statusText:t.statusText,headers:t.headers,body:t.body,bodyText:t.bodyText,duration:t.duration,size:t.size,testResults:n}};c.history.unshift(o),c.history.length>100&&c.history.splice(100),await ot(),Le()}async function bt(e){const t=c.history.find(o=>o.id===e);if(!t||!t.request)return;const n={...t.request,lastResponseExecution:t.response?{status:t.response.status,duration:t.response.duration,size:t.response.size,timestamp:t.timestamp,headers:t.response.headers,body:t.response.body,testResults:t.response.testResults||[]}:void 0};Y(n),Fe("request"),S("Request and response loaded from history")}async function Et(){confirm("Are you sure you want to clear all request history?")&&(c.history.length=0,await ot(),Le(),S("History cleared"))}function wt(){const t=document.getElementById("historySearch").value.toLowerCase();document.querySelectorAll(".history-item").forEach(o=>{var d,u;const r=o,s=r.querySelector(".history-url"),a=r.querySelector(".history-method"),i=((d=s.textContent)==null?void 0:d.toLowerCase())||"",l=((u=a.textContent)==null?void 0:u.toLowerCase())||"";i.includes(t)||l.includes(t)?r.style.display="flex":r.style.display="none"})}const Gn=Object.freeze(Object.defineProperty({__proto__:null,clearHistory:Et,filterHistory:wt,loadHistoryItem:bt,renderHistory:Le,saveToHistory:vt},Symbol.toStringTag,{value:"Module"}));function Kn(e){return{200:"OK",201:"Created",204:"No Content",400:"Bad Request",401:"Unauthorized",403:"Forbidden",404:"Not Found",500:"Internal Server Error",502:"Bad Gateway",503:"Service Unavailable"}[e]||"Unknown"}function Xn(){const e=document.getElementById("responseStats");e&&(e.innerHTML='<span class="no-response">No response yet</span>');const t=document.getElementById("responseBody");t&&(t.innerHTML='<div class="no-response">Send a request to see the response</div>');const n=document.getElementById("response-headers");n&&(n.innerHTML='<div class="no-response">No headers</div>');const o=document.getElementById("response-cookies");o&&(o.innerHTML='<div class="no-response">No cookies</div>');const r=document.getElementById("response-tests");r&&(r.innerHTML='<div class="no-response">No tests run</div>')}function Y(e){var m;console.log("loadRequestIntoEditor called with request:",e),console.log("Request params from input:",e.params),c.currentRequest=JSON.parse(JSON.stringify(e)),console.log("After setting state.currentRequest.params:",(m=c.currentRequest)==null?void 0:m.params);const t=document.getElementById("request-name-display");t&&(t.innerHTML=`<input type="text" id="nameInput" value="${e.name}"></input>`);const n=document.getElementById("request-id-display");n&&(n.innerHTML=`<span>Request ID: <em>${e.id}</em></span>`);const o=document.getElementById("methodSelect"),r=document.getElementById("urlInput");o.value=e.method,r.value=e.url;const s=document.getElementById("headersContainer");s.innerHTML="",e.headers&&Object.keys(e.headers).length>0?Object.entries(e.headers).forEach(([g,p])=>{C(s,"header");const h=s.querySelectorAll(".key-value-row"),v=h[h.length-1],b=v.querySelector(".key-input"),k=v.querySelector(".value-input");b.value=g,k.value=p}):C(s,"header");const a=document.getElementById("paramsContainer");if(a.innerHTML="",console.log("Loading request params:",e.params),console.log("ParamsContainer element:",a),e.params&&Object.keys(e.params).length>0){const g=Object.entries(e.params);g.forEach(()=>{C(a,"param")}),setTimeout(()=>{const h=a.querySelectorAll(".key-value-row");console.log(`Found ${h.length} rows, expected ${g.length}`),g.forEach(([v,b],k)=>{if(k<h.length){const q=h[k],x=q.querySelector(".key-input"),I=q.querySelector(".value-input");x&&I?(x.value=v,I.value=b,console.log(`Set param ${k}: ${v} = ${b}`),x.dispatchEvent(new Event("input",{bubbles:!0})),I.dispatchEvent(new Event("input",{bubbles:!0}))):console.error(`Could not find input elements in row ${k}`)}else console.error(`Row ${k} not found`)})},50),c.currentRequest&&(c.currentRequest.params={...e.params},console.log("Updated state.currentRequest.params:",c.currentRequest.params));const p=document.getElementById("preRequestScript");p.value=e.preRequestScript||"",Q(p)}else console.log("No params to load, adding empty row"),C(a,"param");if(e.body)if(e.bodyType==="binary"){const g=document.getElementById("binaryFileInput"),p=document.getElementById("binaryFileInfo");if(e.body instanceof File)g.files=new DataTransfer().files,p.textContent=`Saved: ${e.body.name} (${U(e.body.size)})`;else if(typeof e.body=="string")try{const h=JSON.parse(e.body),v=le(h.base64Data,h.fileName,h.fileType);c.currentRequest.body=v,p.textContent=`Restored: ${h.fileName} (${U(h.fileSize)})`}catch{console.warn("binary の復元に失敗")}}else if(typeof e.body=="string"){const g=document.querySelector('input[name="bodyType"][value="raw"]');g.checked=!0,H({target:{value:"raw"}});const p=document.getElementById("rawBody");p.value=e.body}else{const g=document.querySelector('input[name="bodyType"][value="form-data"]');g.checked=!0,H({target:{value:"form-data"}});const p=document.getElementById("formDataFieldsContainer");p&&(p.innerHTML="",Array.isArray(e.body)?(console.log("🔍 [loadRequestIntoEditor] FormDataField[]形式で復元:",e.body),e.body.forEach(h=>{var P;C(p,"body");const v=p.querySelectorAll(".key-value-row"),b=v[v.length-1],k=b.querySelector(".key-input"),q=b.querySelector(".value-type-select"),x=b.querySelector(".value-input"),I=b.querySelector(".file-input");if(k.value=h.key,h.type==="file"){if(q.value="file",x.style.display="none",I.style.display="block",h.fileName){const _=document.createElement("span");_.textContent=`Saved: ${h.fileName}`,_.style.color="#666",_.style.fontSize="12px",_.style.marginLeft="8px",_.dataset.fileInfo=JSON.stringify({fileName:h.fileName,fileType:h.fileType,fileSize:h.fileSize,fileContent:h.fileContent}),(P=I.parentNode)==null||P.appendChild(_)}}else q.value="text",x.style.display="block",I.style.display="none",x.value=h.value||""})):(console.log("🔍 [loadRequestIntoEditor] Record形式で復元:",e.body),Object.entries(e.body).forEach(([h,v])=>{C(p,"body");const b=p.querySelectorAll(".key-value-row"),k=b[b.length-1],q=k.querySelector(".key-input"),x=k.querySelector(".value-input");q.value=h,x.value=v})))}else{const g=document.querySelector('input[name="bodyType"][value="none"]');g.checked=!0,H({target:{value:"none"}})}if(e.auth){const g=document.getElementById("authType");switch(g.value=e.auth.type||"none",Oe(e.auth.type),e.auth.type){case"basic":const p=document.getElementById("authUsername"),h=document.getElementById("authPassword");p.value=e.auth.username||"",h.value=e.auth.password||"";break;case"bearer":const v=document.getElementById("authToken");v.value=e.auth.token||"";break;case"apikey":const b=document.getElementById("authKey"),k=document.getElementById("authValue"),q=document.getElementById("authAddTo");b.value=e.auth.key||"",k.value=e.auth.value||"",q.value=e.auth.addTo||"header";break;case"oauth2":const x=document.getElementById("authAccessToken"),I=document.getElementById("authTokenType");x.value=e.auth.accessToken||"",I.value=e.auth.tokenType||"Bearer";break}Ee()}const i=e.bodyType||"none",l=document.querySelector(`input[name="bodyType"][value="${i}"]`);if(l)l.checked=!0,H({target:{value:i}});else{const g=document.querySelector('input[name="bodyType"][value="none"]');g&&(g.checked=!0,H({target:{value:"none"}}))}const d=document.getElementById("rawBody"),u=document.getElementById("jsonBody");if(d&&(d.value=e.body||""),u&&(u.value=e.body||""),i==="binary"){const g=document.getElementById("binaryFileInput"),p=document.getElementById("binaryFileInfo");if(e.body instanceof File)p&&(p.innerHTML=`
                    <div class="saved-binary-file">
                        <span class="file-name">Saved: ${e.body.name}</span>
                        <span class="file-size">(${U(e.body.size)})</span>
                        <span class="file-type">${e.body.type||"Unknown type"}</span>
                    </div>
                `,g&&(g.dataset.savedFile=JSON.stringify({name:e.body.name,size:e.body.size,type:e.body.type}))),console.log("🔍 [loadRequestIntoEditor] Binary file restored:",{name:e.body.name,size:e.body.size,type:e.body.type});else if(typeof e.body=="string")try{const h=JSON.parse(e.body);if(h.type==="binaryFile"&&h.base64Data){const v=le(h.base64Data,h.fileName,h.fileType);g&&p&&(p.innerHTML=`
                            <div class="saved-binary-file">
                                <span class="file-name">Restored: ${h.fileName}</span>
                                <span class="file-size">(${U(h.fileSize||0)})</span>
                                <span class="file-type">${h.fileType||"Unknown type"}</span>
                            </div>
                        `,c.currentRequest&&(c.currentRequest.body=v)),console.log("🔍 [loadRequestIntoEditor] Binary file restored from Base64:",{name:h.fileName,size:h.fileSize,type:h.fileType})}}catch(h){console.error("🔍 [loadRequestIntoEditor] Failed to restore binary file:",h)}}const y=document.getElementById("preRequestScript");y&&(y.value=e.preRequestScript||"");const f=document.getElementById("testScript");if(f&&(f.value=e.testScript||""),e.lastRequestExecution||e.lastResponseExecution){if(e.lastResponseExecution){const g=typeof e.lastResponseExecution.body=="string"?e.lastResponseExecution.body:JSON.stringify(e.lastResponseExecution.body,null,2),p={status:e.lastResponseExecution.status,statusText:Kn(e.lastResponseExecution.status),headers:e.lastResponseExecution.headers||{},duration:e.lastResponseExecution.duration,size:e.lastResponseExecution.size,body:e.lastResponseExecution.body,bodyText:g};Ke(p),e.lastResponseExecution.testResults&&ge(e.lastResponseExecution.testResults)}}else Xn();Fe("request")}async function Yn(e,t,n){const o=document.getElementById("response-tests");o&&(o.innerHTML='<div class="no-response">Tests are running...</div>');let r;if(t!==void 0)r=t;else{const i=document.getElementById("testScript");r=(i==null?void 0:i.value)||""}if(console.log("実行するテストスクリプト:",r),!(r!=null&&r.trim()))return o&&(o.innerHTML='<div class="no-response">No tests to execute</div>'),[];if(Wn(r)){console.log("Postman形式のテストスクリプトを実行します");try{const i=await Un(r,e,n||c.currentRequest||{});return ge(i),i}catch(i){console.error("Postman test script 実行エラー:",i);const l={name:"Postman Script Execution Error",passed:!1,error:i.message};return ge([l]),[l]}}console.log("従来のコマンド形式のテストスクリプトを実行します");const s=r.split(/\r?\n/).map(i=>i.trim()).filter(i=>i!==""&&!i.startsWith("//"));console.log("実行するテストコマンド一覧:",s),console.log("レスポンスデータ:",e);const a=[];try{for(const i of s){console.log("実行中のテストコマンド:",i);const l=mo(i,e);console.log("テストコマンド結果:",l),a.push({name:i,passed:l.passed,error:l.error})}return ge(a),a}catch(i){console.error("Test script 実行エラー:",i);const l={name:"Script Execution Error",passed:!1,error:i.message};return a.push(l),ge(a),a}}async function Qn(e,t,n,o){var r;if(c.currentCollection){const s=c.collections.find(a=>a.id===c.currentCollection);if(s){const a=s.requests.find(i=>i.id===e);a&&(a.lastRequestExecution=t,a.lastResponseExecution={status:n.status,duration:n.duration,size:n.size,timestamp:new Date().toISOString(),headers:n.headers,body:n.body,testResults:o})}await $()}if(c.scenarios.forEach(s=>{const a=(s.requests||[]).find(i=>i.id===e);a&&(console.log(`🔍 [saveExecutionResult] Saving execution result for scenario "${s.name}" request "${a.name}"`),a.lastRequestExecution=t,a.lastResponseExecution={status:n.status,duration:n.duration,size:n.size,timestamp:new Date().toISOString(),headers:n.headers,body:n.body,testResults:o},console.log("🔍 [saveExecutionResult] Saved response data:",{status:n.status,headers:Object.keys(n.headers||{}),bodyType:typeof n.body}))}),await R(),((r=c.currentRequest)==null?void 0:r.id)===e){const s=c.currentRequest;s.lastRequestExecution=t,s.lastResponseExecution={status:n.status,duration:n.duration,size:n.size,timestamp:new Date().toISOString(),headers:n.headers,body:n.body,testResults:o}}}async function St(e,t=!1){var o;Je(!0);let n=e;try{if(!((o=e.url)!=null&&o.trim()))return E("URL is required","Please enter a valid URL in the format: http://example.com or https://example.com"),"";try{n=fo(e)}catch(m){return console.error("Variable processing error:",m),De("Request processing",m),""}try{n=yo(n.preRequestScript||"",n)}catch(m){return console.error("Pre-request script error:",m),E("Pre-request script execution failed",`Error: ${m.message}

Please check your pre-request script syntax and variable references.`),""}const r={timestamp:new Date().toISOString(),method:n.method,url:n.url,headers:n.headers,params:n.params,body:n.body,auth:n.auth,folder:n.folder||"",description:n.description||"",bodyType:n.bodyType||"none",preRequestScript:n.preRequestScript||""},s=eo(n);if(!s)return"";const{method:a,headers:i,bodyData:l,url:d}=s;console.log("🍪 Always using sendRequestWithCookieSupport");const u=await to({method:a,url:d,headers:i,body:l}),y=await oo(u,u.duration||0);t||Ke(y);const f=await Yn(y,e.testScript,e);return await ho(n,y,f),await Qn(e.id,r,y,f),t?{response:y,testResults:f}:u}catch(r){console.error("Request error:",r),r.message.includes("Network")||r.message.includes("fetch")||r.message.includes("CORS")||r.message.includes("timeout")?zt(n.url||e.url,r):r.message.includes("Variable")||r.message.includes("変数")?De("Request execution",r):r.message.includes("Invalid URL")?E("Invalid URL format",`The URL "${n.url||e.url}" is not valid. Please check the URL format and ensure all variables are properly resolved.`):r.message.includes("JSON")||r.message.includes("parse")?E("Response parsing failed",`Unable to parse the response as JSON. The server may have returned invalid JSON or a different content type.

Error: ${r.message}`):E("Request failed",`An unexpected error occurred while processing your request.

Error: ${r.message}

Please check your request configuration and try again.`)}finally{Je(!1)}return""}function Zn(e){return new Promise((t,n)=>{var r,s;if(console.log("🔍 [fileToBase64] 開始. file詳細:",{file:e,name:e==null?void 0:e.name,size:e==null?void 0:e.size,type:e==null?void 0:e.type,instanceof_File:e instanceof File,instanceof_Blob:e instanceof Blob,constructor:(r=e==null?void 0:e.constructor)==null?void 0:r.name,typeof:typeof e}),!e){console.error("🔍 [fileToBase64] ファイルオブジェクトがnullまたはundefined"),n(new Error("File object is null or undefined"));return}if(!(e instanceof File)&&!(e instanceof Blob)){console.error("🔍 [fileToBase64] ファイルオブジェクトがFile/Blobインスタンスではありません"),n(new Error(`File object is not a File or Blob instance. Type: ${typeof e}, Constructor: ${(s=e==null?void 0:e.constructor)==null?void 0:s.name}`));return}const o=new FileReader;o.onload=()=>{console.log("🔍 [fileToBase64] FileReader.onload成功");const i=o.result.split(",")[1];console.log("🔍 [fileToBase64] Base64変換完了. 長さ:",(i==null?void 0:i.length)||0),t(i)},o.onerror=a=>{console.error("🔍 [fileToBase64] FileReader.onerror:",a),n(a)};try{console.log("🔍 [fileToBase64] FileReader.readAsDataURL呼び出し開始"),o.readAsDataURL(e)}catch(a){console.error("🔍 [fileToBase64] FileReader.readAsDataURL呼び出しでエラー:",a),n(a)}})}function eo(e){const t=(e.method||"GET").toUpperCase(),n={};let o=null;e.headers&&Object.assign(n,e.headers),no(n,e.auth);let r=e.url;if(e.body&&t!=="GET"&&t!=="HEAD")switch(e.bodyType||"none"){case"raw":{o=e.body.toString();break}case"json":{o=typeof e.body=="string"?e.body:JSON.stringify(e.body),n["Content-Type"]="application/json";break}case"form-data":{if(console.log("🔍 [buildFetchOptions] form-data処理. request.body:",e.body),Array.isArray(e.body))console.log("🔍 [buildFetchOptions] FormDataField[]配列をそのまま返す"),o=e.body;else{console.log("🔍 [buildFetchOptions] 古いロジック（collectKeyValues）を使用");const a=new FormData,i=te("formDataFieldsContainer");Object.entries(i).forEach(([l,d])=>{a.append(l,d)}),o=a}break}case"urlencoded":{const a=new URLSearchParams,i=te("formDataFieldsContainer");Object.entries(i).forEach(([l,d])=>{a.append(l,d)}),o=a.toString(),n["Content-Type"]="application/x-www-form-urlencoded";break}case"binary":{e.body instanceof File?(console.log("🔍 [buildFetchOptions] Binary file処理:",{name:e.body.name,size:e.body.size,type:e.body.type}),o=e.body,!n["Content-Type"]&&e.body.type&&(n["Content-Type"]=e.body.type)):console.log("🔍 [buildFetchOptions] Binary body is not a File object");break}}return{method:t,headers:n,bodyData:o,url:r}}async function to(e){return console.log("🍪 sendRequestWithCookieSupport called with:",e),new Promise(async(t,n)=>{var a,i,l,d,u,y;const o=Date.now();let r=null,s=!1;try{if(console.log("🔍 [requestManager.ts] bodyの処理開始. options.body:",e.body),console.log("🔍 [requestManager.ts] options.body type:",typeof e.body),console.log("🔍 [requestManager.ts] options.body instanceof FormData:",e.body instanceof FormData),console.log("🔍 [requestManager.ts] Array.isArray(options.body):",Array.isArray(e.body)),e.body instanceof FormData){console.log("🔍 [requestManager.ts] FormDataオブジェクトとして処理");const m={};for(const[g,p]of e.body.entries())m[g]=p.toString();r=JSON.stringify(m),console.log("🔍 [requestManager.ts] FormData処理完了:",m)}else if(Array.isArray(e.body)){console.log("🔍 [requestManager.ts] FormDataField[]配列として処理");const m=e.body;console.log("🔍 [requestManager.ts] formDataFields:",m);const g=[];for(const p of m)if(console.log("🔍 [requestManager.ts] 処理中のfield:",p),console.log("🔍 [requestManager.ts] field.file詳細:",{file:p.file,fileType:typeof p.file,isBlob:p.file instanceof Blob,isFile:p.file instanceof File,constructor:(i=(a=p.file)==null?void 0:a.constructor)==null?void 0:i.name}),p.type==="file"&&p.file){if(!(p.file instanceof File)&&!(p.file instanceof Blob)){console.error("🔍 [requestManager.ts] field.fileがFile/Blobではありません:",p.file),g.push({key:p.key,type:"text",value:`[File Error: ${p.file}]`});continue}console.log("🔍 [requestManager.ts] ファイルフィールドを処理:",{key:p.key,filename:p.file.name,size:p.file.size,type:p.file.type}),s=!0,console.log("🔍 [requestManager.ts] Base64変換開始..."),console.log("🔍 [requestManager.ts] fileToBase64に渡すfile:",p.file),console.log("🔍 [requestManager.ts] fileToBase64に渡すfile詳細2:",{file:p.file,typeof:typeof p.file,instanceof_File:p.file instanceof File,instanceof_Blob:p.file instanceof Blob,constructor_name:(d=(l=p.file)==null?void 0:l.constructor)==null?void 0:d.name,Object_prototype_toString:Object.prototype.toString.call(p.file)});const h=await Zn(p.file);console.log("🔍 [requestManager.ts] Base64変換完了. データ長:",h.length),g.push({key:p.key,type:"file",filename:p.file.name,contentType:p.file.type,data:h})}else console.log("🔍 [requestManager.ts] テキストフィールドを処理:",{key:p.key,value:p.value}),g.push({key:p.key,type:"text",value:p.value||""});r=JSON.stringify(g),console.log("🔍 [requestManager.ts] 配列処理完了. hasFiles:",s),console.log("🔍 [requestManager.ts] processedFields:",g)}else if(e.body instanceof File){console.log("🔍 [requestManager.ts] Binary File として処理");const m=await e.body.arrayBuffer();r=JSON.stringify({type:"binary",filename:e.body.name,contentType:e.body.type,arrayBuffer:Array.from(new Uint8Array(m))}),s=!0,console.log("🔍 [requestManager.ts] Binary File 処理完了:",{filename:e.body.name,size:e.body.size,contentType:e.body.type,arrayBufferSize:m.byteLength})}else typeof e.body=="string"?(console.log("🔍 [requestManager.ts] 文字列として処理"),r=e.body):(u=e.body)!=null&&u.toString&&e.body.toString()!=="[object Object]"&&(console.log("🔍 [requestManager.ts] toString()で処理"),r=e.body.toString());const f={action:"sendHttpRequest",options:{method:e.method,url:e.url,headers:e.headers,body:r,isFormData:e.body instanceof FormData||Array.isArray(e.body)||e.body instanceof File,hasFiles:s}};console.log("🔍 [requestManager.ts] messageData作成完了:",{action:f.action,method:f.options.method,url:f.options.url,headers:f.options.headers,bodyType:typeof f.options.body,bodyLength:((y=f.options.body)==null?void 0:y.length)||0,isFormData:f.options.isFormData,hasFiles:f.options.hasFiles}),console.log("🔍 [requestManager.ts] Sending message to background script for Cookie handling"),chrome.runtime.sendMessage(f,m=>{if(console.log("Received response from background script:",m),chrome.runtime.lastError){console.error("Chrome runtime error:",chrome.runtime.lastError.message),n(new Error(chrome.runtime.lastError.message));return}if(m.success){const g=Date.now()-o,p={status:m.status,statusText:m.statusText,headers:m.headers,text:async()=>m.body,json:async()=>{try{return JSON.parse(m.body)}catch{return{}}},duration:g};console.log("Constructed Cookie XhrResponse:",p),t(p)}else console.error("Background script returned error:",m.error),n(new Error(m.error||"Cookie request failed"))})}catch(f){console.error("Error processing request body:",f),n(new Error(`Request processing failed: ${f.message}`))}})}function no(e,t){switch(t.type){case"basic":if(t.username&&t.password){const n=btoa(`${t.username}:${t.password}`);e.Authorization=`Basic ${n}`}break;case"bearer":t.token&&(e.Authorization=`Bearer ${t.token}`);break;case"apikey":t.key&&t.value&&t.addTo==="header"&&(e[t.key]=t.value);break;case"oauth2":t.accessToken&&(e.Authorization=`${t.tokenType||"Bearer"} ${t.accessToken}`);break}}async function oo(e,t){const n={status:e.status,statusText:e.statusText,headers:{},duration:t,size:0,body:null,bodyText:""};e.headers&&Object.entries(e.headers).forEach(([r,s])=>{n.headers[r]=s});const o=n.headers["content-type"]||"";try{if(n.bodyText=await e.text(),n.size=new Blob([n.bodyText]).size,o.includes("application/json"))try{n.body=JSON.parse(n.bodyText)}catch{n.body=n.bodyText}else n.body=n.bodyText}catch{n.bodyText="Error reading response body",n.body=null}return n}function Ke(e,t="pretty"){window.lastResponse=e;const n=document.getElementById("responseStats");n.innerHTML=`
        <span class="status-${e.status<400?"success":"error"}">
            ${e.status} ${e.statusText}
        </span>
        <span>${e.duration}ms</span>
        <span>${U(e.size)}</span>
    `,lo(e,t),uo(e.headers),po(e.headers)}function ro(e){try{const n=new DOMParser().parseFromString(e,"application/xml");return n.querySelector("parsererror")?e:new XMLSerializer().serializeToString(n).replace(/></g,`>
<`).replace(/^\s*\n/gm,"").split(`
`).map(s=>{const a=(s.match(/</g)||[]).length-(s.match(/\//g)||[]).length;return"  ".repeat(Math.max(0,a))+s.trim()}).join(`
`)}catch{return e}}function so(e){try{return e.replace(/></g,`>
<`).replace(/^\s*\n/gm,"").split(`
`).map(t=>t.trim()).filter(t=>t.length>0).map((t,n,o)=>{const r=o[n-1],s=r?(r.match(/</g)||[]).length-(r.match(/\//g)||[]).length:0;return"  ".repeat(Math.max(0,s))+t}).join(`
`)}catch{return e}}function ao(e){try{return e.replace(/\{/g,` {
`).replace(/\}/g,`
}
`).replace(/;/g,`;
`).split(`
`).map(t=>t.trim()).filter(t=>t.length>0).map(t=>t.includes("{")&&!t.includes("}")||t==="}"?t:"  "+t).join(`
`)}catch{return e}}function io(e){try{return e.replace(/\{/g,` {
`).replace(/\}/g,`
}
`).replace(/;/g,`;
`).replace(/,/g,`,
`).split(`
`).map(t=>t.trim()).filter(t=>t.length>0).map((t,n,o)=>{const r=(t.match(/\{/g)||[]).length,s=(t.match(/\}/g)||[]).length,i=o.slice(0,n).reduce((l,d)=>l+(d.match(/\{/g)||[]).length-(d.match(/\}/g)||[]).length,0);return s>0&&r===0?"  ".repeat(Math.max(0,i-s))+t:"  ".repeat(Math.max(0,i))+t}).join(`
`)}catch{return e}}function co(e,t){const n=e.toLowerCase();if(n.includes("json"))return"json";if(n.includes("xml"))return"xml";if(n.includes("html"))return"html";if(n.includes("css"))return"css";if(n.includes("javascript")||n.includes("text/js"))return"javascript";const o=t.trim();if(o.startsWith("{")||o.startsWith("["))try{return JSON.parse(o),"json"}catch{}return o.startsWith("<")&&(o.includes("<?xml")||o.includes("<"))?o.includes("<!DOCTYPE html")||o.includes("<html")?"html":"xml":"text"}function lo(e,t){const n=document.getElementById("responseBody");let o="";const r=e.headers["content-type"]||"",s=co(r,e.bodyText);switch(t){case"pretty":switch(s){case"json":try{if(typeof e.body=="object")o=JSON.stringify(e.body,null,2);else{const a=JSON.parse(e.bodyText);o=JSON.stringify(a,null,2)}}catch{o=e.bodyText}break;case"xml":o=ro(e.bodyText);break;case"html":o=so(e.bodyText);break;case"css":o=ao(e.bodyText);break;case"javascript":o=io(e.bodyText);break;default:o=e.bodyText;break}break;case"raw":o=e.bodyText;break;case"preview":if(s==="html"){n.innerHTML=`<iframe srcdoc="${N(e.bodyText)}" style="width:100%;height:300px;border:1px solid #ccc;"></iframe>`;return}else if(s==="json")try{const a=typeof e.body=="object"?e.body:JSON.parse(e.bodyText);o=`<pre style="background:#f5f5f5;padding:10px;border-radius:4px;overflow:auto;">${JSON.stringify(a,null,2)}</pre>`,n.innerHTML=o;return}catch{o=e.bodyText}else o=e.bodyText;break}n.innerHTML=`<pre class="response-content response-${s}">${N(o)}</pre>`}function uo(e){const t=document.getElementById("response-headers");let n='<div class="headers-list">';Object.entries(e).forEach(([o,r])=>{n+=`<div class="header-item"><span class="header-key">${N(o)}</span><span class="header-value">${N(r)}</span></div>`}),n+="</div>",t.innerHTML=n}function po(e){const t=document.getElementById("response-cookies"),n=e["set-cookie"],o=e.cookie,r=[];if(n&&(Array.isArray(n)?r.push(...n):r.push(n)),o&&(Array.isArray(o)?r.push(...o):r.push(o)),r.length>0){let s='<div class="cookies-list">';r.forEach(a=>{a.split(";").map(l=>l.trim()).filter(l=>l.length>0).forEach(l=>{s+=`<div class="cookie-item">${N(l)}</div>`})}),s+="</div>",t.innerHTML=s}else t.innerHTML='<p class="empty-message">No cookies in response</p>'}function mo(e,t){const[n,...o]=e.trim().split(/\s+/);switch(n){case"status":{const r=parseInt(o[0],10);return t.status!==r?{passed:!1,error:`Expected status ${r}, got ${t.status}`}:{passed:!0}}case"jsonHasProperty":{const r=o[0],s=t.body;return typeof s!="object"||s===null?{passed:!1,error:"レスポンスボディが JSON オブジェクトではありません"}:r in s?{passed:!0}:{passed:!1,error:`JSON にプロパティ "${r}" が見つかりません`}}case"jsonArrayLengthEquals":{const[r,s]=o,a=parseInt(s,10),i=t.body;if(typeof i!="object"||i===null)return{passed:!1,error:"レスポンスボディが JSON オブジェクトではありません"};const l=r.split(".").reduce((d,u)=>d&&d[u]!==void 0?d[u]:void 0,i);return Array.isArray(l)?l.length!==a?{passed:!1,error:`Expected ${r}.length === ${a}, got ${l.length}`}:{passed:!0}:{passed:!1,error:`パス "${r}" に対応する値が配列ではありません`}}case"bodyContains":{const r=o.join(" ");return(t.bodyText??"").includes(r)?{passed:!0}:{passed:!1,error:`レスポンスボディに "${r}" が含まれていません`}}case"setVarFromHeader":{const r=o[0],s=o.slice(1).join(" "),a=t.headers||{},i=s.toLowerCase();let l;for(const d in a)if(d.toLowerCase()===i){l=a[d];break}return l===void 0?{passed:!1,error:`レスポンスヘッダー "${s}" が見つかりません`}:(console.log("取得したAuthorizationヘッダ：varName=",r),console.log("取得したAuthorizationヘッダ：headerValue=",l),ue("environment",r,l).catch(console.error),j("environment"),{passed:!0})}case"jsonValueEquals":{const r=o[0],s=o.slice(1).join(" "),a=isNaN(Number(s))?s:Number(s);let i;if(typeof t.bodyText=="string")try{i=JSON.parse(t.bodyText)}catch{return{passed:!1,error:"レスポンスボディが有効な JSON ではありません"}}else i=t.body;const l=r.split(".").reduce((d,u)=>{if(d&&u in d)return d[u];if(u==="length"&&Array.isArray(d))return d.length},i);return l===void 0?{passed:!1,error:`パス "${r}" が見つかりません`}:l!==a?{passed:!1,error:`期待値: ${a} ですが、実際の値: ${l} です`}:{passed:!0}}case"headerExists":{const r=o[0].toLowerCase();return Object.keys(t.headers).some(a=>a.toLowerCase()===r)?{passed:!0}:{passed:!1,error:`ヘッダー "${o[0]}" が存在しません`}}case"headerValueEquals":{const r=o[0].toLowerCase(),s=o.slice(1).join(" ");let a;for(const[i,l]of Object.entries(t.headers))if(i.toLowerCase()===r){a=l;break}return a===void 0?{passed:!1,error:`ヘッダー "${o[0]}" が存在しません`}:a!==s?{passed:!1,error:`"${o[0]}" の値が期待値と異なります (期待: ${s}, 実際: ${a})`}:{passed:!0}}case"echoRequestHeaderEquals":{const r=o[0],s=o.slice(1).join(" ");try{let a=t.body;if(typeof a=="string")try{a=JSON.parse(a)}catch{return{passed:!1,error:"レスポンスボディのJSONパースに失敗しました"}}if(typeof a=="object"&&a.headers){const i=a.headers,l=r.toLowerCase(),d=i[l];return d===void 0?{passed:!1,error:`エコーされたリクエストヘッダー "${r}" が見つかりません`}:d!==s?{passed:!1,error:`エコーされたヘッダー "${r}" の値が期待値と異なります (期待: ${s}, 実際: ${d})`}:{passed:!0}}else return{passed:!1,error:"レスポンスボディにheaders情報が含まれていません"}}catch(a){return{passed:!1,error:`レスポンスボディの解析に失敗しました: ${a}`}}}case"echoRequestHeaderContains":{const r=o[0],s=o.slice(1).join(" ");try{let a=t.body;if(typeof a=="string"&&(a=JSON.parse(a)),typeof a=="object"&&a.headers){const i=a.headers,l=r.toLowerCase(),d=i[l];if(d===void 0)return{passed:!1,error:`エコーされたリクエストヘッダー "${r}" が見つかりません`};if(l==="cookie"){const u=d.split(";").map(m=>m.trim()).filter(m=>m.length>0),f=s.split(";").map(m=>m.trim()).filter(m=>m.length>0).filter(m=>!u.includes(m));return f.length===0?{passed:!0}:{passed:!1,error:`Cookie ヘッダーに以下のペアが含まれていません: ${f.join(", ")} (実際: ${d})`}}return d.includes(s)?{passed:!0}:{passed:!1,error:`エコーされたヘッダー "${r}" に "${s}" が含まれていません (実際: ${d})`}}else return{passed:!1,error:"レスポンスボディに headers 情報が含まれていません"}}catch(a){return{passed:!1,error:`レスポンスボディの解析に失敗しました: ${a}`}}}case"echoRequestMethodEquals":{const r=o[0];try{let s=t.body;if(typeof s=="string")try{s=JSON.parse(s)}catch{return{passed:!1,error:"レスポンスボディのJSONパースに失敗しました"}}if(typeof s=="object"&&s.method){const a=s.method;return a!==r?{passed:!1,error:`エコーされたメソッド "${a}" が期待値 "${r}" と異なります`}:{passed:!0}}else return{passed:!1,error:"レスポンスボディにmethod情報が含まれていません"}}catch(s){return{passed:!1,error:`レスポンスボディの解析に失敗しました: ${s}`}}}case"echoRequestBodyEquals":{const r=o.join(" ");try{let s=t.body;if(typeof s=="string")try{s=JSON.parse(s)}catch{return{passed:!1,error:"レスポンスボディのJSONパースに失敗しました"}}if(typeof s=="object"&&s.body!==void 0){const a=s.body;return a!==r?{passed:!1,error:`エコーされたボディが期待値と異なります
期待: ${r}
実際: ${a}`}:{passed:!0}}else return{passed:!1,error:"レスポンスボディにbody情報が含まれていません"}}catch(s){return{passed:!1,error:`レスポンスボディの解析に失敗しました: ${s}`}}}case"echoRequestUrlContains":{const r=o.join(" ");try{let s=t.body;if(typeof s=="string")try{s=JSON.parse(s)}catch{return{passed:!1,error:"レスポンスボディのJSONパースに失敗しました"}}if(typeof s=="object"&&s.url){const a=s.url;return a.includes(r)?{passed:!0}:{passed:!1,error:`エコーされたURL "${a}" に "${r}" が含まれていません`}}else return{passed:!1,error:"レスポンスボディにURL情報が含まれていません"}}catch(s){return{passed:!1,error:`レスポンスボディの解析に失敗しました: ${s}`}}}case"bodyJsonPathEquals":{if(o.length<2)return{passed:!1,error:"bodyJsonPathEquals requires JSONPath and expected value"};const r=o[0],s=o.slice(1).join(" ");try{let a;if(typeof t.body=="string")try{a=JSON.parse(t.body)}catch{return{passed:!1,error:"レスポンスボディが有効なJSONではありません"}}else if(typeof t.bodyText=="string")try{a=JSON.parse(t.bodyText)}catch{return{passed:!1,error:"レスポンスボディが有効なJSONではありません"}}else a=t.body;if(!a)return{passed:!1,error:"レスポンスボディが空です"};const i=T({path:r,json:a});if(!Array.isArray(i)||i.length===0)return{passed:!1,error:`JSONPath "${r}" に一致する値が見つかりません`};const l=i[0],d=String(l),u=String(s);return d!==u?{passed:!1,error:`JSONPath "${r}" の値が期待値と異なります
期待: ${u}
実際: ${d}`}:{passed:!0}}catch(a){return{passed:!1,error:`JSONPath "${r}" の評価中にエラーが発生しました: ${a.message}`}}}default:return{passed:!1,error:`Unknown test command: ${n}`}}}function yo(e,t){if(!e)return t;const n=e.split(`
`);for(const o of n){const r=o.trim();if(!r||r.startsWith("//"))continue;const s=r.indexOf(" ");if(s===-1){console.warn(`Invalid command format: ${r}`);continue}const a=r.substring(0,s),i=r.substring(s+1).trim();console.log("Executing command:",a,i);try{switch(a){case"setBody":if(!i){E("setBody requires a body content");continue}if(Array.isArray(t.body)&&t.body.some(h=>h.type==="file")||t.bodyType==="binary"&&t.body instanceof File){console.warn("⚠️ setBody: Request contains file data. setBody command will be ignored to preserve file data."),E("setBody command ignored: Request contains file data");continue}t.body=i,!t.headers["Content-Type"]&&!t.headers["content-type"]&&(t.headers["Content-Type"]="application/json");break;case"removeHeader":if(!i){E("removeHeader requires a header name");continue}const l=i.toLowerCase();Object.keys(t.headers).forEach(h=>{h.toLowerCase()===l&&delete t.headers[h]});break;case"setUrl":if(!i){console.warn("setUrl requires a URL");continue}t.url=i;break;case"setUrlWithVar":if(!i){console.warn("setUrlWithVar requires a variable name");continue}const d=W(i);if(d===void 0)throw new Error(`変数「${i}」が変数ではありません`);t.url=d;break;case"addHeader":if(!i){console.warn("addHeader requires a header name and value");continue}const u=i.indexOf(" ");if(u===-1){console.warn("addHeader requires both header name and value");continue}const y=i.substring(0,u),f=i.substring(u+1).trim();t.headers[y]=f;break;case"addHeaderWithVar":if(!i){E("addHeaderWithVar requires a header name and variable name");continue}const m=i.indexOf(" ");if(m===-1){E("addHeaderWithVar requires both header name and variable name");continue}const g=i.substring(0,m),p=i.substring(m+1).trim();try{const h=ut(p);t.headers[g]=String(h)}catch(h){E(h.message);continue}break;case"setBodyWithVar":if(!i){E("setBodyWithVar requires a variable name");continue}if(Array.isArray(t.body)&&t.body.some(h=>h.type==="file")||t.bodyType==="binary"&&t.body instanceof File){console.warn("⚠️ setBodyWithVar: Request contains file data. setBodyWithVar command will be ignored to preserve file data."),E("setBodyWithVar command ignored: Request contains file data");continue}try{const h=ut(i);t.body=String(h)}catch(h){E(h.message);continue}break;default:console.warn(`Unknown command: ${a}`)}}catch(l){throw console.error("Pre-request script 実行エラー:",l),E(`Pre-request script 実行エラー: ${l.message}`),l}}return t}function ge(e){const t=document.getElementById("response-tests");if(e.length===0){t.innerHTML='<p class="empty-message">No tests executed</p>';return}const n=e.filter(s=>s.passed).length,o=e.filter(s=>!s.passed).length;let r=`<div class="test-summary"><span class="test-passed">✓ ${n} passed</span><span class="test-failed">✗ ${o} failed</span></div><div class="test-results">`;e.forEach(s=>{r+=`<div class="test-result ${s.passed?"passed":"failed"}"><span class="test-icon">${s.passed?"✓":"✗"}</span><span class="test-name">${N(s.name)}</span>${s.error?`<span class="test-error">${N(s.error)}</span>`:""}</div>`}),r+="</div>",t.innerHTML=r}function fo(e){let t={...e};if(e.bodyType==="binary"&&typeof e.body=="string")try{const r=JSON.parse(e.body);if(r.type==="binaryFile"&&r.base64Data){const s=le(r.base64Data,r.fileName,r.fileType);t={...e,body:s},console.log("🔍 [processVariables] Binary file restored from Base64:",{name:r.fileName,size:r.fileSize,type:r.fileType})}}catch(r){console.error("🔍 [processVariables] Failed to restore binary file:",r)}const n=Array.isArray(t.body)&&t.body.some(r=>r.type==="file"&&(r.file||r.fileContent))||t.bodyType==="binary"&&t.body instanceof File;let o;if(n?(console.log("🔍 [processVariables] File objects detected, using manual clone"),o={...t,headers:{...t.headers},params:{...t.params},auth:{...t.auth},body:Array.isArray(t.body)?t.body.map(r=>{if(r.type==="file"&&r.fileContent&&!r.file)try{const s=le(r.fileContent,r.fileName,r.fileType);return{...r,file:s}}catch(s){return console.error("Failed to restore file from base64:",s),r}return r}):t.body}):(console.log("🔍 [processVariables] No file objects, using JSON clone"),o=JSON.parse(JSON.stringify(t))),o.url=M(o.url),!o.url||!o.url.trim())throw new Error("URL is required");try{const r=new URL(o.url);switch(o.params=ce(o.params),Object.entries(o.params).forEach(([s,a])=>{r.searchParams.set(s,String(a))}),o.auth.type==="apikey"&&o.auth.addTo==="query"&&o.auth.key&&o.auth.value&&r.searchParams.set(o.auth.key,o.auth.value),o.url=r.toString(),o.headers=ce(o.headers),o.auth.type){case"basic":o.auth.username&&(o.auth.username=M(o.auth.username)),o.auth.password&&(o.auth.password=M(o.auth.password));break;case"bearer":o.auth.token&&(o.auth.token=M(o.auth.token));break;case"apikey":o.auth.key&&(o.auth.key=M(o.auth.key)),o.auth.value&&(o.auth.value=M(o.auth.value));break}o.body&&(typeof o.body=="string"?o.body=M(o.body):n?(console.log("🔍 [processVariables] Skipping variable replacement for body with files"),Array.isArray(o.body)&&(o.body=o.body.map(s=>s.type==="file"?s:{...s,value:s.value?M(s.value):s.value}))):o.body=ce(o.body))}catch{throw new Error(`Invalid URL: ${o.url}`)}return o}async function ho(e,t,n=[]){await vt(e,t,n)}async function go(){const e=c.currentRequest;if(!e||!e.id){E("No request to save.");return}try{const t=document.getElementById("methodSelect"),n=document.getElementById("nameInput"),o=document.getElementById("urlInput");e.method=t.value,e.name=n.value.trim(),e.url=o.value.trim();const r=document.querySelectorAll("#headersContainer .key-value-row"),s={};r.forEach(f=>{const m=f,g=m.querySelector(".key-input"),p=m.querySelector(".value-input"),h=g.value.trim(),v=p.value.trim();h&&(s[h]=v)}),e.headers=s;const a=document.querySelectorAll("#paramsContainer .key-value-row");console.log("saveCurrentRequest: Found param rows:",a.length);const i={};a.forEach((f,m)=>{const g=f,p=g.querySelector(".key-input"),h=g.querySelector(".value-input"),v=p.value.trim(),b=h.value.trim();console.log(`saveCurrentRequest: Row ${m}: ${v} = ${b}`),v&&(i[v]=b)}),console.log("saveCurrentRequest: New params object:",i),e.params=i;const l=document.querySelector('input[name="bodyType"]:checked');switch(e.bodyType=l.value,e.bodyType){case"raw":e.body=document.getElementById("rawBody").value;break;case"json":e.body=document.getElementById("jsonBody").value;break;case"form-data":e.body=await Zt("formDataFieldsContainer");break;case"urlencoded":e.body=te("urlEncodedContainer");break;case"binary":const f=await en("binaryFileInput");e.body=f;break;default:e.body=null}const d=document.getElementById("authType");if(e.auth={type:d.value},d.value==="basic"){const f=document.getElementById("authUsername"),m=document.getElementById("authPassword");e.auth.username=f.value,e.auth.password=m.value}else if(d.value==="bearer"){const f=document.getElementById("authToken");e.auth.token=f.value}else if(d.value==="apikey"){const f=document.getElementById("authKey"),m=document.getElementById("authValue"),g=document.getElementById("authAddTo");e.auth.key=f.value,e.auth.value=m.value,e.auth.addTo=g.value}const u=document.getElementById("preRequestScript"),y=document.getElementById("testScript");if(e.preRequestScript=(u==null?void 0:u.value)||"",e.testScript=(y==null?void 0:y.value)||"",console.log("保存するリクエスト:",e),console.log("保存するテストスクリプト:",e.testScript),c.currentCollection){const f=c.collections.find(m=>m.id===c.currentCollection);if(f&&f.requests){const m=f.requests.findIndex(g=>g.id===e.id);if(m!==-1){f.requests[m]=JSON.parse(JSON.stringify(e)),await $(),S("Request saved to collection.");return}}}if(c.currentScenario){const f=c.scenarios.find(m=>m.id===c.currentScenario);if(f&&f.requests){const m=f.requests.findIndex(g=>g.id===e.id);if(m!==-1){f.requests[m]=JSON.parse(JSON.stringify(e)),await R(),S("Request saved to scenario.");return}}}S("Request saved.")}catch(t){console.error("Error saving request:",t),E("Failed to save request: "+t.message)}}function ut(e){console.log("🔍 [getValueFromVarString] Processing variable string:",e);try{const t=W(e);if(t===void 0)throw new Error(`変数「${e}」が見つかりません`);return console.log("🔍 [getValueFromVarString] Resolved value:",t),t}catch(t){throw console.error("🔍 [getValueFromVarString] Error resolving variable:",t),new Error(`変数解析エラー: ${t.message}`)}}async function Tt(){try{const e=await chrome.storage.local.get(["scenarios"]);e.scenarios&&c.scenarios.splice(0,c.scenarios.length,...e.scenarios),Z();const{renderScenariosTree:t}=await A(async()=>{const{renderScenariosTree:n}=await Promise.resolve().then(()=>Te);return{renderScenariosTree:n}},void 0);t()}catch(e){console.error("Error initializing scenarios:",e)}}function Z(){const e=document.getElementById("scenarioList");e.innerHTML="",c.scenarios.forEach(t=>{const n=document.createElement("li");n.textContent=t.name,n.dataset.id=t.id,c.currentScenario===t.id&&n.classList.add("active"),n.addEventListener("click",()=>Xe(t.id)),e.appendChild(n)})}function Xe(e){c.currentScenario=e,Z();const t=c.scenarios.find(r=>r.id===e),n=document.getElementById("scenarioTitle");n.textContent=t?t.name:"",de(e);const o=document.getElementById("runScenarioBtn");o.disabled=!1}async function Ft(e,t){const n=c.scenarios.find(a=>a.id===e);if(!n){E("Scenario not found.");return}const o=prompt("Insert request ID from any collection:");if(!o)return;let r=null;for(const a of c.collections){if(!a.requests)continue;const i=a.requests.find(l=>String(l.id)===o);if(i){r=i;break}}if(!r){E("Request ID not found in any collection.");return}const s=JSON.parse(JSON.stringify(r));s.id=`req_${Date.now()}_${Math.random().toString(36).substring(2)}`,n.requests.splice(t,0,s),await R(),S(`Inserted "${s.name}" at position ${t+1}`),de(e)}function de(e){const t=document.getElementById("scenarioRequestsList");t.innerHTML="";const n=c.scenarios.find(o=>o.id===e);if(!n||!n.requests.length){const o=document.createElement("li");o.textContent="No requests in this scenario.",t.appendChild(o);return}n.requests.forEach((o,r)=>{const s=document.createElement("li");s.className="scenario-request-item";const a=document.createElement("span");a.className="req-name",a.textContent=o.name||"Untitled Request",s.appendChild(a);const i=document.createElement("button");i.textContent="Load",i.title="Load this request into editor",i.addEventListener("click",()=>{const f=c.scenarios.find(m=>m.id===c.currentScenario);if(f&&f.requests){const m=f.requests.findIndex(g=>g.id===o.id);m!==-1&&Y(f.requests[m])}}),s.appendChild(i);const l=document.createElement("button");l.textContent="↑",l.title="Move up",l.disabled=r===0,l.addEventListener("click",()=>{dt(e,r,r-1)}),s.appendChild(l);const d=document.createElement("button");d.textContent="↓",d.title="Move down",d.disabled=r===n.requests.length-1,d.addEventListener("click",()=>{dt(e,r,r+1)}),s.appendChild(d);const u=document.createElement("button");u.textContent="+",u.title="Insert a request here",u.addEventListener("click",()=>{Ft(e,r)}),s.appendChild(u);const y=document.createElement("button");y.textContent="×",y.title="Delete this request",y.addEventListener("click",()=>{vo(e,r)}),s.appendChild(y),t.appendChild(s)})}async function dt(e,t,n){const o=c.scenarios.find(s=>s.id===e);if(!o)return;const[r]=o.requests.splice(t,1);o.requests.splice(n,0,r),await R(),de(e)}async function vo(e,t){const n=c.scenarios.find(o=>o.id===e);n&&(n.requests.splice(t,1),await R(),de(e))}async function kt(){const e=prompt("Enter scenario name:");if(!e)return;const t=`scenario_${Date.now()}_${Math.random().toString(36).substring(2)}`,n={id:t,name:e,requests:[]};c.scenarios.push(n),await R(),Xe(t),Z()}async function bo(){const e=prompt("Enter scenario name:");if(!e)return;const t={id:`scenario_${Date.now()}`,name:e,requests:[]};c.scenarios.push(t),await R(),Z();const{renderScenariosTree:n}=await A(async()=>{const{renderScenariosTree:o}=await Promise.resolve().then(()=>Te);return{renderScenariosTree:o}},void 0);n(),S("Scenario created: "+e)}async function qt(e){if(!c.currentScenario){E("Please select a scenario first.");return}const t=c.scenarios.find(r=>r.id===c.currentScenario);if(!t)return;const n=JSON.parse(JSON.stringify(e));n.id=`req_${Date.now()}_${Math.random().toString(36).substring(2)}`,t.requests.push(n),await R(),de(c.currentScenario);const{renderScenariosTree:o}=await A(async()=>{const{renderScenariosTree:r}=await Promise.resolve().then(()=>Te);return{renderScenariosTree:r}},void 0);o()}async function Bt(){if(!c.currentScenario){E("No scenario selected.");return}const e=c.scenarios.find(n=>n.id===c.currentScenario);if(!e||!e.requests.length){E("Scenario has no requests.");return}const t=document.getElementById("scenarioResultContainer");t.innerHTML="";for(let n=0;n<e.requests.length;n++){const o=e.requests[n],r=document.createElement("div");r.className="result-item",r.textContent=`Executing ${n+1}/${e.requests.length}: ${o.name}`,t.appendChild(r);try{const s=await St(o,!0);if(typeof s=="string"){r.textContent=`[${n+1}] ${o.name} → ERROR: ${s}`;continue}if("response"in s&&"testResults"in s){const{response:a,testResults:i}=s;r.textContent=`[${n+1}] ${o.name} → ${a.status} ${a.statusText}`;const l=document.createElement("pre");if(l.textContent=a.bodyText,l.style.maxHeight="200px",l.style.overflow="auto",r.appendChild(l),i&&i.length>0){const d=document.createElement("div");d.style.marginTop="8px";const u=i.filter(f=>f.passed).length,y=i.filter(f=>!f.passed).length;if(d.innerHTML=`<strong>Tests: ${u} passed, ${y} failed</strong>`,y>0){const f=i.filter(g=>!g.passed),m=document.createElement("ul");m.style.color="#dc3545",m.style.fontSize="12px",f.forEach(g=>{const p=document.createElement("li");p.textContent=`${g.name}: ${g.error||"Failed"}`,m.appendChild(p)}),d.appendChild(m)}r.appendChild(d)}}else r.textContent=`[${n+1}] ${o.name} → ${s.status} ${s.statusText}`}catch(s){r.textContent=`[${n+1}] ${o.name} → ERROR: ${s.message}`}}S("Scenario execution completed.")}const Ct=Object.freeze(Object.defineProperty({__proto__:null,addRequestToScenario:qt,createNewScenario:bo,initializeScenarios:Tt,insertRequestIntoScenario:Ft,newScenario:kt,renderScenarioList:Z,renderScenarioRequests:de,runScenario:Bt,selectScenario:Xe},Symbol.toStringTag,{value:"Module"}));async function xt(){try{const e=await chrome.storage.local.get(["collections"]);e.collections&&c.collections.splice(0,c.collections.length,...e.collections),O(),pe(),V()}catch(e){console.error("Error initializing collections:",e)}}async function $t(e){c.currentCollection=e,await Ae(),document.querySelectorAll(".collection-item").forEach(n=>{const o=n;o.classList.toggle("active",o.dataset.id==e)});const t=document.getElementById("collectionVarSelect");t&&(t.value=e,j("collection"))}function Ye(){return`req_${Date.now()}_${Math.random().toString(36).substring(2)}`}async function Rt(e){const t=c.collections.find(r=>r.id===e);if(!t)return;const n=prompt("リクエスト名を入力してください:");if(!n)return;const o={id:Ye(),name:n,method:"GET",url:"",headers:{},params:{},body:null,auth:{type:"none"},preRequestScript:"",bodyType:"none"};t.requests.push(o),await $(),O(),c.currentRequest=o,Y(o)}async function It(e){const t=c.collections.find(n=>{var o;return(o=n.requests)==null?void 0:o.some(r=>r.id===e.id)});if(t){await $t(t.id);const n=t.requests.find(o=>o.id===e.id);if(n){console.log("Loading latest request data:",n),Y(n),S("Request loaded from collection");return}}Y(e),S("Request loaded from collection")}function _t(){const e=prompt("Enter collection name:");if(!e)return;const t={id:Date.now().toString(),name:e,requests:[]};c.collections.push(t),chrome.storage.local.set({collections:c.collections}),O(),V(),S("Collection created: "+e)}async function Eo(e){if(!confirm("本当にこのコレクションを削除しますか？"))return;const t=c.collections.findIndex(n=>n.id==e);t!==-1&&(c.collections.splice(t,1),await $(),c.currentCollection==e&&(c.currentCollection=null,await Ae()),O(),S("コレクションを削除しました"))}async function wo(e,t){if(!confirm("本当にこのリクエストを削除しますか？"))return;const n=c.collections.find(o=>o.id==e);!n||!n.requests||!n.requests.some(o=>o.id===t)||(n.requests=n.requests.filter(o=>o.id!==t),await $(),O(),S("リクエストを削除しました"))}function O(){const e=document.getElementById("collectionsTree");e&&(e.innerHTML="",c.collections.forEach(t=>{var d;const n=document.createElement("div");n.className="collection-item",n.dataset.id=t.id;const o=document.createElement("span");o.className="toggle-icon",o.textContent="▶",n.appendChild(o);const r=document.createElement("span");r.className="collection-icon",r.textContent="📁",n.appendChild(r);const s=document.createElement("span");s.className="collection-name",s.textContent=t.name,n.appendChild(s);const a=document.createElement("span");a.className="menu-btn",a.textContent="⋮",a.addEventListener("click",u=>{u.stopPropagation();const y=a.getBoundingClientRect();Ie(y.left,y.top,[{text:"リクエストを追加",icon:"🌱",action:()=>Rt(t.id)},{text:"コレクションを削除",icon:"🗑️",action:()=>Eo(t.id)}])}),n.appendChild(a),e.appendChild(n);const i=document.createElement("ul");i.className="request-list";const l=((d=c.sidebarState)==null?void 0:d.expandedCollections.has(t.id))||!1;if(i.style.display=l?"block":"none",l&&(o.textContent="▼"),t.requests&&t.requests.length>0)t.requests.forEach(u=>{const y=document.createElement("li");y.className="request-item",y.innerHTML=`
                    <span class="method-badge method-${u.method}">${u.method}</span>
                    <span class="request-name">${u.name}</span>
                    <span class="menu-btn">⋮</span>
                `,y.addEventListener("click",m=>{m.target.classList.contains("menu-btn")||(m.stopPropagation(),It(u))});const f=y.querySelector(".menu-btn");f==null||f.addEventListener("click",m=>{m.stopPropagation();const g=m.target.getBoundingClientRect();Ie(g.left,g.top,[{text:"リクエストをコピー",icon:"📋",action:()=>Fo(u,t.id)},{text:"リクエストを移動",icon:"📁",action:()=>qo(u,t.id)},{text:"シナリオに追加",icon:"🌱",action:()=>qt(u)},{text:"リクエストを削除",icon:"🗑️",action:()=>wo(t.id,u.id)}])}),i.appendChild(y)});else{const u=document.createElement("li");u.className="request-item empty-message",u.textContent="No requests",i.appendChild(u)}e.appendChild(i),n.addEventListener("click",async()=>{var u,y;if(i.style.display==="none"){i.style.display="block",o.textContent="▼",(u=c.sidebarState)==null||u.expandedCollections.add(t.id),await Se(),document.querySelectorAll(".collection-item").forEach(m=>{const g=m;g.classList.toggle("active",g.dataset.id==t.id)}),c.currentCollection=t.id,Ae();const f=document.getElementById("collectionVarSelect");f&&(f.value=t.id,j("collection"))}else i.style.display="none",o.textContent="▶",(y=c.sidebarState)==null||y.expandedCollections.delete(t.id),await Se()})}))}function pe(){const e=document.getElementById("scenariosTree");e&&(e.innerHTML="",c.scenarios.forEach(t=>{var d;const n=document.createElement("div");n.className="scenario-item",n.dataset.id=t.id;const o=document.createElement("span");o.className="toggle-icon",o.textContent="▶",n.appendChild(o);const r=document.createElement("span");r.className="scenario-icon",r.textContent="🎬",n.appendChild(r);const s=document.createElement("span");s.className="scenario-name",s.textContent=t.name,n.appendChild(s);const a=document.createElement("span");a.className="menu-btn",a.textContent="⋮",a.addEventListener("click",u=>{u.stopPropagation();const y=a.getBoundingClientRect();Ie(y.left,y.top,[{text:"シナリオを編集",icon:"✏️",action:()=>{c.currentScenario=t.id,we(),Fe("scenarios")}},{text:"シナリオを削除",icon:"🗑️",action:()=>So(t.id)}])}),n.appendChild(a),e.appendChild(n);const i=document.createElement("ul");i.className="request-list";const l=((d=c.sidebarState)==null?void 0:d.expandedScenarios.has(t.id))||!1;if(i.style.display=l?"block":"none",l&&(o.textContent="▼"),t.requests&&t.requests.length>0)t.requests.forEach(u=>{const y=document.createElement("li");y.className="request-item",y.innerHTML=`
                    <span class="method-badge method-${u.method}">${u.method}</span>
                    <span class="request-name">${u.name}</span>
                    <span class="menu-btn">⋮</span>
                `,y.addEventListener("click",m=>{m.target.classList.contains("menu-btn")||(m.stopPropagation(),pt(u,t.id))});const f=y.querySelector(".menu-btn");f==null||f.addEventListener("click",m=>{m.stopPropagation();const g=m.target.getBoundingClientRect();Ie(g.left,g.top,[{text:"リクエストをコピー",icon:"📋",action:()=>ko(u,t.id)},{text:"リクエストを移動",icon:"📁",action:()=>Bo(u,t.id)},{text:"リクエストを編集",icon:"✏️",action:()=>pt(u,t.id)},{text:"シナリオから削除",icon:"🗑️",action:()=>To(t.id,u.id)}])}),i.appendChild(y)});else{const u=document.createElement("li");u.className="request-item empty-message",u.textContent="No requests",i.appendChild(u)}e.appendChild(i),n.addEventListener("click",async()=>{var u,y;i.style.display==="none"?(i.style.display="block",o.textContent="▼",(u=c.sidebarState)==null||u.expandedScenarios.add(t.id),await Se(),document.querySelectorAll(".scenario-item").forEach(f=>{const m=f;m.classList.toggle("active",m.dataset.id==t.id)}),c.currentScenario=t.id,we()):(i.style.display="none",o.textContent="▶",(y=c.sidebarState)==null||y.expandedScenarios.delete(t.id),await Se())})}))}async function pt(e,t){c.currentScenario=t,await we();const n=c.scenarios.find(o=>o.id===t);if(n&&n.requests){const o=n.requests.find(r=>r.id===e.id);if(o){console.log("Loading latest scenario request data:",o),Y(o),S("Request loaded from scenario");return}}Y(e),S("Request loaded from scenario")}async function So(e){if(!confirm("本当にこのシナリオを削除しますか？"))return;const t=c.scenarios.findIndex(n=>n.id==e);t!==-1&&(c.scenarios.splice(t,1),await R(),c.currentScenario==e&&(c.currentScenario=null,await we()),pe(),S("シナリオを削除しました"))}async function To(e,t){if(!confirm("本当にこのリクエストをシナリオから削除しますか？"))return;const n=c.scenarios.find(o=>o.id==e);!n||!n.requests||!n.requests.some(o=>o.id===t)||(n.requests=n.requests.filter(o=>o.id!==t),await R(),pe(),S("リクエストをシナリオから削除しました"))}function Ie(e,t,n){const o=document.querySelector(".context-menu");o&&o.remove();const r=document.createElement("div");r.className="context-menu",r.style.position="fixed",r.style.left=`${e}px`,r.style.top=`${t}px`,n.forEach(a=>{const i=document.createElement("div");i.className="context-menu-item",i.innerHTML=`<span class="menu-icon">${a.icon}</span>${a.text}`,i.addEventListener("click",()=>{a.action(),r.remove()}),r.appendChild(i)}),document.body.appendChild(r);const s=a=>{r.contains(a.target)||(r.remove(),document.removeEventListener("click",s))};document.addEventListener("click",s)}async function Fo(e,t){const n=c.collections.find(r=>r.id===t);if(!n)return;const o={...JSON.parse(JSON.stringify(e)),id:Ye(),name:`${e.name} (Copy)`};delete o.lastRequestExecution,delete o.lastResponseExecution,n.requests.push(o),await $(),O(),S(`"${e.name}" をコピーしました`)}async function ko(e,t){const n=c.scenarios.find(r=>r.id===t);if(!n)return;const o={...JSON.parse(JSON.stringify(e)),id:Ye(),name:`${e.name} (Copy)`};delete o.lastRequestExecution,delete o.lastResponseExecution,n.requests.push(o),await R(),pe(),S(`"${e.name}" をシナリオ内でコピーしました`)}async function qo(e,t){const n=c.collections.filter(l=>l.id!==t);if(n.length===0){E("移動先のコレクションがありません。");return}const o=n.map(l=>l.name),r=prompt(`"${e.name}" を移動するコレクションを選択してください:

${o.map((l,d)=>`${d+1}. ${l}`).join(`
`)}

番号を入力してください:`);if(!r)return;const s=parseInt(r,10)-1;if(isNaN(s)||s<0||s>=n.length){E("無効な番号です");return}const a=n[s],i=c.collections.find(l=>l.id===t);i&&(i.requests=i.requests.filter(l=>l.id!==e.id),a.requests.push(e),await $(),O(),S(`"${e.name}" を "${a.name}" に移動しました`))}async function Bo(e,t){const n=c.scenarios.filter(l=>l.id!==t);if(n.length===0){E("移動先のシナリオがありません。");return}const o=n.map(l=>l.name),r=prompt(`"${e.name}" を移動するシナリオを選択してください:

${o.map((l,d)=>`${d+1}. ${l}`).join(`
`)}

番号を入力してください:`);if(!r)return;const s=parseInt(r,10)-1;if(isNaN(s)||s<0||s>=n.length){E("無効な番号です");return}const a=n[s],i=c.scenarios.find(l=>l.id===t);i&&(i.requests=i.requests.filter(l=>l.id!==e.id),a.requests.push(e),await R(),pe(),S(`"${e.name}" を "${a.name}" に移動しました`))}const Te=Object.freeze(Object.defineProperty({__proto__:null,addRequestToCollection:Rt,createNewCollection:_t,initializeCollections:xt,loadCollectionRequest:It,renderCollectionsTree:O,renderScenariosTree:pe,selectCollection:$t},Symbol.toStringTag,{value:"Module"}));let _e=!1;function Co(){if(_e)return;const e=$o();chrome.runtime.sendMessage({action:"startInterceptor",filters:e},t=>{if(t!=null&&t.success){_e=!0;const n=document.getElementById("startInterceptorBtn"),o=document.getElementById("stopInterceptorBtn");n.disabled=!0,o.disabled=!1,S("Interceptor started")}}),chrome.runtime.onMessage.addListener(Dt)}function xo(){_e&&(chrome.runtime.sendMessage({action:"stopInterceptor"},e=>{if(e!=null&&e.success){_e=!1;const t=document.getElementById("startInterceptorBtn"),n=document.getElementById("stopInterceptorBtn");t.disabled=!1,n.disabled=!0,S("Interceptor stopped")}}),chrome.runtime.onMessage.removeListener(Dt))}function $o(){const e=[];document.querySelectorAll(".method-filters input:checked").forEach(o=>{const r=o;e.push(r.value)});const n=document.getElementById("domainFilter").value.trim();return{methods:e,domain:n}}function Dt(e){e.action==="requestIntercepted"&&e.request&&Ro(e.request)}function Ro(e){const t=document.getElementById("interceptorContainer"),n=document.createElement("div");for(n.className="intercepted-request",n.innerHTML=`
        <span class="history-method method-${e.method}">${e.method}</span>
        <span class="history-url">${N(e.url)}</span>
        <span class="history-status status-${(e.status||0)<400?"success":"error"}">${e.status||"Pending"}</span>
        <span class="history-time">${new Date().toLocaleTimeString()}</span>
    `,n.addEventListener("click",()=>{Io(e)}),t.insertBefore(n,t.firstChild);t.children.length>50;){const o=t.lastChild;o&&t.removeChild(o)}}async function Io(e){const t={id:`intercepted_${Date.now()}_${Math.random().toString(36).substring(2)}`,name:`Intercepted ${e.method} Request`,method:e.method,url:e.url,headers:e.headers||{},params:{},body:e.body||null,bodyType:"none",auth:{type:"none"},preRequestScript:""};Y(t),S("Request loaded from interceptor")}function Lt(){const e=document.getElementById("testScript");e&&!e.value.trim()&&(e.value=hn)}function Ot(){const e=document.getElementById("importExportModal"),t=document.getElementById("modalTitle");e.classList.add("active"),t.textContent="Import Data"}function ze(e){var r;const n=(r=e.target.files)==null?void 0:r[0];if(!n)return;const o=new FileReader;o.onload=function(s){var i;const a=document.getElementById("importText");a.value=(i=s.target)==null?void 0:i.result},o.readAsText(n)}async function Pt(){const e=document.getElementById("importType"),t=document.getElementById("importText"),n=e.value,o=t.value.trim();if(!o&&n!=="sample"){E("Please select a file or paste content to import");return}try{let r;if(n!=="sample")try{r=JSON.parse(o)}catch{if(n==="curl")r=jt(o);else throw new Error("Invalid JSON format")}switch(n){case"postman":await Do(r);break;case"apitester":await Lo(r);break;case"openapi":await Po(r);break;case"har":await Ao(r);break;case"curl":Mt(r);break;case"talentedapitester":await Nt(r);break;case"sample":await Ht();break}document.getElementById("importExportModal").classList.remove("active"),S("Import completed successfully")}catch(r){E("Import failed: "+r.message)}}function _o(e){var n,o,r;const t={type:e.type||"none"};switch(e.type){case"basic":const s=(n=e.basic)==null?void 0:n.reduce((l,d)=>(l[d.key]=d.value,l),{});t.username=(s==null?void 0:s.username)||"",t.password=(s==null?void 0:s.password)||"";break;case"bearer":const a=(o=e.bearer)==null?void 0:o.reduce((l,d)=>(l[d.key]=d.value,l),{});t.token=(a==null?void 0:a.token)||"";break;case"apikey":const i=(r=e.apikey)==null?void 0:r.reduce((l,d)=>(l[d.key]=d.value,l),{});t.key=(i==null?void 0:i.key)||"",t.value=(i==null?void 0:i.value)||"",t.addTo=(i==null?void 0:i.in)==="query"?"query":"header";break}return t}function At(e,t=""){const n=[];return e.forEach(o=>{var r,s;if(o.request){const a={id:`req_${Date.now()}_${Math.random().toString(36).substring(2)}`,name:o.name||"Untitled Request",method:o.request.method||"GET",url:typeof o.request.url=="string"?o.request.url:((r=o.request.url)==null?void 0:r.raw)||"",headers:{},params:{},body:null,bodyType:"none",auth:{type:"none"},preRequestScript:""};if(o.request.header&&o.request.header.forEach(i=>{i.disabled||(a.headers[i.key]=i.value)}),typeof o.request.url=="object"&&o.request.url.query&&o.request.url.query.forEach(i=>{i.disabled||(a.params[i.key]=i.value)}),o.request.body)switch(o.request.body.mode){case"raw":a.body=o.request.body.raw||null;break;case"formdata":const i={};(s=o.request.body.formdata)==null||s.forEach(l=>{l.disabled||(i[l.key]=l.value)}),a.body=i;break}o.request.auth&&(a.auth=_o(o.request.auth)),n.push(a)}else if(o.item){const a=t?`${t}/${o.name}`:o.name||"";n.push(...At(o.item,a))}}),n}async function Do(e){var n;const t={id:`collection_${Date.now()}_${Math.random().toString(36).substring(2)}`,name:((n=e.info)==null?void 0:n.name)||"Imported Collection",requests:[]};e.item&&(t.requests=At(e.item)),e.variable&&(e.variable.forEach(o=>{o.key&&!o.disabled&&(c.variables.global[o.key]={value:o.value||"",description:o.description||""})}),await G()),c.collections.push(t),await $(),V(),O()}async function Nt(e){const t=e.entities.find(i=>i.entity.type==="Project");if(!t)throw new Error("Talend JSON に Project が見つかりません");const n=t.children||[],o=[],r=[],s=[];n.forEach(i=>{const{entity:l,children:d}=i;if(l.type==="Service"){const u=l,y=(d||[]).filter(f=>f.entity.type==="Request").map(f=>{var g,p;const m=f.entity;return{id:m.id,name:m.name,method:((g=m.method)==null?void 0:g.name)||"GET",url:((p=m.uri)==null?void 0:p.path)||"",headers:(m.headers||[]).filter(h=>h.enabled).reduce((h,v)=>(h[v.name]=v.value,h),{}),params:{},body:m.body&&m.body.textBody||null,bodyType:"none",auth:{type:"none"},preRequestScript:""}});o.push({id:u.id,name:u.name,requests:y})}else if(l.type==="Scenario"){const u=l,y=(d||[]).filter(f=>f.entity.type==="Request").map(f=>{var g,p;const m=f.entity;return{id:m.id,name:m.name,method:((g=m.method)==null?void 0:g.name)||"GET",url:((p=m.uri)==null?void 0:p.path)||"",headers:(m.headers||[]).filter(h=>h.enabled).reduce((h,v)=>(h[v.name]=v.value,h),{}),params:{},body:m.body&&m.body.textBody||null,bodyType:"none",auth:{type:"none"},preRequestScript:""}});r.push({id:u.id,name:u.name,requests:y})}}),(e.environments||[]).forEach(i=>{const l=i,d={};Object.values(l.variables||{}).forEach(u=>{u.enabled&&(d[u.name]={value:u.value,description:""})}),s.push({id:l.id,name:l.name,variables:d,created:new Date().toISOString()})}),o.length>0&&(c.collections.push(...o),await $()),Array.isArray(c.scenarios)||(c.scenarios=[]),r.length>0&&(c.scenarios.push(...r),await R()),Array.isArray(c.environments)||(c.environments=[]),c.variables.environment||(c.variables.environment={});for(const i of s)c.environments.push({id:i.id,name:i.name,variables:{...i.variables},created:i.created}),c.variables.environment[i.id]=i.variables,await chrome.storage.local.set({[`env_${i.id}`]:i.variables});s.length>0&&(await me(),await G()),V(),ne(),ke(),O(),Z()}async function Lo(e){e.collections&&c.collections.push(...e.collections),e.variables&&(Object.assign(c.variables.global,e.variables.global||{}),Object.assign(c.variables.collection,e.variables.collection||{})),e.environments&&c.environments.push(...e.environments),await $(),await G(),await me(),ne(),V(),ke(),O()}function Oo(e){return e.servers&&e.servers.length>0?e.servers[0].url:""}async function Po(e){var o;const t={id:`collection_${Date.now()}_${Math.random().toString(36).substring(2)}`,name:((o=e.info)==null?void 0:o.title)||"OpenAPI Import",requests:[]},n=Oo(e);e.paths&&Object.entries(e.paths).forEach(([r,s])=>{Object.entries(s).forEach(([a,i])=>{var l,d;if(["get","post","put","delete","patch","head","options"].includes(a)){const u={id:`req_${Date.now()}_${Math.random().toString(36).substring(2)}`,name:i.summary||`${a.toUpperCase()} ${r}`,method:a.toUpperCase(),url:n+r,headers:{},params:{},body:null,bodyType:"none",auth:{type:"none"},preRequestScript:""};if(i.parameters&&i.parameters.forEach(y=>{y.in==="query"?u.params[y.name]=y.example||"":y.in==="header"&&(u.headers[y.name]=y.example||"")}),(l=i.requestBody)!=null&&l.content){const y=i.requestBody.content["application/json"];y!=null&&y.example?u.body=JSON.stringify(y.example,null,2):(d=y==null?void 0:y.schema)!=null&&d.example&&(u.body=JSON.stringify(y.schema.example,null,2))}t.requests.push(u)}})}),c.collections.push(t),await $(),V(),O()}async function Ao(e){const t={id:`collection_${Date.now()}_${Math.random().toString(36).substring(2)}`,name:"HAR Import - "+new Date().toLocaleString(),requests:[]};e.log&&e.log.entries&&e.log.entries.forEach(n=>{const o=n.request;if(o){const r={id:`req_${Date.now()}_${Math.random().toString(36).substring(2)}`,name:`${o.method} ${new URL(o.url).pathname}`,method:o.method,url:o.url,headers:{},params:{},body:null,bodyType:"none",auth:{type:"none"},preRequestScript:""};o.headers&&o.headers.forEach(s=>{r.headers[s.name]=s.value}),o.queryString&&o.queryString.forEach(s=>{r.params[s.name]=s.value}),o.postData&&(r.body=o.postData.text||null),t.requests.push(r)}}),c.collections.push(t),await $(),V(),O()}function jt(e){const t={id:`curl_${Date.now()}_${Math.random().toString(36).substring(2)}`,name:"Curl Import",method:"GET",url:"",headers:{},params:{},body:null,bodyType:"none",auth:{type:"none"},preRequestScript:""},n=e.replace(/\\\n/g," ").replace(/\s+/g," ").trim(),o=n.match(/curl\s+(?:'([^']+)'|"([^"]+)"|(\S+))/);o&&(t.url=o[1]||o[2]||o[3]);const r=n.match(/-X\s+(\w+)/);r&&(t.method=r[1].toUpperCase());const s=/-H\s+(?:'([^']+)'|"([^"]+)")/g;let a;for(;a=s.exec(n);){const d=a[1]||a[2],[u,...y]=d.split(":");u&&y.length&&(t.headers[u.trim()]=y.join(":").trim())}const i=n.match(/(?:-d|--data)\s+(?:'([^']+)'|"([^"]+)"|(\S+))/);i&&(t.body=i[1]||i[2]||i[3]);const l=n.match(/-u\s+(?:'([^']+)'|"([^"]+)"|(\S+))/);if(l){const d=l[1]||l[2]||l[3],[u,y]=d.split(":");u&&(t.auth={type:"basic",username:u,password:y||""})}return t}function Mt(e){c.currentRequest||(c.currentRequest={id:"",name:"",method:"GET",url:"",headers:{},params:{},body:null,bodyType:"none",auth:{type:"none"},preRequestScript:""}),c.currentRequest.method=e.method,c.currentRequest.url=e.url,c.currentRequest.headers={...e.headers},c.currentRequest.params={},c.currentRequest.body=e.body||null,c.currentRequest.auth=e.auth||{type:"none"};const t=document.getElementById("headersContainer");if(t.innerHTML="",Object.entries(e.headers).forEach(([o,r])=>{C(t,"header");const s=t.querySelectorAll(".key-value-row"),a=s[s.length-1],i=a.querySelector(".key-input"),l=a.querySelector(".value-input");i.value=o,l.value=r}),Object.keys(e.headers).length===0&&C(t,"header"),e.body){const o=document.querySelector('input[name="bodyType"][value="raw"]');o.checked=!0,H({target:{value:"raw"}});const r=document.getElementById("rawBody");r.value=e.body.toString()}if(e.auth&&e.auth.type!=="none"){const o=document.getElementById("authType");o.value=e.auth.type,Oe(e.auth.type),Ee()}document.getElementById("importExportModal").classList.remove("active")}async function Vt(){const e={version:"1.0",exportDate:new Date().toISOString(),collections:c.collections,variables:{global:c.variables.global,collection:c.variables.collection},environments:c.environments,currentEnvironment:c.currentEnvironment,history:c.history.slice(0,50)},t=JSON.stringify(e,null,2),n=new Blob([t],{type:"application/json"}),o=URL.createObjectURL(n),r=document.createElement("a");r.href=o,r.download=`api-tester-export-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(o),S("Data exported successfully")}async function Ht(){try{const e=c.collections.map(i=>i.id),t=yn.filter(i=>!e.includes(i.id));t.length>0&&(c.collections.push(...t),await $()),Array.isArray(c.scenarios)||(c.scenarios=[]);const n=c.scenarios.map(i=>i.id),o=gn.filter(i=>!n.includes(i.id));o.length>0&&(c.scenarios.push(...o),await R()),c.variables||(c.variables={global:{},collection:{},environment:{}}),c.variables.global||(c.variables.global={}),Object.assign(c.variables.global,pn),Array.isArray(c.environments)||(c.environments=[]);const r=c.environments.map(i=>i.id),s=mn.filter(i=>!r.includes(i.id));s.length>0&&(c.environments.push(...s),await me()),c.variables.environment||(c.variables.environment={});for(const[i,l]of Object.entries(ct))await chrome.storage.local.set({[`env_${i}`]:l});if(!c.currentEnvironment&&s.length>0){c.currentEnvironment=s[0].id,await chrome.storage.local.set({currentEnvironment:c.currentEnvironment});const i=ct[c.currentEnvironment];i&&(c.variables.environment={...i})}c.variables.collection||(c.variables.collection={}),Object.assign(c.variables.collection,fn),await G(),ne(),V(),ke(),O(),Z();const{renderScenariosTree:a}=await A(async()=>{const{renderScenariosTree:i}=await Promise.resolve().then(()=>Te);return{renderScenariosTree:i}},void 0);a(),S("Sample data imported successfully")}catch(e){E("Failed to import sample data: "+e.message)}}const No=Object.freeze(Object.defineProperty({__proto__:null,exportData:Vt,handleFileSelect:ze,handleImport:Pt,importCurlCommand:Mt,importSampleData:Ht,importTalendData:Nt,initializeTestScript:Lt,openImportModal:Ot,parseCurlCommand:jt},Symbol.toStringTag,{value:"Module"}));function N(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}function U(e){if(e===0)return"0 B";const t=1024,n=["B","KB","MB","GB"],o=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,o)).toFixed(2))+" "+n[o]}function Qe(e,t="info"){const n=document.getElementById("notificationArea");if(!n)return;const o=document.createElement("div");o.className=`notification notification-${t}`,o.textContent=e,n.appendChild(o),setTimeout(()=>{o.classList.add("fade-out"),setTimeout(()=>o.remove(),300)},3e3)}function S(e){Qe(e,"success")}function E(e,t){const n=t?`${e}

Details: ${t}`:e;Qe(n,"error")}function zt(e,t){let n="Network request failed: ";t.name==="TypeError"&&t.message.includes("fetch")?n+="Unable to connect to the server. Please check your internet connection and verify the URL is correct.":t.message.includes("CORS")?n+="Cross-origin request blocked. The server may not allow requests from this browser extension.":t.message.includes("timeout")?n+="Request timed out. The server may be slow or unreachable.":t.message.includes("SSL")||t.message.includes("certificate")?n+="SSL/TLS error. The server certificate may be invalid or expired.":n+=t.message||"Unknown network error occurred.",E(n,`URL: ${e}
Error Type: ${t.name||"Unknown"}`)}function De(e,t){let n="Variable resolution failed: ";t.message.includes("not found")||t.message.includes("見つかりません")?n+=`Variable "${e}" was not found. Please check the variable name and ensure it exists in your environment, global, or collection variables.`:t.message.includes("JSONPath")?n+=`JSONPath expression error in "${e}". Please verify your JSONPath syntax.`:t.message.includes("構文が不正")?n+=`Invalid variable syntax in "${e}". Please check the format: \${"scenarios"."Name"."Request"."response"."property"}`:n+=t.message||"Unknown variable error occurred.",E(n,`Variable: ${e}`)}function Jt(e,t){let n="File operation failed: ";t.message.includes("too large")||t.message.includes("size")?n+=`File "${e}" is too large. Maximum file size is 10MB.`:t.message.includes("type")||t.message.includes("format")?n+=`File "${e}" has an unsupported format or is corrupted.`:t.message.includes("read")?n+=`Unable to read file "${e}". The file may be corrupted or in use by another application.`:n+=t.message||"Unknown file error occurred.",E(n,`File: ${e}`)}function Ut(e,t){let n="Storage operation failed: ";t.message.includes("QUOTA_BYTES")||t.message.includes("quota")?n+="Storage quota exceeded. Please export your data and clear some collections or history to free up space.":t.message.includes("permission")?n+="Storage permission denied. Please check browser extension permissions.":n+=`Unable to ${e}. ${t.message||"Unknown storage error occurred."}`,E(n,`Operation: ${e}`)}function C(e,t){const n=document.createElement("div");n.className="key-value-row",t==="body"&&e.id==="formDataFieldsContainer"?n.innerHTML=`
            <input type="text" placeholder="Key" class="key-input">
            <div class="value-input-container">
                <select class="value-type-select">
                    <option value="text">Text</option>
                    <option value="file">File</option>
                </select>
                <input type="text" placeholder="Value" class="value-input">
                <input type="file" class="file-input" style="display: none;">
            </div>
            <input type="text" placeholder="Description" class="description-input">
            <button type="button" class="delete-btn">×</button>
        `:n.innerHTML=`
            <input type="text" placeholder="Key" class="key-input">
            <input type="text" placeholder="Value" class="value-input">
            <input type="text" placeholder="Description" class="description-input">
            <button type="button" class="delete-btn">×</button>
        `;const o=n.querySelector(".key-input"),r=n.querySelector(".value-input"),s=n.querySelector(".delete-btn"),a=n.querySelector(".value-type-select"),i=n.querySelector(".file-input");o.addEventListener("input",async()=>await ae(t)),r.addEventListener("input",async()=>await ae(t)),s.addEventListener("click",()=>{n.remove(),ae(t)}),a&&i&&(a.addEventListener("change",()=>{a.value==="file"?(r.style.display="none",i.style.display="block",r.value=""):(r.style.display="block",i.style.display="none",i.value=""),ae(t)}),i.addEventListener("change",()=>{ae(t)})),e.appendChild(n)}function te(e){const t=document.getElementById(e);if(!t)return{};const n=t.querySelectorAll(".key-value-row"),o={};return n.forEach(r=>{const s=r.querySelector(".key-input"),a=r.querySelector(".value-input"),i=s.value.trim(),l=a.value.trim();i&&(o[i]=l)}),o}async function Ze(e){const t=document.getElementById(e);if(!t)return[];const n=t.querySelectorAll(".key-value-row"),o=Array.from(n).map(async a=>{var f,m,g;const i=a.querySelector(".key-input"),l=a.querySelector(".value-type-select"),d=a.querySelector(".value-input"),u=a.querySelector(".file-input"),y=(f=i==null?void 0:i.value)==null?void 0:f.trim();if(!y)return null;if(console.log("Collecting field:",{key:y,valueTypeSelect:l==null?void 0:l.value,hasFile:!!((m=u==null?void 0:u.files)!=null&&m[0]),textValue:d==null?void 0:d.value}),l&&l.value==="file"){const p=(g=u==null?void 0:u.files)==null?void 0:g[0];if(p)try{const h=await Wt(p);return console.log("Adding file field:",{key:y,filename:p.name,type:p.type,size:p.size,contentLength:h.length}),{key:y,type:"file",file:p,fileName:p.name,fileType:p.type,fileSize:p.size,fileContent:h}}catch(h){return console.error("Failed to convert file to base64:",h),Jt(p.name,h),{key:y,type:"file",fileName:p.name+" (conversion failed)"}}else{const h=a.querySelector("span[data-file-info]");if(h){const v=JSON.parse(h.dataset.fileInfo||"{}");if(v.fileContent){const b=le(v.fileContent,v.fileName,v.fileType);return console.log("Restored file from saved data:",v.fileName),{key:y,type:"file",file:b,fileName:v.fileName,fileType:v.fileType,fileSize:v.fileSize,fileContent:v.fileContent}}}return console.log("File field has no file selected:",y),{key:y,type:"file",fileName:"No file selected"}}}else{const p=(d==null?void 0:d.value)||"";return console.log("Adding text field:",{key:y,value:p}),{key:y,type:"text",value:p}}}),s=(await Promise.all(o)).filter(a=>a!==null);return console.log("collectFormDataWithFiles result:",s),s}function Wt(e){return new Promise((t,n)=>{if(e.size>10485760){n(new Error(`File too large: ${U(e.size)}. Maximum size is ${U(10485760)}.`));return}["text/","application/json","application/xml","application/pdf","image/","video/","audio/","application/octet-stream"].some(i=>e.type.startsWith(i))||e.type===""||console.warn(`File type ${e.type} may not be supported, but proceeding anyway.`);const a=new FileReader;a.onload=()=>{try{const i=a.result;if(!i||typeof i!="string"){n(new Error("Failed to read file content"));return}const l=i.split(",")[1];if(!l){n(new Error("Invalid file format or empty file"));return}t(l)}catch(i){n(new Error(`Failed to process file "${e.name}": ${i.message}`))}},a.onerror=()=>{n(new Error(`Failed to read file "${e.name}". The file may be corrupted or in use by another application.`))},a.readAsDataURL(e)})}function le(e,t,n){try{if(!e||typeof e!="string")throw new Error("Invalid Base64 data");const o=atob(e),r=new ArrayBuffer(o.length),s=new Uint8Array(r);for(let i=0;i<o.length;i++)s[i]=o.charCodeAt(i);const a=new Blob([r],{type:n});return new File([a],t,{type:n})}catch(o){throw console.error("Failed to restore file from Base64:",o),o.name==="InvalidCharacterError"?new Error(`Invalid Base64 data for file "${t}". The file data may be corrupted.`):new Error(`Failed to restore file "${t}": ${o.message}`)}}async function ae(e){if(!c.currentRequest){console.warn("updateRequestData: state.currentRequest が未定義です");return}e==="param"?c.currentRequest.params=te("paramsContainer"):e==="header"&&(c.currentRequest.headers=te("headersContainer"))}function jo(){document.querySelectorAll('input[name="bodyType"]').forEach(e=>{e.addEventListener("change",async()=>{var o;const t=(o=document.querySelector('input[name="bodyType"]:checked'))==null?void 0:o.value;if(!t||!c.currentRequest)return;c.currentRequest.bodyType=t;const n=c.collections.find(r=>r.id===c.currentCollection);if(n&&c.currentRequest){const r=n.requests.find(s=>s.id===c.currentRequest.id);r&&(r.bodyType=t)}await $(),S(`Body Type を "${t}" に切り替えました`),H({target:{value:t}})})})}function mt(e){if(c.currentCollection){const t=c.collections.find(o=>o.id===c.currentCollection),n=t==null?void 0:t.requests.find(o=>o.id===e);if(n)return n.body}if(c.currentScenario){const t=c.scenarios.find(o=>o.id===c.currentScenario),n=t==null?void 0:t.requests.find(o=>o.id===e);if(n)return n.body}}function Gt(){jo(),Mo()}function Mo(){Vo(),Kt()}function Vo(){const e=document.getElementById("saveBtn");e&&e.addEventListener("click",t=>{t.preventDefault(),go()})}function Kt(){const e=document.getElementById("sendBtn");e&&e.addEventListener("click",async g=>{var K,qe,oe,F,re,Be,Ce,rt,st,at,it;if(g.preventDefault(),!c.currentRequest)return;const p={...c.currentRequest},h=document.getElementById("methodSelect"),v=document.getElementById("nameInput"),b=document.getElementById("urlInput");p.method=(h==null?void 0:h.value)||p.method,p.name=((K=v==null?void 0:v.value)==null?void 0:K.trim())||p.name,p.url=((qe=b==null?void 0:b.value)==null?void 0:qe.trim())||p.url;const k=document.querySelectorAll("#headersContainer .key-value-row"),q={};k.forEach(B=>{var fe,he;const D=B,J=D.querySelector(".key-input"),ee=D.querySelector(".value-input"),ye=(fe=J==null?void 0:J.value)==null?void 0:fe.trim(),Ne=(he=ee==null?void 0:ee.value)==null?void 0:he.trim();ye&&(q[ye]=Ne||"")}),p.headers=q;const x=document.querySelectorAll("#paramsContainer .key-value-row"),I={};x.forEach(B=>{var fe,he;const D=B,J=D.querySelector(".key-input"),ee=D.querySelector(".value-input"),ye=(fe=J==null?void 0:J.value)==null?void 0:fe.trim(),Ne=(he=ee==null?void 0:ee.value)==null?void 0:he.trim();ye&&(I[ye]=Ne||"")}),p.params=I;const P=((oe=document.querySelector('input[name="bodyType"]:checked'))==null?void 0:oe.value)||"none";switch(p.bodyType=P,p.body=null,P){case"raw":{const B=(re=(F=document.getElementById("rawBody"))==null?void 0:F.value)==null?void 0:re.trim();p.body=B||p.body;break}case"json":{const B=(Ce=(Be=document.getElementById("jsonBody"))==null?void 0:Be.value)==null?void 0:Ce.trim();p.body=B||p.body;break}case"form-data":{const B=await Ze("formDataFieldsContainer");if(B.length>0)p.body=B;else if(Array.isArray((rt=c==null?void 0:c.currentRequest)==null?void 0:rt.body)){console.log("🔍 [utils.ts] No new form-data selected → using getPersistedBody");const D=mt(p.id);p.body=D??[]}break}case"urlencoded":{const B=te("formDataFieldsContainer");Object.keys(B).length>0?p.body=B:typeof((st=c.currentRequest)==null?void 0:st.body)=="object"&&!Array.isArray(c.currentRequest.body)&&(p.body=c.currentRequest.body);break}case"binary":{const B=document.getElementById("binaryFileInput");let D=(at=B==null?void 0:B.files)==null?void 0:at[0];if(!D&&((it=c.currentRequest)==null?void 0:it.body)instanceof File&&(D=c.currentRequest.body),D)p.body=D,console.log("🔍 [utils.ts] Sending binary file:",{name:D.name,size:D.size});else{console.log("🔍 [utils.ts] No new binary selected → using getPersistedBody");const J=mt(p.id);p.body=J??null}break}}const _=document.getElementById("preRequestScript");_&&(p.preRequestScript=_.value),St(p)});const t=document.getElementById("methodSelect");t&&t.addEventListener("change",g=>{const p=g.target;c.currentRequest&&(c.currentRequest.method=p.value)});const n=document.getElementById("urlInput");n&&n.addEventListener("input",g=>{const p=g.target;c.currentRequest&&(c.currentRequest.url=p.value)});const o=document.getElementById("importBtn");o&&o.addEventListener("click",()=>{Ot()});const r=document.getElementById("exportBtn");r&&r.addEventListener("click",()=>{Vt()});const s=document.getElementById("createCollectionBtn");s&&s.addEventListener("click",async()=>{_t()});const a=document.getElementById("createScenarioFromSidebarBtn");a&&a.addEventListener("click",async()=>{const{createNewScenario:g}=await A(async()=>{const{createNewScenario:p}=await Promise.resolve().then(()=>Ct);return{createNewScenario:p}},void 0);g()});const i=document.getElementById("historySearch");i&&i.addEventListener("input",()=>{wt()});const l=document.getElementById("clearHistoryBtn");l&&l.addEventListener("click",async()=>{Et()});const d=document.getElementById("startInterceptorBtn");d&&d.addEventListener("click",async()=>{Co()});const u=document.getElementById("stopInterceptorBtn");u&&u.addEventListener("click",async()=>{xo()});const y=document.getElementById("clearStorageBtn");y&&y.addEventListener("click",async()=>{await tn()}),document.querySelectorAll('input[name="bodyType"]').forEach(g=>{g.addEventListener("change",p=>{H(p)})});const f=document.getElementById("rawBody");f&&f.addEventListener("input",g=>{const p=g.target;c.currentRequest&&(c.currentRequest.body=p.value)});const m=document.getElementById("binaryFileInput");m&&m.addEventListener("change",g=>{var b;const h=(b=g.target.files)==null?void 0:b[0],v=document.getElementById("binaryFileInfo");h&&v?(v.innerHTML=`
                    <div class="selected-binary-file">
                        <span class="file-name">Selected: ${h.name}</span>
                        <span class="file-size">(${U(h.size)})</span>
                        <span class="file-type">${h.type||"Unknown type"}</span>
                    </div>
                `,console.log("🔍 [utils.ts] Binary file selected:",{name:h.name,size:h.size,type:h.type})):v&&(v.innerHTML="")})}function Xt(){document.querySelectorAll(".tab-btn").forEach(e=>{e.addEventListener("click",function(){const t=this.dataset.tab;t&&Fe(t)})}),document.querySelectorAll(".sub-tab-btn").forEach(e=>{e.addEventListener("click",function(){const t=this.dataset.subtab;t&&Yt(t)})}),document.querySelectorAll(".response-tab-btn").forEach(e=>{e.addEventListener("click",function(){const t=this.dataset.restab;t&&Qt(t)})}),document.querySelectorAll(".format-btn").forEach(e=>{e.addEventListener("click",function(){document.querySelectorAll(".format-btn").forEach(n=>n.classList.remove("active")),this.classList.add("active");const t=this.dataset.format;t&&window.lastResponse&&Ke(window.lastResponse,t)})})}function Fe(e){console.log(e),document.querySelectorAll(".tab-btn").forEach(o=>o.classList.remove("active")),document.querySelectorAll(".tab-content").forEach(o=>o.classList.remove("active"));const t=document.querySelector(`.tab-btn[data-tab="${e}"]`),n=document.getElementById(`${e}-tab`);t&&t.classList.add("active"),n&&n.classList.add("active")}function Yt(e){document.querySelectorAll(".sub-tab-btn").forEach(o=>o.classList.remove("active")),document.querySelectorAll(".sub-tab-content").forEach(o=>o.classList.remove("active"));const t=document.querySelector(`[data-subtab="${e}"]`),n=document.getElementById(`${e}-subtab`);t&&t.classList.add("active"),n&&n.classList.add("active"),setTimeout(()=>{if(e==="pre-request"){const o=document.getElementById("preRequestScript");o&&Q(o)}else if(e==="tests"){const o=document.getElementById("testScript");o&&Q(o)}},10)}function Qt(e){document.querySelectorAll(".response-tab-btn").forEach(o=>o.classList.remove("active")),document.querySelectorAll(".response-tab-content").forEach(o=>o.classList.remove("active"));const t=document.querySelector(`[data-restab="${e}"]`),n=document.getElementById(`response-${e}`);t&&t.classList.add("active"),n&&n.classList.add("active")}function Oe(e){const t=document.getElementById("authDetails");if(t){switch(t.innerHTML="",e){case"basic":t.innerHTML=`
                <div class="auth-field">
                    <label>Username</label>
                    <input type="text" id="authUsername" placeholder="Enter username">
                </div>
                <div class="auth-field">
                    <label>Password</label>
                    <input type="password" id="authPassword" placeholder="Enter password">
                </div>
            `;break;case"bearer":t.innerHTML=`
                <div class="auth-field">
                    <label>Token</label>
                    <input type="text" id="authToken" placeholder="Enter bearer token">
                </div>
            `;break;case"apikey":t.innerHTML=`
                <div class="auth-field">
                    <label>Key</label>
                    <input type="text" id="authKey" placeholder="Enter API key name">
                </div>
                <div class="auth-field">
                    <label>Value</label>
                    <input type="text" id="authValue" placeholder="Enter API key value">
                </div>
                <div class="auth-field">
                    <label>Add to</label>
                    <select id="authAddTo">
                        <option value="header">Header</option>
                        <option value="query">Query Params</option>
                    </select>
                </div>
            `;break;case"oauth2":t.innerHTML=`
                <div class="auth-field">
                    <label>Access Token</label>
                    <input type="text" id="authAccessToken" placeholder="Enter access token">
                </div>
                <div class="auth-field">
                    <label>Token Type</label>
                    <select id="authTokenType">
                        <option value="Bearer">Bearer</option>
                        <option value="MAC">MAC</option>
                    </select>
                </div>
                <button class="btn btn-sm" onclick="getOAuth2Token()">Get New Access Token</button>
            `;break}t.querySelectorAll("input, select").forEach(n=>{n.addEventListener("input",Ee),n.addEventListener("change",Ee)})}}function Ee(){var t;if(!c.currentRequest){console.error("updateAuthData: state.currentRequest が undefined です");return}const e=((t=c.currentRequest.auth)==null?void 0:t.type)||"none";switch(c.currentRequest.auth={type:e},e){case"basic":const n=document.getElementById("authUsername"),o=document.getElementById("authPassword");c.currentRequest.auth.username=(n==null?void 0:n.value)||"",c.currentRequest.auth.password=(o==null?void 0:o.value)||"";break;case"bearer":const r=document.getElementById("authToken");c.currentRequest.auth.token=(r==null?void 0:r.value)||"";break;case"apikey":const s=document.getElementById("authKey"),a=document.getElementById("authValue"),i=document.getElementById("authAddTo");c.currentRequest.auth.key=(s==null?void 0:s.value)||"",c.currentRequest.auth.value=(a==null?void 0:a.value)||"",c.currentRequest.auth.addTo=(i==null?void 0:i.value)||"header";break;case"oauth2":const l=document.getElementById("authAccessToken"),d=document.getElementById("authTokenType");c.currentRequest.auth.accessToken=(l==null?void 0:l.value)||"",c.currentRequest.auth.tokenType=(d==null?void 0:d.value)||"Bearer";break}}function Je(e){const t=document.getElementById("sendBtn");t&&(e?(t.disabled=!0,t.textContent="Sending..."):(t.disabled=!1,t.textContent="Send"))}function H(e){const t=e.target.value,n=document.getElementById("rawBody"),o=document.getElementById("jsonEditor"),r=document.getElementById("formDataContainer"),s=document.getElementById("binaryContainer");if(!(!n||!o||!r||!s))switch(n.style.display="none",o.style.display="none",r.style.display="none",s.style.display="none",t){case"raw":n.style.display="block";break;case"json":o.style.display="block";break;case"form-data":case"urlencoded":r.style.display="block";const a=document.getElementById("formDataFieldsContainer");a&&!a.children.length&&C(a,"body");break;case"binary":s.style.display="block";break}}async function Zt(e){return await Ze(e)}async function en(e){var o;const t=document.getElementById(e),n=(o=t==null?void 0:t.files)==null?void 0:o[0];if(!n)return null;try{const r=await Wt(n);return JSON.stringify({type:"binaryFile",fileName:n.name,fileType:n.type,fileSize:n.size,base64Data:r})}catch(r){return E(`Failed to serialize binary file "${n.name}": ${r.message}`),null}}function Q(e){e.style.height="auto",e.style.height=e.scrollHeight+100+"px"}async function tn(){if(confirm(`Are you sure you want to clear all storage data?

This will delete:
• All collections and requests
• All scenarios
• All variables (global, environment, collection)
• All environments
• Request history
• Settings

This action cannot be undone.`))try{await chrome.storage.local.clear();const{state:t}=await A(async()=>{const{state:b}=await Promise.resolve().then(()=>Jo);return{state:b}},void 0);t.collections.splice(0),t.currentCollection=null,t.scenarios.splice(0),t.currentScenario=null,t.environments.splice(0),t.currentEnvironment=null,t.history.splice(0),t.variables={global:{},collection:{},environment:{}},t.currentRequest=null;const{renderCollectionsTree:n}=await A(async()=>{const{renderCollectionsTree:b}=await Promise.resolve().then(()=>Te);return{renderCollectionsTree:b}},void 0),{renderScenarioList:o}=await A(async()=>{const{renderScenarioList:b}=await Promise.resolve().then(()=>Ct);return{renderScenarioList:b}},void 0),{renderEnvironmentSelector:r,renderAllVariables:s,updateCollectionVarSelector:a}=await A(async()=>{const{renderEnvironmentSelector:b,renderAllVariables:k,updateCollectionVarSelector:q}=await Promise.resolve().then(()=>zo);return{renderEnvironmentSelector:b,renderAllVariables:k,updateCollectionVarSelector:q}},void 0),{renderHistory:i}=await A(async()=>{const{renderHistory:b}=await Promise.resolve().then(()=>Gn);return{renderHistory:b}},void 0);n(),o(),r(),s(),a(),i();const l=document.getElementById("methodSelect"),d=document.getElementById("urlInput"),u=document.getElementById("nameInput");l&&(l.value="GET"),d&&(d.value=""),u&&(u.value="");const y=document.getElementById("headersContainer"),f=document.getElementById("paramsContainer");y&&(y.innerHTML="",C(y,"header")),f&&(f.innerHTML="",C(f,"param"));const m=document.getElementById("rawBody"),g=document.getElementById("jsonBody"),p=document.getElementById("preRequestScript"),h=document.getElementById("testScript");m&&(m.value=""),g&&(g.value=""),p&&(p.value=""),h&&(h.value="");const v=document.querySelector('input[name="bodyType"][value="none"]');v&&(v.checked=!0,H({target:{value:"none"}})),S("All storage data has been cleared successfully")}catch(t){Ut("clear all storage",t)}}const nn=Object.freeze(Object.defineProperty({__proto__:null,addKeyValueRow:C,autoResizeTextarea:Q,base64ToFile:le,clearAllStorage:tn,collectFormDataWithFiles:Ze,collectKeyValues:te,escapeHtml:N,formatBytes:U,handleBodyTypeChange:H,renderAuthDetails:Oe,serializeBinaryFile:en,serializeFormDataWithFiles:Zt,setupEventListeners:Gt,setupSendButton:Kt,setupTabSwitching:Xt,showError:E,showFileError:Jt,showLoading:Je,showNetworkError:zt,showNotification:Qe,showStorageError:Ut,showSuccess:S,showVariableError:De,switchMainTab:Fe,switchResponseTab:Qt,switchSubTab:Yt,updateAuthData:Ee,updateRequestData:ae},Symbol.toStringTag,{value:"Module"}));function Ho(){const e=document.getElementById("newEnvironmentBtn"),t=document.getElementById("editEnvironmentBtn"),n=document.getElementById("environmentSelect"),o=document.getElementById("addGlobalVarBtn"),r=document.getElementById("addEnvVarBtn"),s=document.getElementById("addCollectionVarBtn"),a=document.getElementById("collectionVarSelect");e==null||e.addEventListener("click",rn),t==null||t.addEventListener("click",sn),n==null||n.addEventListener("change",et),o==null||o.addEventListener("click",()=>$e("global")),r==null||r.addEventListener("click",()=>$e("environment")),s==null||s.addEventListener("click",()=>$e("collection")),a==null||a.addEventListener("change",async()=>{const i=a.value;c.selectedCollectionForVars=i,console.log("Collection changed to:",i),console.log("Collection variables data:",c.variables.collection),console.log("Selected collection variables:",c.variables.collection[i]),j("collection")})}async function on(){try{const t=(await chrome.storage.local.get(["variables"])).variables||{};c.variables.global=t.global||{},c.variables.collection=t.collection||{};const o=(await chrome.storage.local.get(["environments"])).environments||[];if(c.environments.splice(0,c.environments.length,...o),c.currentEnvironment){const r=await chrome.storage.local.get([`env_${c.currentEnvironment}`]);c.variables.environment=r[`env_${c.currentEnvironment}`]||{}}else c.variables.environment={};ne(),Ho(),V(),ke(),console.log("Variables management initialized")}catch(e){console.error("Error initializing variables management:",e)}}function ne(){const e=document.getElementById("environmentSelect");if(!e)return;e.innerHTML="";const t=document.createElement("option");t.value="",t.textContent="No Environment",e.appendChild(t),c.environments.forEach(n=>{const o=document.createElement("option");o.value=n.id,o.textContent=n.name,n.id===c.currentEnvironment&&(o.selected=!0),e.appendChild(o)})}async function rn(){const e=prompt("Enter environment name:");if(!e)return;const t={id:`env_${Date.now()}_${Math.random().toString(36).substring(2)}`,name:e,variables:{},created:new Date().toISOString()};c.environments.push(t),await me(),await chrome.storage.local.set({[`env_${t.id}`]:{}}),ne();const n=document.getElementById("environmentSelect");n&&(n.value=t.id),await et(),S("Environment created: "+e)}async function sn(){if(!c.currentEnvironment){E("No environment selected");return}const e=c.environments.find(n=>n.id===c.currentEnvironment);if(!e)return;const t=prompt("Edit environment name:",e.name);!t||t===e.name||(e.name=t,await me(),ne(),S("Environment renamed to: "+t))}async function et(){var o;const e=document.getElementById("environmentSelect");if(!e)return;const t=e.value;if(c.currentEnvironment&&await Pe(c.currentEnvironment),c.currentEnvironment=t,await un(),t){const r=await chrome.storage.local.get([`env_${t}`]);c.variables.environment=r[`env_${t}`]||{}}else c.variables.environment={};const n=t?(o=c.environments.find(r=>r.id===t))==null?void 0:o.name:"No Environment";S("Switched to: "+n),j("environment")}function V(){const e=document.getElementById("collectionVarSelect");if(!e)return;e.innerHTML="";const t=document.createElement("option");t.value="",t.textContent="Select Collection",e.appendChild(t),c.collections.forEach(n=>{const o=document.createElement("option");o.value=n.id,o.textContent=n.name,n.id===c.currentCollection&&(o.selected=!0),e.appendChild(o)})}function ke(){j("global"),j("environment"),j("collection")}function j(e){let t,n;if(e==="global")t=document.getElementById("globalVariablesContainer"),n=c.variables.global;else if(e==="environment"){if(t=document.getElementById("envVariablesContainer"),!c.currentEnvironment){t&&(t.innerHTML='<p class="empty-message">Select an environment to manage variables</p>'),console.log("renderVariables is return currentEnvironment");return}n=c.variables.environment}else if(e==="collection"){t=document.getElementById("collectionVariablesContainer");const s=c.selectedCollectionForVars;if(!s){t&&(t.innerHTML='<p class="empty-message">Select a collection to manage variables</p>'),console.log("renderVariables is return selectedCollectionForVars");return}n=c.variables.collection[s]||{},console.log(`renderVariables collection: selectedCollectionId=${s}, data=`,n)}else{console.log("renderVariables is return");return}if(!t)return;t.innerHTML="";const o=document.createElement("div");o.className="variable-header-row",o.innerHTML=`
      <span>Variable</span>
      <span>Value</span>
      <span>Description</span>
      <span></span>
    `,t.appendChild(o);const r=Object.entries(n||{});if(r.length===0){const s=document.createElement("div");s.className="empty-variables",s.innerHTML='<p>No variables defined. Click "Add" to create one.</p>',t.appendChild(s)}else r.forEach(([s,a])=>{const{value:i,description:l}=a,d=tt(e,s,i,l);t.appendChild(d)})}function tt(e,t="",n="",o=""){const r=document.createElement("div");r.className="variable-row",r.dataset.originalKey=t,r.innerHTML=`
        <input type="text" class="var-key" placeholder="Variable name" value="${N(t)}">
        <input type="text" class="var-value" placeholder="Value" value="${N(n)}">
        <input type="text" class="var-description" placeholder="Description" value="${N(o)}">
        <button class="delete-btn">×</button>
    `;const s=r.querySelector(".var-key"),a=r.querySelector(".var-value"),i=r.querySelector(".var-description"),l=r.querySelector(".delete-btn"),d=async()=>{const f=s.value.trim(),m=a.value,g=i.value,p=r.dataset.originalKey||"";if(!f){p&&await xe(e,p);return}if(f!==p&&an(e,f)){E(`Variable "${f}" already exists in this scope`),s.value=p;return}p&&p!==f&&await xe(e,p),await cn(e,f,m,g),r.dataset.originalKey=f,console.log(`Variable "${f}" saved successfully`)};let u=null;const y=()=>{u&&clearTimeout(u),u=setTimeout(d,500)};return s.addEventListener("blur",d),a.addEventListener("blur",d),i.addEventListener("blur",d),s.addEventListener("input",y),a.addEventListener("input",y),i.addEventListener("input",y),l.addEventListener("click",async()=>{const f=r.dataset.originalKey||s.value.trim();f?confirm(`Delete variable "${f}"?`)&&(await xe(e,f),r.remove(),S(`Variable "${f}" deleted`)):r.remove()}),r}function an(e,t){switch(e){case"global":return t in c.variables.global;case"environment":return t in c.variables.environment;case"collection":const n=c.selectedCollectionForVars;return n&&c.variables.collection[n]&&t in c.variables.collection[n]}return!1}async function cn(e,t,n,o){const r={value:n,description:o};switch(e){case"global":c.variables.global[t]=r,await G();break;case"environment":if(!c.currentEnvironment){console.error("No environment selected for saving variable");return}c.variables.environment[t]=r,console.log("Saving environment variable:",t,r,"to environment:",c.currentEnvironment),console.log("Current environment variables:",c.variables.environment),await Pe(c.currentEnvironment);break;case"collection":const s=c.selectedCollectionForVars;if(!s){console.error("No collection selected for saving variable");return}c.variables.collection[s]||(c.variables.collection[s]={}),c.variables.collection[s][t]=r,console.log("Saving collection variable:",t,r,"to collection:",s),console.log("Collection variables after save:",c.variables.collection[s]),console.log("All collection variables:",c.variables.collection),await G();break}console.log(`Variable saved: ${e}.${t} = ${n}`)}async function xe(e,t){switch(e){case"global":delete c.variables.global[t],await G(),j("global");break;case"environment":if(!c.currentEnvironment)return;delete c.variables.environment[t],await Pe(c.currentEnvironment),j("environment");break;case"collection":const n=c.selectedCollectionForVars;if(!n)return;delete c.variables.collection[n][t],await G(),j("collection");break}}function $e(e){if(e==="environment"&&!c.currentEnvironment){E("Please select an environment first");return}if(e==="collection"&&!c.selectedCollectionForVars){E("Please select a collection first");return}let t;switch(e){case"global":t=document.getElementById("globalVariablesContainer");break;case"environment":t=document.getElementById("envVariablesContainer");break;case"collection":t=document.getElementById("collectionVariablesContainer");break;default:return}if(!t)return;const n=t.querySelector(".empty-variables");n&&n.remove();const o=tt(e);t.appendChild(o);const r=o.querySelector(".var-key");r==null||r.focus()}function ln(e){if(e.length<4)throw new Error(`変数参照構文が不正です: ${JSON.stringify(e)}`);const t=e[0]==="scenarios",n=e[1],o=e[2],r=e[3],s=e.slice(4);let a;if(t){const d=c.scenarios.find(u=>u.name===n);if(!d)throw new Error(`シナリオ「${n}」が見つかりません`);if(a=d.requests.find(u=>u.name===o),!a)throw new Error(`シナリオ「${n}」内にリクエスト「${o}」が見つかりません`)}else{const d=c.collections.find(u=>u.name===n);if(!d)throw new Error(`コレクション「${n}」が見つかりません`);if(a=d.requests.find(u=>u.name===o),!a)throw new Error(`コレクション「${n}」内にリクエスト「${o}」が見つかりません`)}const i=r==="response"?a.lastResponseExecution:a.lastRequestExecution;if(!i)throw new Error(`${r} の実行結果が存在しません`);let l=i;for(let d=0;d<s.length;d++){const u=s[d];if(typeof u=="object"&&"jsonPath"in u){const f=u.jsonPath,m=typeof l=="string"?JSON.parse(l):l,g=T({path:f,json:m});if(!Array.isArray(g)||g.length===0)throw new Error(`JSONPath "${f}" に一致する値がありません`);return g[0]}if(u==="headers"){const f=s[++d],m=Object.entries(l.headers||{}).find(([g])=>g.toLowerCase()===f.toLowerCase());if(!m)throw new Error(`ヘッダー "${f}" が見つかりません`);return m[1]}if(u==="body"){l=l.body;continue}const y=u;if(l!=null&&typeof l=="object"&&y in l)l=l[y];else throw new Error(`プロパティ "${y}" が見つかりません`)}return l}function W(e){var n,o;if(console.log("🔍 [getVariable] START - varName:",e),e.startsWith("${")&&e.endsWith("}")){const r=e.slice(2,-1),s=[],a=/\.?"([^"]+)"|\.jsonPath\("([^"]+)"\)/g;let i,l=0;for(;(i=a.exec(r))!==null;){if(i.index!==l)throw new Error(`変数参照構文が不正です: ${r.slice(l,i.index)}`);l=a.lastIndex,i[1]!==void 0?s.push(i[1]):s.push({jsonPath:i[2]})}if(l<r.length)throw new Error(`変数参照構文が不正です: ${r.slice(l)}`);return console.log("🔍 [getVariable] Parsed parts:",s),ln(s)}if(e.startsWith("{{")&&e.endsWith("}}")){const r=e.slice(2,-2).trim();return c.variables.environment[r]?c.variables.environment[r].value:c.variables.global[r]?c.variables.global[r].value:c.currentCollection&&((n=c.variables.collection[c.currentCollection])!=null&&n[r])?c.variables.collection[c.currentCollection][r].value:void 0}const t=e.trim();if(c.variables.environment[t])return c.variables.environment[t].value;if(c.variables.global[t])return c.variables.global[t].value;if(c.currentCollection&&((o=c.variables.collection[c.currentCollection])!=null&&o[t]))return c.variables.collection[c.currentCollection][t].value;console.log("🔍 [getVariable] Variable not found:",e)}function M(e){if(typeof e!="string")return e;let t=e,n=0;for(;n<t.length;){const o=t.indexOf("${",n);if(o===-1)break;let r=0,s=o+2,a=!1,i=!1;for(;s<t.length;){const l=t[s];if(i){i=!1,s++;continue}if(l==="\\"){i=!0,s++;continue}if(l==='"'&&!i)a=!a;else if(!a){if(l==="{")r++;else if(l==="}")if(r===0){const d=t.substring(o,s+1);try{const u=W(d);u!==void 0?(t=t.substring(0,o)+u+t.substring(s+1),n=o+String(u).length):n=s+1}catch(u){console.warn("Variable replacement failed for:",d,u),(u.message.includes("見つかりません")||u.message.includes("not found"))&&De(d,u),n=s+1}break}else r--}s++}s>=t.length&&(n=o+2)}return t=t.replace(/\{\{([^}]+)\}\}/g,(o,r)=>{const s=r.trim(),a=W(s);return a!==void 0?a:o}),t=t.replace(/\{([^}]+)\}/g,(o,r)=>{const s=r.trim(),a=W(s);return a!==void 0?a:o}),t}function ce(e){if(typeof e=="string")return M(e);if(Array.isArray(e))return e.map(ce);if(e&&typeof e=="object"){const t={};for(const[n,o]of Object.entries(e)){const r=M(n);t[r]=ce(o)}return t}return e}async function ue(e,t,n){const o={value:n,description:""};switch(e){case"global":c.variables.global[t]=o,await chrome.storage.local.set({variables:{global:c.variables.global,collection:c.variables.collection}});break;case"environment":c.currentEnvironment&&(c.variables.environment[t]=o,await chrome.storage.local.set({[`env_${c.currentEnvironment}`]:c.variables.environment}));break}}const zo=Object.freeze(Object.defineProperty({__proto__:null,addVariableRow:$e,createNewEnvironment:rn,createVariableRow:tt,deepReplaceVariables:ce,deleteVariable:xe,editCurrentEnvironment:sn,getValueFromVarPath:ln,getVariable:W,initializeVariablesManagement:on,renderAllVariables:ke,renderEnvironmentSelector:ne,renderVariables:j,replaceVariables:M,saveVariable:cn,setVariable:ue,switchEnvironment:et,updateCollectionVarSelector:V,variableExists:an},Symbol.toStringTag,{value:"Module"})),c={currentRequest:{id:"",name:"",method:"GET",url:"",headers:{},params:{},body:null,auth:{type:"none"},folder:"",description:"",bodyType:"none",preRequestScript:""},collections:[],history:[],variables:{global:{},environment:{},collection:{}},environments:[],currentEnvironment:null,currentCollection:null,scenarios:[],currentScenario:null,sidebarState:{expandedCollections:new Set,expandedScenarios:new Set}},nt=c;nt.testScripts=[];nt.settings={};nt.isInterceptorActive=!1;async function $(){try{await chrome.storage.local.set({collections:c.collections});const e=await chrome.storage.local.get(["collections"]);c.collections.splice(0,c.collections.length,...e.collections),V()}catch(e){console.error("Failed to save collections to storage:",e);const{showStorageError:t}=await A(async()=>{const{showStorageError:n}=await Promise.resolve().then(()=>nn);return{showStorageError:n}},void 0);throw t("save collections",e),e}}async function ot(){try{await chrome.storage.local.set({history:c.history})}catch(e){console.error("Failed to save history to storage:",e);const{showStorageError:t}=await A(async()=>{const{showStorageError:n}=await Promise.resolve().then(()=>nn);return{showStorageError:n}},void 0);throw t("save history",e),e}}async function G(){await chrome.storage.local.set({variables:{global:c.variables.global,collection:c.variables.collection,environment:c.variables.environment}})}async function me(){await chrome.storage.local.set({environments:c.environments})}async function un(){await chrome.storage.local.set({currentEnvironment:c.currentEnvironment})}async function Pe(e){await chrome.storage.local.set({[`env_${e}`]:c.variables.environment})}async function Ae(){await chrome.storage.local.set({currentCollection:c.currentCollection})}async function R(){await chrome.storage.local.set({scenarios:c.scenarios}),Z()}async function we(){await chrome.storage.local.set({currentScenario:c.currentScenario})}async function Se(){try{if(c.sidebarState){const e={expandedCollections:Array.from(c.sidebarState.expandedCollections),expandedScenarios:Array.from(c.sidebarState.expandedScenarios)};await chrome.storage.local.set({sidebarState:e})}}catch(e){console.error("Error saving sidebar state:",e)}}const Jo=Object.freeze(Object.defineProperty({__proto__:null,saveCollectionsToStorage:$,saveCurrentCollectionToStorage:Ae,saveCurrentEnvironmentToStorage:un,saveCurrentScenarioToStorage:we,saveEnvDataToStorage:Pe,saveEnvironmentsToStorage:me,saveHistoryToStorage:ot,saveScenariosToStorage:R,saveSidebarStateToStorage:Se,saveVariablesToStorage:G,state:c},Symbol.toStringTag,{value:"Module"})),je={openDevTools:!0,requestTimeout:3e4,followRedirects:!0,validateSSL:!0,maxHistoryItems:100};class ie{constructor(){this.settings={...je},this.loadSettings()}static getInstance(){return ie.instance||(ie.instance=new ie),ie.instance}async loadSettings(){try{const t=await chrome.storage.sync.get("settings");t.settings&&(this.settings={...je,...t.settings})}catch(t){console.error("設定の読み込みに失敗しました:",t)}}async saveSettings(t){try{this.settings={...this.settings,...t},await chrome.storage.sync.set({settings:this.settings})}catch(n){console.error("設定の保存に失敗しました:",n)}}getSettings(){return{...this.settings}}async resetSettings(){try{this.settings={...je},await chrome.storage.sync.set({settings:this.settings})}catch(t){console.error("設定のリセットに失敗しました:",t)}}}function dn(){const e=ie.getInstance(),t=e.getSettings(),n=document.getElementById("openDevTools"),o=document.getElementById("requestTimeout"),r=document.getElementById("followRedirects"),s=document.getElementById("validateSSL"),a=document.getElementById("maxHistoryItems");n&&(n.checked=t.openDevTools),o&&(o.value=t.requestTimeout.toString()),r&&(r.checked=t.followRedirects),s&&(s.checked=t.validateSSL),a&&(a.value=t.maxHistoryItems.toString());const i=document.getElementById("saveSettings");i&&i.addEventListener("click",async()=>{const d={openDevTools:(n==null?void 0:n.checked)??!0,requestTimeout:parseInt((o==null?void 0:o.value)??"30000"),followRedirects:(r==null?void 0:r.checked)??!0,validateSSL:(s==null?void 0:s.checked)??!0,maxHistoryItems:parseInt((a==null?void 0:a.value)??"100")};await e.saveSettings(d),Ue()});const l=document.getElementById("resetSettings");l&&l.addEventListener("click",async()=>{await e.resetSettings(),dn()})}function Uo(){const e=document.getElementById("settingsModal");e&&e.classList.add("active")}function Ue(){const e=document.getElementById("settingsModal");e&&e.classList.remove("active")}function Wo(){var n;const e=document.getElementById("settingsBtn"),t=document.querySelector("#settingsModal .close-btn");e==null||e.addEventListener("click",Uo),t==null||t.addEventListener("click",Ue),(n=document.getElementById("settingsModal"))==null||n.addEventListener("click",o=>{o.target===o.currentTarget&&Ue()})}function Go(){const e=document.getElementById("authType");e==null||e.addEventListener("change",function(){const t=this.value;c.currentRequest&&(c.currentRequest.auth.type=t,Oe(t))})}function Ko(){const e=document.getElementById("importExportModal");if(!e)return;e.querySelectorAll(".modal-close").forEach(a=>{a.addEventListener("click",function(){e.classList.remove("active")})}),e.addEventListener("click",function(a){a.target===e&&e.classList.remove("active")});const n=document.getElementById("importFile"),o=document.getElementById("fileDropZone");n&&n.addEventListener("change",ze),o&&(o.addEventListener("click",function(){n==null||n.click()}),o.addEventListener("dragover",function(a){a.preventDefault(),this.classList.add("dragover")}),o.addEventListener("dragleave",function(){this.classList.remove("dragover")}),o.addEventListener("drop",function(a){var l;a.preventDefault(),this.classList.remove("dragover");const i=(l=a.dataTransfer)==null?void 0:l.files;i&&i.length>0&&ze({target:{files:i}})}));const r=document.getElementById("importSubmitBtn");r==null||r.addEventListener("click",Pt);const s=document.getElementById("importSampleBtn");s==null||s.addEventListener("click",async()=>{try{const{importSampleData:a}=await A(async()=>{const{importSampleData:i}=await Promise.resolve().then(()=>No);return{importSampleData:i}},void 0);await a(),e.classList.remove("active")}catch(a){console.error("Failed to import sample data:",a)}})}function Xo(){Yo(),Qo(),Zo()}function Yo(){const e=document.getElementById("paramsContainer");e&&e.children.length===0&&C(e,"param")}function Qo(){const e=document.getElementById("headersContainer");e&&e.children.length===0&&C(e,"header")}function Zo(){const e=document.querySelector(".add-param");e==null||e.addEventListener("click",function(){const o=document.getElementById("paramsContainer");o&&C(o,"param")});const t=document.querySelector(".add-header");t==null||t.addEventListener("click",function(){const o=document.getElementById("headersContainer");o&&C(o,"header")});const n=document.querySelector(".add-form-data");n==null||n.addEventListener("click",function(){const o=document.getElementById("formDataFieldsContainer");o&&C(o,"body")})}function er(){try{const e=document.createElement("div");e.style.cssText=`
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            font-size: 13px;
            z-index: 10000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            border: 1px solid rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease-out;
        `,e.innerHTML=`
            <div style="display: flex; align-items: center; gap: 8px;">
                <span style="font-size: 16px;">🛠️</span>
                <span>Press F12 for better debugging experience</span>
            </div>
        `,document.body.appendChild(e),setTimeout(()=>{e.style.opacity="1",e.style.transform="translateX(0)"},100),setTimeout(()=>{e.style.opacity="0",e.style.transform="translateX(100%)",setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},300)},4e3),console.log("Developer tools guidance shown")}catch(e){console.warn("Failed to show developer tools guidance:",e)}}function tr(){const e=document.getElementById("preRequestScript");e&&(Q(e),e.addEventListener("input",()=>Q(e)))}function nr(){const e=document.getElementById("testScript");e&&(Q(e),e.addEventListener("input",()=>Q(e)))}async function or(){try{Gt(),Xt(),Ko(),tr(),nr(),chrome.runtime.onMessage.addListener(n=>{if(n.action==="openDevTools"){const o=document.querySelector('[data-tab="interceptor"]');o&&o.click()}else n.action==="openDevToolsF12"&&er()}),await xt(),await Tt();const e=document.getElementById("newScenarioBtn");e==null||e.addEventListener("click",()=>{kt()});const t=document.getElementById("runScenarioBtn");t==null||t.addEventListener("click",()=>{Bt()}),await on(),Le(),Xo(),Go(),Lt(),console.log("API Tester initialized successfully")}catch(e){console.error("Initialization error:",e),E("Failed to initialize: "+e.message)}}document.addEventListener("DOMContentLoaded",async()=>{await or();try{dn(),Wo()}catch(e){console.error("設定の初期化に失敗しました:",e)}});
