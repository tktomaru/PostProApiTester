const lt={apiUrl:{value:"http://localhost:31013",description:"基本となる API の URL"},timeout:{value:"30000",description:"タイムアウト（ミリ秒）"}},ye=[{id:"env_dev",name:"Development",created:new Date().toISOString()},{id:"env_prod",name:"Production",created:new Date().toISOString()}],dt={env_dev:{devToken:{value:"dev-abcdef12345",description:"開発用トークン"}},env_prod:{prodToken:{value:"prod-xyz987654",description:"本番用トークン"}}},ut=[{id:"col_sample",name:"Sample Collection",description:"サンプル用コレクション",requests:[{id:"req1",name:"POST Users",method:"POST",url:"{{apiUrl}}/api/auth/login",headers:{Accept:"application/json",removeHeader:"removeHeaderValue"},params:{page:"1"},body:JSON.stringify({username:"tomaru",password:""}),auth:{type:"bearer",token:"{{devToken}}"},folder:"",description:"ユーザー一覧を取得する",bodyType:"none",preRequestScript:`
// リクエスト/レスポンス実行結果の参照例
// リクエストのヘッダーを参照
addHeaderWithVar Authorization \${"Sample Collection"."POST Users"."request"."headers"."authorization"}

// レスポンスのステータスコードを参照
setVarFromHeader statusCode \${"Sample Collection"."POST Users"."response"."status"}

// レスポンスのボディから値を取得
setBodyWithVar \${"Sample Collection"."POST Users"."response"."body"."token"}

// 既存のプリリクエストスクリプト
setUrl https://reply.tukutano.jp/items?page=9
addHeader test scriptadd
removeHeader removeHeader
setBody setBodyWithScript
//setUrlWithVar apiBaseUrl
//addHeaderWithVar Authorization authtoken
//setBodyWithVar requestPayload
  `},{id:"req_sample_post_1",name:"サンプル POST 1",method:"POST",url:"https://reply.tukutano.jp/items?page=1",headers:{},params:{},body:"test body text",auth:{type:"none"},bodyType:"raw",preRequestScript:`
// リクエスト/レスポンス実行結果の参照例
// 前のリクエストのレスポンスから値を取得して使用

// 既存のプリリクエストスクリプト
setUrl https://reply.tukutano.jp/items?page=9
addHeader test scriptadd
addHeader authorization scriptadd-authorization11
removeHeader removeHeader
setBody setBodyWithScript1
//setUrlWithVar apiBaseUrl
//addHeaderWithVar Authorization authtoken
//setBodyWithVar requestPayload
  `},{id:"req_sample_post_2",name:"サンプル POST 2",method:"POST",url:"https://reply.tukutano.jp/items?page=2",headers:{},params:{},body:"test body text",auth:{type:"none"},bodyType:"raw",preRequestScript:`
// リクエスト/レスポンス実行結果の参照例
// 前のリクエストのレスポンスから値を取得して使用
addHeaderWithVar Authorization \${"Sample Collection"."サンプル POST 1"."response"."headers"."authorization"}
setBodyWithVar \${"Sample Collection"."サンプル POST 1"."response"."body".jsonPath("$.headers.authorization")}

// 既存のプリリクエストスクリプト
setUrl https://reply.tukutano.jp/items?page=9
addHeader test scriptadd
removeHeader removeHeader
//setBody setBodyWithScript2
//setUrlWithVar apiBaseUrl
//addHeaderWithVar Authorization authtoken
//setBodyWithVar requestPayload
  `}]}],ht={col_sample:{basePath:{value:"/v1",description:"エンドポイントのバージョン"},userId:{value:"123",description:"サンプルユーザーID"}}},mt=`
// ステータスコードが 200 かをチェック
//status 200
// Authorization ヘッダーの値を取得して、環境変数 authToken に保存
//setVarFromHeader authToken Authorization
// ボディの JSON に users プロパティがあるかをチェック
// jsonHasProperty users
// jsonArrayLengthEquals users 5
// jsonValueEquals data.id 1234
// bodyContains success
// headerExists Content - Type
                `,pt=[{id:"scenario_sample_post_flow",name:"Sample post Flow",requests:[{id:"req_sample_POST1",name:"サンプル POST",method:"POST",url:"https://reply.tukutano.jp/items?page=1",headers:{},params:{},body:null,auth:{type:"none"},bodyType:"raw",preRequestScript:`
addHeader test scriptadd1
setBody setBodyWithScript1
                `},{id:"req_sample_POST2",name:"サンプル POST",method:"POST",url:"https://reply.tukutano.jp/items?page=2",headers:{},params:{},body:'{"jsonKey" : "jsonValue"}',auth:{type:"none"},bodyType:"json",preRequestScript:`
addHeader test scriptadd2
                `},{id:"req_sample_POST3",name:"サンプル POST",method:"POST",url:"https://reply.tukutano.jp/items?page=3",headers:{},params:{},body:'{"jsonKey" : "jsonValue"}',auth:{type:"none"},bodyType:"raw",preRequestScript:`
addHeader test scriptadd3
setBody setBodyWithScript3
                `}]},{id:"scenario_sample_get_flow2",name:"Sample get Flow",requests:[{id:"req_sample_get2_1",name:"サンプル GET",method:"GET",url:"https://reply.tukutano.jp/items?page=10",headers:{},params:{},body:"1",auth:{type:"none"},bodyType:"raw",preRequestScript:`
addHeader test scriptadd1
// bodyをセットしてもGETリクエストのため送信されない事に注意する
setBody setBodyWithScript1
                `},{id:"req_sample_get2_2",name:"サンプル GET",method:"GET",url:"https://reply.tukutano.jp/items?page=11",headers:{},params:{},body:'{"jsonKey" : "jsonValue"}',auth:{type:"none"},bodyType:"json",preRequestScript:`
// key＝test、value=scriptadd2
addHeader test scriptadd2
                `},{id:"req_sample_get2_3",name:"サンプル GET",method:"GET",url:"https://reply.tukutano.jp/items?page=12",headers:{},params:{},body:null,auth:{type:"none"},bodyType:"raw",preRequestScript:`
addHeader test scriptadd2
// bodyをセットしてもGETリクエストのため送信されない事に注意する
setBody setBodyWithScript3
                `}]}],yt="modulepreload",ft=function(t){return"/"+t},fe={},A=function(e,n,r){let o=Promise.resolve();if(n&&n.length>0){let d=function(l){return Promise.all(l.map(h=>Promise.resolve(h).then(p=>({status:"fulfilled",value:p}),p=>({status:"rejected",reason:p}))))};document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),c=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));o=d(n.map(l=>{if(l=ft(l),l in fe)return;fe[l]=!0;const h=l.endsWith(".css"),p=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${p}`))return;const y=document.createElement("link");if(y.rel=h?"stylesheet":yt,h||(y.as="script"),y.crossOrigin="",y.href=l,c&&y.setAttribute("nonce",c),document.head.appendChild(y),h)return new Promise((m,f)=>{y.addEventListener("load",m),y.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${l}`)))})}))}function s(d){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=d,window.dispatchEvent(i),!i.defaultPrevented)throw d}return o.then(d=>{for(const i of d||[])i.status==="rejected"&&s(i.reason);return e().catch(s)})};class bt{add(e,n,r){if(typeof arguments[0]!="string")for(let o in arguments[0])this.add(o,arguments[0][o],arguments[1]);else(Array.isArray(e)?e:[e]).forEach(function(o){this[o]=this[o]||[],n&&this[o][r?"unshift":"push"](n)},this)}run(e,n){this[e]=this[e]||[],this[e].forEach(function(r){r.call(n&&n.context?n.context:n,n)})}}class gt{constructor(e){this.jsep=e,this.registered={}}register(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];n.forEach(o=>{if(typeof o!="object"||!o.name||!o.init)throw new Error("Invalid JSEP plugin format");this.registered[o.name]||(o.init(this.jsep),this.registered[o.name]=o)})}}class u{static get version(){return"1.4.0"}static toString(){return"JavaScript Expression Parser (JSEP) v"+u.version}static addUnaryOp(e){return u.max_unop_len=Math.max(e.length,u.max_unop_len),u.unary_ops[e]=1,u}static addBinaryOp(e,n,r){return u.max_binop_len=Math.max(e.length,u.max_binop_len),u.binary_ops[e]=n,r?u.right_associative.add(e):u.right_associative.delete(e),u}static addIdentifierChar(e){return u.additional_identifier_chars.add(e),u}static addLiteral(e,n){return u.literals[e]=n,u}static removeUnaryOp(e){return delete u.unary_ops[e],e.length===u.max_unop_len&&(u.max_unop_len=u.getMaxKeyLen(u.unary_ops)),u}static removeAllUnaryOps(){return u.unary_ops={},u.max_unop_len=0,u}static removeIdentifierChar(e){return u.additional_identifier_chars.delete(e),u}static removeBinaryOp(e){return delete u.binary_ops[e],e.length===u.max_binop_len&&(u.max_binop_len=u.getMaxKeyLen(u.binary_ops)),u.right_associative.delete(e),u}static removeAllBinaryOps(){return u.binary_ops={},u.max_binop_len=0,u}static removeLiteral(e){return delete u.literals[e],u}static removeAllLiterals(){return u.literals={},u}get char(){return this.expr.charAt(this.index)}get code(){return this.expr.charCodeAt(this.index)}constructor(e){this.expr=e,this.index=0}static parse(e){return new u(e).parse()}static getMaxKeyLen(e){return Math.max(0,...Object.keys(e).map(n=>n.length))}static isDecimalDigit(e){return e>=48&&e<=57}static binaryPrecedence(e){return u.binary_ops[e]||0}static isIdentifierStart(e){return e>=65&&e<=90||e>=97&&e<=122||e>=128&&!u.binary_ops[String.fromCharCode(e)]||u.additional_identifier_chars.has(String.fromCharCode(e))}static isIdentifierPart(e){return u.isIdentifierStart(e)||u.isDecimalDigit(e)}throwError(e){const n=new Error(e+" at character "+this.index);throw n.index=this.index,n.description=e,n}runHook(e,n){if(u.hooks[e]){const r={context:this,node:n};return u.hooks.run(e,r),r.node}return n}searchHook(e){if(u.hooks[e]){const n={context:this};return u.hooks[e].find(function(r){return r.call(n.context,n),n.node}),n.node}}gobbleSpaces(){let e=this.code;for(;e===u.SPACE_CODE||e===u.TAB_CODE||e===u.LF_CODE||e===u.CR_CODE;)e=this.expr.charCodeAt(++this.index);this.runHook("gobble-spaces")}parse(){this.runHook("before-all");const e=this.gobbleExpressions(),n=e.length===1?e[0]:{type:u.COMPOUND,body:e};return this.runHook("after-all",n)}gobbleExpressions(e){let n=[],r,o;for(;this.index<this.expr.length;)if(r=this.code,r===u.SEMCOL_CODE||r===u.COMMA_CODE)this.index++;else if(o=this.gobbleExpression())n.push(o);else if(this.index<this.expr.length){if(r===e)break;this.throwError('Unexpected "'+this.char+'"')}return n}gobbleExpression(){const e=this.searchHook("gobble-expression")||this.gobbleBinaryExpression();return this.gobbleSpaces(),this.runHook("after-expression",e)}gobbleBinaryOp(){this.gobbleSpaces();let e=this.expr.substr(this.index,u.max_binop_len),n=e.length;for(;n>0;){if(u.binary_ops.hasOwnProperty(e)&&(!u.isIdentifierStart(this.code)||this.index+e.length<this.expr.length&&!u.isIdentifierPart(this.expr.charCodeAt(this.index+e.length))))return this.index+=n,e;e=e.substr(0,--n)}return!1}gobbleBinaryExpression(){let e,n,r,o,s,d,i,c,l;if(d=this.gobbleToken(),!d||(n=this.gobbleBinaryOp(),!n))return d;for(s={value:n,prec:u.binaryPrecedence(n),right_a:u.right_associative.has(n)},i=this.gobbleToken(),i||this.throwError("Expected expression after "+n),o=[d,s,i];n=this.gobbleBinaryOp();){if(r=u.binaryPrecedence(n),r===0){this.index-=n.length;break}s={value:n,prec:r,right_a:u.right_associative.has(n)},l=n;const h=p=>s.right_a&&p.right_a?r>p.prec:r<=p.prec;for(;o.length>2&&h(o[o.length-2]);)i=o.pop(),n=o.pop().value,d=o.pop(),e={type:u.BINARY_EXP,operator:n,left:d,right:i},o.push(e);e=this.gobbleToken(),e||this.throwError("Expected expression after "+l),o.push(s,e)}for(c=o.length-1,e=o[c];c>1;)e={type:u.BINARY_EXP,operator:o[c-1].value,left:o[c-2],right:e},c-=2;return e}gobbleToken(){let e,n,r,o;if(this.gobbleSpaces(),o=this.searchHook("gobble-token"),o)return this.runHook("after-token",o);if(e=this.code,u.isDecimalDigit(e)||e===u.PERIOD_CODE)return this.gobbleNumericLiteral();if(e===u.SQUOTE_CODE||e===u.DQUOTE_CODE)o=this.gobbleStringLiteral();else if(e===u.OBRACK_CODE)o=this.gobbleArray();else{for(n=this.expr.substr(this.index,u.max_unop_len),r=n.length;r>0;){if(u.unary_ops.hasOwnProperty(n)&&(!u.isIdentifierStart(this.code)||this.index+n.length<this.expr.length&&!u.isIdentifierPart(this.expr.charCodeAt(this.index+n.length)))){this.index+=r;const s=this.gobbleToken();return s||this.throwError("missing unaryOp argument"),this.runHook("after-token",{type:u.UNARY_EXP,operator:n,argument:s,prefix:!0})}n=n.substr(0,--r)}u.isIdentifierStart(e)?(o=this.gobbleIdentifier(),u.literals.hasOwnProperty(o.name)?o={type:u.LITERAL,value:u.literals[o.name],raw:o.name}:o.name===u.this_str&&(o={type:u.THIS_EXP})):e===u.OPAREN_CODE&&(o=this.gobbleGroup())}return o?(o=this.gobbleTokenProperty(o),this.runHook("after-token",o)):this.runHook("after-token",!1)}gobbleTokenProperty(e){this.gobbleSpaces();let n=this.code;for(;n===u.PERIOD_CODE||n===u.OBRACK_CODE||n===u.OPAREN_CODE||n===u.QUMARK_CODE;){let r;if(n===u.QUMARK_CODE){if(this.expr.charCodeAt(this.index+1)!==u.PERIOD_CODE)break;r=!0,this.index+=2,this.gobbleSpaces(),n=this.code}this.index++,n===u.OBRACK_CODE?(e={type:u.MEMBER_EXP,computed:!0,object:e,property:this.gobbleExpression()},e.property||this.throwError('Unexpected "'+this.char+'"'),this.gobbleSpaces(),n=this.code,n!==u.CBRACK_CODE&&this.throwError("Unclosed ["),this.index++):n===u.OPAREN_CODE?e={type:u.CALL_EXP,arguments:this.gobbleArguments(u.CPAREN_CODE),callee:e}:(n===u.PERIOD_CODE||r)&&(r&&this.index--,this.gobbleSpaces(),e={type:u.MEMBER_EXP,computed:!1,object:e,property:this.gobbleIdentifier()}),r&&(e.optional=!0),this.gobbleSpaces(),n=this.code}return e}gobbleNumericLiteral(){let e="",n,r;for(;u.isDecimalDigit(this.code);)e+=this.expr.charAt(this.index++);if(this.code===u.PERIOD_CODE)for(e+=this.expr.charAt(this.index++);u.isDecimalDigit(this.code);)e+=this.expr.charAt(this.index++);if(n=this.char,n==="e"||n==="E"){for(e+=this.expr.charAt(this.index++),n=this.char,(n==="+"||n==="-")&&(e+=this.expr.charAt(this.index++));u.isDecimalDigit(this.code);)e+=this.expr.charAt(this.index++);u.isDecimalDigit(this.expr.charCodeAt(this.index-1))||this.throwError("Expected exponent ("+e+this.char+")")}return r=this.code,u.isIdentifierStart(r)?this.throwError("Variable names cannot start with a number ("+e+this.char+")"):(r===u.PERIOD_CODE||e.length===1&&e.charCodeAt(0)===u.PERIOD_CODE)&&this.throwError("Unexpected period"),{type:u.LITERAL,value:parseFloat(e),raw:e}}gobbleStringLiteral(){let e="";const n=this.index,r=this.expr.charAt(this.index++);let o=!1;for(;this.index<this.expr.length;){let s=this.expr.charAt(this.index++);if(s===r){o=!0;break}else if(s==="\\")switch(s=this.expr.charAt(this.index++),s){case"n":e+=`
`;break;case"r":e+="\r";break;case"t":e+="	";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:e+=s}else e+=s}return o||this.throwError('Unclosed quote after "'+e+'"'),{type:u.LITERAL,value:e,raw:this.expr.substring(n,this.index)}}gobbleIdentifier(){let e=this.code,n=this.index;for(u.isIdentifierStart(e)?this.index++:this.throwError("Unexpected "+this.char);this.index<this.expr.length&&(e=this.code,u.isIdentifierPart(e));)this.index++;return{type:u.IDENTIFIER,name:this.expr.slice(n,this.index)}}gobbleArguments(e){const n=[];let r=!1,o=0;for(;this.index<this.expr.length;){this.gobbleSpaces();let s=this.code;if(s===e){r=!0,this.index++,e===u.CPAREN_CODE&&o&&o>=n.length&&this.throwError("Unexpected token "+String.fromCharCode(e));break}else if(s===u.COMMA_CODE){if(this.index++,o++,o!==n.length){if(e===u.CPAREN_CODE)this.throwError("Unexpected token ,");else if(e===u.CBRACK_CODE)for(let d=n.length;d<o;d++)n.push(null)}}else if(n.length!==o&&o!==0)this.throwError("Expected comma");else{const d=this.gobbleExpression();(!d||d.type===u.COMPOUND)&&this.throwError("Expected comma"),n.push(d)}}return r||this.throwError("Expected "+String.fromCharCode(e)),n}gobbleGroup(){this.index++;let e=this.gobbleExpressions(u.CPAREN_CODE);if(this.code===u.CPAREN_CODE)return this.index++,e.length===1?e[0]:e.length?{type:u.SEQUENCE_EXP,expressions:e}:!1;this.throwError("Unclosed (")}gobbleArray(){return this.index++,{type:u.ARRAY_EXP,elements:this.gobbleArguments(u.CBRACK_CODE)}}}const Et=new bt;Object.assign(u,{hooks:Et,plugins:new gt(u),COMPOUND:"Compound",SEQUENCE_EXP:"SequenceExpression",IDENTIFIER:"Identifier",MEMBER_EXP:"MemberExpression",LITERAL:"Literal",THIS_EXP:"ThisExpression",CALL_EXP:"CallExpression",UNARY_EXP:"UnaryExpression",BINARY_EXP:"BinaryExpression",ARRAY_EXP:"ArrayExpression",TAB_CODE:9,LF_CODE:10,CR_CODE:13,SPACE_CODE:32,PERIOD_CODE:46,COMMA_CODE:44,SQUOTE_CODE:39,DQUOTE_CODE:34,OPAREN_CODE:40,CPAREN_CODE:41,OBRACK_CODE:91,CBRACK_CODE:93,QUMARK_CODE:63,SEMCOL_CODE:59,COLON_CODE:58,unary_ops:{"-":1,"!":1,"~":1,"+":1},binary_ops:{"||":1,"??":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10,"**":11},right_associative:new Set(["**"]),additional_identifier_chars:new Set(["$","_"]),literals:{true:!0,false:!1,null:null},this_str:"this"});u.max_unop_len=u.getMaxKeyLen(u.unary_ops);u.max_binop_len=u.getMaxKeyLen(u.binary_ops);const P=t=>new u(t).parse(),vt=Object.getOwnPropertyNames(class{});Object.getOwnPropertyNames(u).filter(t=>!vt.includes(t)&&P[t]===void 0).forEach(t=>{P[t]=u[t]});P.Jsep=u;const wt="ConditionalExpression";var St={name:"ternary",init(t){t.hooks.add("after-expression",function(n){if(n.node&&this.code===t.QUMARK_CODE){this.index++;const r=n.node,o=this.gobbleExpression();if(o||this.throwError("Expected expression"),this.gobbleSpaces(),this.code===t.COLON_CODE){this.index++;const s=this.gobbleExpression();if(s||this.throwError("Expected expression"),n.node={type:wt,test:r,consequent:o,alternate:s},r.operator&&t.binary_ops[r.operator]<=.9){let d=r;for(;d.right.operator&&t.binary_ops[d.right.operator]<=.9;)d=d.right;n.node.test=d.right,d.right=n.node,n.node=r}}else this.throwError("Expected :")}})}};P.plugins.register(St);const be=47,Ct=92;var xt={name:"regex",init(t){t.hooks.add("gobble-token",function(n){if(this.code===be){const r=++this.index;let o=!1;for(;this.index<this.expr.length;){if(this.code===be&&!o){const s=this.expr.slice(r,this.index);let d="";for(;++this.index<this.expr.length;){const c=this.code;if(c>=97&&c<=122||c>=65&&c<=90||c>=48&&c<=57)d+=this.char;else break}let i;try{i=new RegExp(s,d)}catch(c){this.throwError(c.message)}return n.node={type:t.LITERAL,value:i,raw:this.expr.slice(r-1,this.index)},n.node=this.gobbleTokenProperty(n.node),n.node}this.code===t.OBRACK_CODE?o=!0:o&&this.code===t.CBRACK_CODE&&(o=!1),this.index+=this.code===Ct?2:1}this.throwError("Unclosed Regex")}})}};const re=43,kt=45,N={name:"assignment",assignmentOperators:new Set(["=","*=","**=","/=","%=","+=","-=","<<=",">>=",">>>=","&=","^=","|=","||=","&&=","??="]),updateOperators:[re,kt],assignmentPrecedence:.9,init(t){const e=[t.IDENTIFIER,t.MEMBER_EXP];N.assignmentOperators.forEach(r=>t.addBinaryOp(r,N.assignmentPrecedence,!0)),t.hooks.add("gobble-token",function(o){const s=this.code;N.updateOperators.some(d=>d===s&&d===this.expr.charCodeAt(this.index+1))&&(this.index+=2,o.node={type:"UpdateExpression",operator:s===re?"++":"--",argument:this.gobbleTokenProperty(this.gobbleIdentifier()),prefix:!0},(!o.node.argument||!e.includes(o.node.argument.type))&&this.throwError(`Unexpected ${o.node.operator}`))}),t.hooks.add("after-token",function(o){if(o.node){const s=this.code;N.updateOperators.some(d=>d===s&&d===this.expr.charCodeAt(this.index+1))&&(e.includes(o.node.type)||this.throwError(`Unexpected ${o.node.operator}`),this.index+=2,o.node={type:"UpdateExpression",operator:s===re?"++":"--",argument:o.node,prefix:!1})}}),t.hooks.add("after-expression",function(o){o.node&&n(o.node)});function n(r){N.assignmentOperators.has(r.operator)?(r.type="AssignmentExpression",n(r.left),n(r.right)):r.operator||Object.values(r).forEach(o=>{o&&typeof o=="object"&&n(o)})}}};P.plugins.register(xt,N);P.addUnaryOp("typeof");P.addLiteral("null",null);P.addLiteral("undefined",void 0);const Tt=new Set(["constructor","__proto__","__defineGetter__","__defineSetter__"]),w={evalAst(t,e){switch(t.type){case"BinaryExpression":case"LogicalExpression":return w.evalBinaryExpression(t,e);case"Compound":return w.evalCompound(t,e);case"ConditionalExpression":return w.evalConditionalExpression(t,e);case"Identifier":return w.evalIdentifier(t,e);case"Literal":return w.evalLiteral(t,e);case"MemberExpression":return w.evalMemberExpression(t,e);case"UnaryExpression":return w.evalUnaryExpression(t,e);case"ArrayExpression":return w.evalArrayExpression(t,e);case"CallExpression":return w.evalCallExpression(t,e);case"AssignmentExpression":return w.evalAssignmentExpression(t,e);default:throw SyntaxError("Unexpected expression",t)}},evalBinaryExpression(t,e){return{"||":(r,o)=>r||o(),"&&":(r,o)=>r&&o(),"|":(r,o)=>r|o(),"^":(r,o)=>r^o(),"&":(r,o)=>r&o(),"==":(r,o)=>r==o(),"!=":(r,o)=>r!=o(),"===":(r,o)=>r===o(),"!==":(r,o)=>r!==o(),"<":(r,o)=>r<o(),">":(r,o)=>r>o(),"<=":(r,o)=>r<=o(),">=":(r,o)=>r>=o(),"<<":(r,o)=>r<<o(),">>":(r,o)=>r>>o(),">>>":(r,o)=>r>>>o(),"+":(r,o)=>r+o(),"-":(r,o)=>r-o(),"*":(r,o)=>r*o(),"/":(r,o)=>r/o(),"%":(r,o)=>r%o()}[t.operator](w.evalAst(t.left,e),()=>w.evalAst(t.right,e))},evalCompound(t,e){let n;for(let r=0;r<t.body.length;r++){t.body[r].type==="Identifier"&&["var","let","const"].includes(t.body[r].name)&&t.body[r+1]&&t.body[r+1].type==="AssignmentExpression"&&(r+=1);const o=t.body[r];n=w.evalAst(o,e)}return n},evalConditionalExpression(t,e){return w.evalAst(t.test,e)?w.evalAst(t.consequent,e):w.evalAst(t.alternate,e)},evalIdentifier(t,e){if(Object.hasOwn(e,t.name))return e[t.name];throw ReferenceError(`${t.name} is not defined`)},evalLiteral(t){return t.value},evalMemberExpression(t,e){const n=String(t.computed?w.evalAst(t.property):t.property.name),r=w.evalAst(t.object,e);if(r==null)throw TypeError(`Cannot read properties of ${r} (reading '${n}')`);if(!Object.hasOwn(r,n)&&Tt.has(n))throw TypeError(`Cannot read properties of ${r} (reading '${n}')`);const o=r[n];return typeof o=="function"?o.bind(r):o},evalUnaryExpression(t,e){return{"-":r=>-w.evalAst(r,e),"!":r=>!w.evalAst(r,e),"~":r=>~w.evalAst(r,e),"+":r=>+w.evalAst(r,e),typeof:r=>typeof w.evalAst(r,e)}[t.operator](t.argument)},evalArrayExpression(t,e){return t.elements.map(n=>w.evalAst(n,e))},evalCallExpression(t,e){const n=t.arguments.map(o=>w.evalAst(o,e));return w.evalAst(t.callee,e)(...n)},evalAssignmentExpression(t,e){if(t.left.type!=="Identifier")throw SyntaxError("Invalid left-hand side in assignment");const n=t.left.name,r=w.evalAst(t.right,e);return e[n]=r,e[n]}};class Bt{constructor(e){this.code=e,this.ast=P(this.code)}runInNewContext(e){const n=Object.assign(Object.create(null),e);return w.evalAst(this.ast,n)}}function $(t,e){return t=t.slice(),t.push(e),t}function oe(t,e){return e=e.slice(),e.unshift(t),e}class It extends Error{constructor(e){super('JSONPath should not be called with "new" (it prevents return of (unwrapped) scalar values)'),this.avoidNew=!0,this.value=e,this.name="NewError"}}function v(t,e,n,r,o){if(!(this instanceof v))try{return new v(t,e,n,r,o)}catch(d){if(!d.avoidNew)throw d;return d.value}typeof t=="string"&&(o=r,r=n,n=e,e=t,t=null);const s=t&&typeof t=="object";if(t=t||{},this.json=t.json||n,this.path=t.path||e,this.resultType=t.resultType||"value",this.flatten=t.flatten||!1,this.wrap=Object.hasOwn(t,"wrap")?t.wrap:!0,this.sandbox=t.sandbox||{},this.eval=t.eval===void 0?"safe":t.eval,this.ignoreEvalErrors=typeof t.ignoreEvalErrors>"u"?!1:t.ignoreEvalErrors,this.parent=t.parent||null,this.parentProperty=t.parentProperty||null,this.callback=t.callback||r||null,this.otherTypeCallback=t.otherTypeCallback||o||function(){throw new TypeError("You must supply an otherTypeCallback callback option with the @other() operator.")},t.autostart!==!1){const d={path:s?t.path:e};s?"json"in t&&(d.json=t.json):d.json=n;const i=this.evaluate(d);if(!i||typeof i!="object")throw new It(i);return i}}v.prototype.evaluate=function(t,e,n,r){let o=this.parent,s=this.parentProperty,{flatten:d,wrap:i}=this;if(this.currResultType=this.resultType,this.currEval=this.eval,this.currSandbox=this.sandbox,n=n||this.callback,this.currOtherTypeCallback=r||this.otherTypeCallback,e=e||this.json,t=t||this.path,t&&typeof t=="object"&&!Array.isArray(t)){if(!t.path&&t.path!=="")throw new TypeError('You must supply a "path" property when providing an object argument to JSONPath.evaluate().');if(!Object.hasOwn(t,"json"))throw new TypeError('You must supply a "json" property when providing an object argument to JSONPath.evaluate().');({json:e}=t),d=Object.hasOwn(t,"flatten")?t.flatten:d,this.currResultType=Object.hasOwn(t,"resultType")?t.resultType:this.currResultType,this.currSandbox=Object.hasOwn(t,"sandbox")?t.sandbox:this.currSandbox,i=Object.hasOwn(t,"wrap")?t.wrap:i,this.currEval=Object.hasOwn(t,"eval")?t.eval:this.currEval,n=Object.hasOwn(t,"callback")?t.callback:n,this.currOtherTypeCallback=Object.hasOwn(t,"otherTypeCallback")?t.otherTypeCallback:this.currOtherTypeCallback,o=Object.hasOwn(t,"parent")?t.parent:o,s=Object.hasOwn(t,"parentProperty")?t.parentProperty:s,t=t.path}if(o=o||null,s=s||null,Array.isArray(t)&&(t=v.toPathString(t)),!t&&t!==""||!e)return;const c=v.toPathArray(t);c[0]==="$"&&c.length>1&&c.shift(),this._hasParentSelector=null;const l=this._trace(c,e,["$"],o,s,n).filter(function(h){return h&&!h.isParentSelector});return l.length?!i&&l.length===1&&!l[0].hasArrExpr?this._getPreferredOutput(l[0]):l.reduce((h,p)=>{const y=this._getPreferredOutput(p);return d&&Array.isArray(y)?h=h.concat(y):h.push(y),h},[]):i?[]:void 0};v.prototype._getPreferredOutput=function(t){const e=this.currResultType;switch(e){case"all":{const n=Array.isArray(t.path)?t.path:v.toPathArray(t.path);return t.pointer=v.toPointer(n),t.path=typeof t.path=="string"?t.path:v.toPathString(t.path),t}case"value":case"parent":case"parentProperty":return t[e];case"path":return v.toPathString(t[e]);case"pointer":return v.toPointer(t.path);default:throw new TypeError("Unknown result type")}};v.prototype._handleCallback=function(t,e,n){if(e){const r=this._getPreferredOutput(t);t.path=typeof t.path=="string"?t.path:v.toPathString(t.path),e(r,n,t)}};v.prototype._trace=function(t,e,n,r,o,s,d,i){let c;if(!t.length)return c={path:n,value:e,parent:r,parentProperty:o,hasArrExpr:d},this._handleCallback(c,s,"value"),c;const l=t[0],h=t.slice(1),p=[];function y(m){Array.isArray(m)?m.forEach(f=>{p.push(f)}):p.push(m)}if((typeof l!="string"||i)&&e&&Object.hasOwn(e,l))y(this._trace(h,e[l],$(n,l),e,l,s,d));else if(l==="*")this._walk(e,m=>{y(this._trace(h,e[m],$(n,m),e,m,s,!0,!0))});else if(l==="..")y(this._trace(h,e,n,r,o,s,d)),this._walk(e,m=>{typeof e[m]=="object"&&y(this._trace(t.slice(),e[m],$(n,m),e,m,s,!0))});else{if(l==="^")return this._hasParentSelector=!0,{path:n.slice(0,-1),expr:h,isParentSelector:!0};if(l==="~")return c={path:$(n,l),value:o,parent:r,parentProperty:null},this._handleCallback(c,s,"property"),c;if(l==="$")y(this._trace(h,e,n,null,null,s,d));else if(/^(-?\d*):(-?\d*):?(\d*)$/u.test(l))y(this._slice(l,h,e,n,r,o,s));else if(l.indexOf("?(")===0){if(this.currEval===!1)throw new Error("Eval [?(expr)] prevented in JSONPath expression.");const m=l.replace(/^\?\((.*?)\)$/u,"$1"),f=/@.?([^?]*)[['](\??\(.*?\))(?!.\)\])[\]']/gu.exec(m);f?this._walk(e,b=>{const g=[f[2]],E=f[1]?e[b][f[1]]:e[b];this._trace(g,E,n,r,o,s,!0).length>0&&y(this._trace(h,e[b],$(n,b),e,b,s,!0))}):this._walk(e,b=>{this._eval(m,e[b],b,n,r,o)&&y(this._trace(h,e[b],$(n,b),e,b,s,!0))})}else if(l[0]==="("){if(this.currEval===!1)throw new Error("Eval [(expr)] prevented in JSONPath expression.");y(this._trace(oe(this._eval(l,e,n.at(-1),n.slice(0,-1),r,o),h),e,n,r,o,s,d))}else if(l[0]==="@"){let m=!1;const f=l.slice(1,-2);switch(f){case"scalar":(!e||!["object","function"].includes(typeof e))&&(m=!0);break;case"boolean":case"string":case"undefined":case"function":typeof e===f&&(m=!0);break;case"integer":Number.isFinite(e)&&!(e%1)&&(m=!0);break;case"number":Number.isFinite(e)&&(m=!0);break;case"nonFinite":typeof e=="number"&&!Number.isFinite(e)&&(m=!0);break;case"object":e&&typeof e===f&&(m=!0);break;case"array":Array.isArray(e)&&(m=!0);break;case"other":m=this.currOtherTypeCallback(e,n,r,o);break;case"null":e===null&&(m=!0);break;default:throw new TypeError("Unknown value type "+f)}if(m)return c={path:n,value:e,parent:r,parentProperty:o},this._handleCallback(c,s,"value"),c}else if(l[0]==="`"&&e&&Object.hasOwn(e,l.slice(1))){const m=l.slice(1);y(this._trace(h,e[m],$(n,m),e,m,s,d,!0))}else if(l.includes(",")){const m=l.split(",");for(const f of m)y(this._trace(oe(f,h),e,n,r,o,s,!0))}else!i&&e&&Object.hasOwn(e,l)&&y(this._trace(h,e[l],$(n,l),e,l,s,d,!0))}if(this._hasParentSelector)for(let m=0;m<p.length;m++){const f=p[m];if(f&&f.isParentSelector){const b=this._trace(f.expr,e,f.path,r,o,s,d);if(Array.isArray(b)){p[m]=b[0];const g=b.length;for(let E=1;E<g;E++)m++,p.splice(m,0,b[E])}else p[m]=b}}return p};v.prototype._walk=function(t,e){if(Array.isArray(t)){const n=t.length;for(let r=0;r<n;r++)e(r)}else t&&typeof t=="object"&&Object.keys(t).forEach(n=>{e(n)})};v.prototype._slice=function(t,e,n,r,o,s,d){if(!Array.isArray(n))return;const i=n.length,c=t.split(":"),l=c[2]&&Number.parseInt(c[2])||1;let h=c[0]&&Number.parseInt(c[0])||0,p=c[1]&&Number.parseInt(c[1])||i;h=h<0?Math.max(0,h+i):Math.min(i,h),p=p<0?Math.max(0,p+i):Math.min(i,p);const y=[];for(let m=h;m<p;m+=l)this._trace(oe(m,e),n,r,o,s,d,!0).forEach(b=>{y.push(b)});return y};v.prototype._eval=function(t,e,n,r,o,s){this.currSandbox._$_parentProperty=s,this.currSandbox._$_parent=o,this.currSandbox._$_property=n,this.currSandbox._$_root=this.json,this.currSandbox._$_v=e;const d=t.includes("@path");d&&(this.currSandbox._$_path=v.toPathString(r.concat([n])));const i=this.currEval+"Script:"+t;if(!v.cache[i]){let c=t.replaceAll("@parentProperty","_$_parentProperty").replaceAll("@parent","_$_parent").replaceAll("@property","_$_property").replaceAll("@root","_$_root").replaceAll(/@([.\s)[])/gu,"_$_v$1");if(d&&(c=c.replaceAll("@path","_$_path")),this.currEval==="safe"||this.currEval===!0||this.currEval===void 0)v.cache[i]=new this.safeVm.Script(c);else if(this.currEval==="native")v.cache[i]=new this.vm.Script(c);else if(typeof this.currEval=="function"&&this.currEval.prototype&&Object.hasOwn(this.currEval.prototype,"runInNewContext")){const l=this.currEval;v.cache[i]=new l(c)}else if(typeof this.currEval=="function")v.cache[i]={runInNewContext:l=>this.currEval(c,l)};else throw new TypeError(`Unknown "eval" property "${this.currEval}"`)}try{return v.cache[i].runInNewContext(this.currSandbox)}catch(c){if(this.ignoreEvalErrors)return!1;throw new Error("jsonPath: "+c.message+": "+t)}};v.cache={};v.toPathString=function(t){const e=t,n=e.length;let r="$";for(let o=1;o<n;o++)/^(~|\^|@.*?\(\))$/u.test(e[o])||(r+=/^[0-9*]+$/u.test(e[o])?"["+e[o]+"]":"['"+e[o]+"']");return r};v.toPointer=function(t){const e=t,n=e.length;let r="";for(let o=1;o<n;o++)/^(~|\^|@.*?\(\))$/u.test(e[o])||(r+="/"+e[o].toString().replaceAll("~","~0").replaceAll("/","~1"));return r};v.toPathArray=function(t){const{cache:e}=v;if(e[t])return e[t].concat();const n=[],o=t.replaceAll(/@(?:null|boolean|number|string|integer|undefined|nonFinite|scalar|array|object|function|other)\(\)/gu,";$&;").replaceAll(/[['](\??\(.*?\))[\]'](?!.\])/gu,function(s,d){return"[#"+(n.push(d)-1)+"]"}).replaceAll(/\[['"]([^'\]]*)['"]\]/gu,function(s,d){return"['"+d.replaceAll(".","%@%").replaceAll("~","%%@@%%")+"']"}).replaceAll("~",";~;").replaceAll(/['"]?\.['"]?(?![^[]*\])|\[['"]?/gu,";").replaceAll("%@%",".").replaceAll("%%@@%%","~").replaceAll(/(?:;)?(\^+)(?:;)?/gu,function(s,d){return";"+d.split("").join(";")+";"}).replaceAll(/;;;|;;/gu,";..;").replaceAll(/;$|'?\]|'$/gu,"").split(";").map(function(s){const d=s.match(/#(\d+)/u);return!d||!d[1]?s:n[d[1]]});return e[t]=o,e[t].concat()};v.prototype.safeVm={Script:Bt};const Ot=function(t,e,n){const r=t.length;for(let o=0;o<r;o++){const s=t[o];n(s)&&e.push(t.splice(o--,1)[0])}};class qt{constructor(e){this.code=e}runInNewContext(e){let n=this.code;const r=Object.keys(e),o=[];Ot(r,o,l=>typeof e[l]=="function");const s=r.map(l=>e[l]);n=o.reduce((l,h)=>{let p=e[h].toString();return/function/u.test(p)||(p="function "+p),"var "+h+"="+p+";"+l},"")+n,!/(['"])use strict\1/u.test(n)&&!r.includes("arguments")&&(n="var arguments = undefined;"+n),n=n.replace(/;\s*$/u,"");const i=n.lastIndexOf(";"),c=i!==-1?n.slice(0,i+1)+" return "+n.slice(i+1):" return "+n;return new Function(...r,c)(...s)}}v.prototype.vm={Script:qt};function At(){document.getElementById("newEnvironmentBtn").addEventListener("click",we),document.getElementById("editEnvironmentBtn").addEventListener("click",Se),document.getElementById("environmentSelect").addEventListener("change",ce),document.getElementById("addGlobalVarBtn").addEventListener("click",()=>X("global")),document.getElementById("addEnvVarBtn").addEventListener("click",()=>X("environment")),document.getElementById("addCollectionVarBtn").addEventListener("click",()=>X("collection")),document.getElementById("collectionVarSelect").addEventListener("change",()=>{a.currentCollection=document.getElementById("collectionVarSelect").value,q("collection")})}async function ve(){var t;try{{const n=(await chrome.storage.local.get(["variables"])).variables||{};!n.global||Object.keys(n.global).length===0?(a.variables.global={...lt},a.variables.collection=n.collection||{},await chrome.storage.local.set({variables:{global:a.variables.global,collection:a.variables.collection}})):(a.variables.global=n.global,a.variables.collection=n.collection||{})}{const n=(await chrome.storage.local.get(["environments"])).environments||[];if(n.length===0){a.environments=[...ye];for(const r of ye){const o=dt[r.id]||{};a.variables.environment={...o},await chrome.storage.local.set({[`env_${r.id}`]:a.variables.environment})}await chrome.storage.local.set({environments:a.environments})}else if(a.environments.splice(0,a.environments.length,...n),a.currentEnvironment){const r=await chrome.storage.local.get([`env_${a.currentEnvironment}`]);a.variables.environment=r[`env_${a.currentEnvironment}`]||{}}else a.variables.environment={}}{const n=((t=(await chrome.storage.local.get(["variables"])).variables)==null?void 0:t.collection)||{};!n||Object.keys(n).length===0?(a.variables.collection={...ht},await chrome.storage.local.set({variables:{global:a.variables.global,collection:a.variables.collection}})):a.variables.collection=n}V(),At(),R(),J(),console.log("Variables management initialized")}catch(e){console.error("Error initializing variables management:",e)}}function V(){const t=document.getElementById("environmentSelect");if(!t)return;t.innerHTML="";const e=document.createElement("option");e.value="",e.textContent="No Environment",t.appendChild(e),a.environments.forEach(n=>{const r=document.createElement("option");r.value=n.id,r.textContent=n.name,n.id===a.currentEnvironment&&(r.selected=!0),t.appendChild(r)})}async function we(){const t=prompt("Enter environment name:");if(!t)return;const e={id:`env_${Date.now()}_${Math.random().toString(36).substring(2)}`,name:t,created:new Date().toISOString()};a.environments.push(e),await ne(),await chrome.storage.local.set({[`env_${e.id}`]:{}}),V(),document.getElementById("environmentSelect").value=e.id,await ce(),S("Environment created: "+t)}async function Se(){if(!a.currentEnvironment){x("No environment selected");return}const t=a.environments.find(n=>n.id===a.currentEnvironment);if(!t)return;const e=prompt("Edit environment name:",t.name);!e||e===t.name||(t.name=e,await ne(),V(),S("Environment renamed to: "+e))}async function ce(){var r;const e=document.getElementById("environmentSelect").value;if(a.currentEnvironment&&await me(a.currentEnvironment),a.currentEnvironment=e,await tn(),e){const o=await chrome.storage.local.get([`env_${e}`]);a.variables.environment=o[`env_${e}`]||{}}else a.variables.environment={};const n=e?(r=a.environments.find(o=>o.id===e))==null?void 0:r.name:"No Environment";S("Switched to: "+n),q("environment")}function R(){const t=document.getElementById("collectionVarSelect");if(!t)return;t.innerHTML="";const e=document.createElement("option");e.value="",e.textContent="Select Collection",t.appendChild(e),a.collections.forEach(n=>{const r=document.createElement("option");r.value=n.id,r.textContent=n.name,n.id===a.currentCollection&&(r.selected=!0),t.appendChild(r)})}function J(){q("global"),q("environment"),q("collection")}function q(t){let e,n;if(t==="global")e=document.getElementById("globalVariablesContainer"),n=a.variables.global;else if(t==="environment"){if(e=document.getElementById("envVariablesContainer"),!a.currentEnvironment){e.innerHTML='<p class="empty-message">Select an environment to manage variables</p>',console.log("renderVariables is return currentEnvironment");return}n=a.variables.environment}else if(t==="collection"){if(e=document.getElementById("collectionVariablesContainer"),!a.currentCollection){e.innerHTML='<p class="empty-message">Select a collection to manage variables</p>',console.log("renderVariables is return currentCollection");return}n=a.variables.collection||{}}else{console.log("renderVariables is return");return}e.innerHTML="";const r=document.createElement("div");r.className="variable-header-row",r.innerHTML=`
      <span>Variable</span>
      <span>Value</span>
      <span>Description</span>
      <span></span>
    `,e.appendChild(r);const o=Object.entries(n||{});if(o.length===0){const s=document.createElement("div");s.className="empty-variables",s.innerHTML='<p>No variables defined. Click "Add" to create one.</p>',e.appendChild(s)}else o.forEach(([s,d])=>{const{value:i,description:c}=d,l=le(t,s,i,c);e.appendChild(l)})}function le(t,e="",n="",r=""){const o=document.createElement("div");o.className="variable-row",o.dataset.originalKey=e,o.innerHTML=`
        <input type="text" class="var-key" placeholder="Variable name" value="${B(e)}">
        <input type="text" class="var-value" placeholder="Value" value="${B(n)}">
        <input type="text" class="var-description" placeholder="Description" value="${B(r)}">
        <button class="delete-btn">×</button>
    `;const s=o.querySelector(".var-key"),d=o.querySelector(".var-value"),i=o.querySelector(".var-description"),c=o.querySelector(".delete-btn"),l=async()=>{const h=s.value.trim(),p=d.value,y=i.value,m=o.dataset.originalKey;if(!h){m&&(await G(t,m),o.remove());return}if(h!==m&&Ce(t,h)){x(`Variable "${h}" already exists in this scope`),s.value=m;return}m&&m!==h&&await G(t,m),await xe(t,h,p,y),o.dataset.originalKey=h};return s.addEventListener("blur",l),d.addEventListener("blur",l),i.addEventListener("blur",l),c.addEventListener("click",async()=>{const h=o.dataset.originalKey||s.value.trim();h?confirm(`Delete variable "${h}"?`)&&(await G(t,h),o.remove(),S(`Variable "${h}" deleted`)):o.remove()}),o}function Ce(t,e){switch(t){case"global":return e in a.variables.global;case"environment":return e in a.variables.environment;case"collection":return a.currentCollection&&a.variables.collection[a.currentCollection]&&e in a.variables.collection[a.currentCollection]}return!1}async function xe(t,e,n,r){const o={value:n,description:r};switch(t){case"global":a.variables.global[e]=o,await D();break;case"environment":a.variables.environment[e]=o,await me(e);break;case"collection":if(!a.currentCollection)return;a.variables.collection[a.currentCollection]||(a.variables.collection[a.currentCollection]={}),a.variables.collection[a.currentCollection][e]=o,await D();break}}async function G(t,e){switch(t){case"global":delete a.variables.global[e],await D(),q("global");break;case"environment":if(!a.currentEnvironment)return;delete a.variables.environment[e],await me(a.currentEnvironment),q("environment");break;case"collection":if(!a.currentCollection)return;delete a.variables.collection[a.currentCollection][e],await D(),q("collection");break}}function X(t){if(t==="environment"&&!a.currentEnvironment){x("Please select an environment first");return}if(t==="collection"&&!document.getElementById("collectionVarSelect").value){x("Please select a collection first");return}let e;switch(t){case"global":e=document.getElementById("globalVariablesContainer");break;case"environment":e=document.getElementById("envVariablesContainer");break;case"collection":e=document.getElementById("collectionVariablesContainer");break}const n=e.querySelector(".empty-variables");n&&n.remove();const r=le(t);e.appendChild(r),r.querySelector(".var-key").focus()}function U(t){var n,r;if(t.startsWith("${")&&t.endsWith("}")){const o=t.slice(2,-1),s=[],d=/\.?"([^"]+)"|\.jsonPath\("([^"]+)"\)/g;let i,c=0;for(;(i=d.exec(o))!==null;){if(i.index!==c)throw new Error(`変数参照構文が不正です: ${o.slice(c,i.index)}`);if(c=i.index+i[0].length,i[1])s.push(i[1]);else if(i[2]){let E=i[2];E.startsWith("$")||(E="$"+E),console.log("jsonPathExpr",E),s.push({jsonPath:E})}}if(c<o.length)throw new Error(`変数参照構文が不正です: ${o.slice(c)}`);if(s.length<4)throw new Error(`変数参照構文が不正です: ${t}`);const[l,h,p,...y]=s,m=a.collections.find(E=>E.name===l);if(!m)throw new Error(`コレクション「${l}」が見つかりません`);const f=m.requests.find(E=>E.name===h);if(!f)throw new Error(`リクエスト「${h}」が見つかりません`);const b=p==="response"?f.lastResponseExecution||f.lastResponse:f.lastRequestExecution||f.lastRequest;if(!b)throw new Error(`${p} の実行結果が存在しません`);let g=b;for(let E=0;E<y.length;E++){const C=y[E];if(C==="headers"){const k=y[++E];if(!k)throw new Error("ヘッダー名が指定されていません");const O=Object.entries(g.headers||{}).find(([_])=>_.toLowerCase()===k.toLowerCase());if(!O)throw new Error(`ヘッダー "${k}" が見つかりません`);return O[1]}if(C==="body"){g=g.body;const k=y[E+1];if(k&&typeof k=="object"&&k.jsonPath){console.log("next.jsonPath",k.jsonPath);try{const O=typeof g=="string"?JSON.parse(g):g;console.log("JSONPath処理前のJSON:",O),console.log("使用するJSONPath:",k.jsonPath);const _=v({path:k.jsonPath,json:O});if(console.log("JSONPath処理結果:",_),!Array.isArray(_)||_.length===0)throw new Error(`JSONPath "${k.jsonPath}" に一致する値がありません`);return _[0]}catch(O){throw console.error("JSONPath処理エラー:",O),new Error(`JSONPath の処理に失敗しました: ${O.message}`)}}return g}if(g!=null&&typeof g=="object"&&C in g)g=g[C];else throw new Error(`プロパティ "${C}" が見つかりません`)}return g}if(t.startsWith("{{")&&t.endsWith("}}")){const o=t.slice(2,-2).trim();return a.variables.environment[o]?a.variables.environment[o].value:a.variables.global[o]?a.variables.global[o].value:a.currentCollection&&((n=a.variables.collection[a.currentCollection])!=null&&n[o])?a.variables.collection[a.currentCollection][o].value:void 0}const e=t.trim();if(a.variables.environment[e])return a.variables.environment[e].value;if(a.variables.global[e])return a.variables.global[e].value;if(a.currentCollection&&((r=a.variables.collection[a.currentCollection])!=null&&r[e]))return a.variables.collection[a.currentCollection][e].value}function z(t){return typeof t!="string"?t:t.replace(/\{\{([^}]+)\}\}/g,(e,n)=>{const r=n.trim(),o=U(r);return o!==void 0?o:e})}function M(t){if(typeof t=="string")return z(t);if(Array.isArray(t))return t.map(M);if(t&&typeof t=="object"){const e={};for(const[n,r]of Object.entries(t)){const o=z(n);e[o]=M(r)}return e}return t}async function Rt(t,e,n){const r={value:n,description:""};switch(t){case"global":a.variables.global[e]=r,await chrome.storage.local.set({variables:{global:a.variables.global,collection:a.variables.collection}});break;case"environment":a.currentEnvironment&&(a.variables.environment[e]=r,await chrome.storage.local.set({[`env_${a.currentEnvironment}`]:a.variables.environment}));break}}const Lt=Object.freeze(Object.defineProperty({__proto__:null,addVariableRow:X,createNewEnvironment:we,createVariableRow:le,deepReplaceVariables:M,deleteVariable:G,editCurrentEnvironment:Se,getVariable:U,initializeVariablesManagement:ve,renderAllVariables:J,renderEnvironmentSelector:V,renderVariables:q,replaceVariables:z,saveVariable:xe,setVariable:Rt,switchEnvironment:ce,updateCollectionVarSelector:R,variableExists:Ce},Symbol.toStringTag,{value:"Module"}));function ke(t){a.currentRequest=JSON.parse(JSON.stringify(t)),a.currentRequest.method=t.method,a.currentRequest.url=t.url,a.currentRequest.headers={...t.headers},a.currentRequest.params={...t.params},a.currentRequest.body=t.body,a.currentRequest.auth={...t.auth};const e=document.getElementById("request-name-display");e&&(e.innerHTML=`<input type="text" id="nameInput" value="${t.name}"></input>`);const n=document.getElementById("request-id-display");n&&(n.innerHTML=`<span>Request ID: <em>${t.id}</em></span>`),document.getElementById("methodSelect").value=t.method,document.getElementById("urlInput").value=t.url;const r=document.getElementById("headersContainer");r.innerHTML="",t.headers&&Object.keys(t.headers).length>0?Object.entries(t.headers).forEach(([i,c])=>{T(r,"header");const l=r.querySelectorAll(".key-value-row"),h=l[l.length-1];h.querySelector(".key-input").value=i,h.querySelector(".value-input").value=c}):T(r,"header");const o=document.getElementById("paramsContainer");if(o.innerHTML="",t.params&&Object.keys(t.params).length>0?Object.entries(t.params).forEach(([i,c])=>{T(o,"param");const l=o.querySelectorAll(".key-value-row"),h=l[l.length-1];h.querySelector(".key-input").value=i,h.querySelector(".value-input").value=c}):T(o,"param"),t.body)if(typeof t.body=="string")document.querySelector('input[name="bodyType"][value="raw"]').checked=!0,H({target:{value:"raw"}}),document.getElementById("rawBody").value=t.body;else{document.querySelector('input[name="bodyType"][value="form-data"]').checked=!0,H({target:{value:"form-data"}});const i=document.getElementById("formDataContainer");i.innerHTML="",Object.entries(t.body).forEach(([c,l])=>{T(i,"body");const h=i.querySelectorAll(".key-value-row"),p=h[h.length-1];p.querySelector(".key-input").value=c,p.querySelector(".value-input").value=l})}else document.querySelector('input[name="bodyType"][value="none"]').checked=!0,H({target:{value:"none"}});if(t.auth){switch(document.getElementById("authType").value=t.auth.type||"none",Ge(t.auth.type),t.auth.type){case"basic":document.getElementById("authUsername").value=t.auth.username||"",document.getElementById("authPassword").value=t.auth.password||"";break;case"bearer":document.getElementById("authToken").value=t.auth.token||"";break;case"apikey":document.getElementById("authKey").value=t.auth.key||"",document.getElementById("authValue").value=t.auth.value||"",document.getElementById("authAddTo").value=t.auth.addTo||"header";break;case"oauth2":document.getElementById("authAccessToken").value=t.auth.accessToken||"",document.getElementById("authTokenType").value=t.auth.tokenType||"Bearer";break}Z()}const s=document.getElementById("preRequestScript");s.value=t.preRequestScript||"",s.addEventListener("blur",async()=>{const i=s.value;a.currentRequest.preRequestScript=i;const c=a.collections.find(l=>l.id===a.currentCollection);if(c){const l=c.requests.find(h=>h.id===t.id);l&&(l.preRequestScript=i)}await I(),S("Pre-request script を保存しました")});const d=t.bodyType||"none";switch(document.querySelectorAll('input[name="bodyType"]').forEach(i=>{i.checked=i.value===d}),d){case"raw":document.getElementById("rawBody").style.display="block",document.getElementById("jsonBody").parentElement.style.display="none",document.getElementById("formDataContainer").style.display="none";break;case"json":document.getElementById("rawBody").style.display="none",document.getElementById("jsonBody").parentElement.style.display="block",document.getElementById("formDataContainer").style.display="none";break;case"form-data":document.getElementById("rawBody").style.display="none",document.getElementById("jsonBody").parentElement.style.display="none",document.getElementById("formDataContainer").style.display="block";break;case"urlencoded":document.getElementById("rawBody").style.display="none",document.getElementById("jsonBody").parentElement.style.display="none",document.getElementById("formDataContainer").style.display="block";break;default:document.getElementById("rawBody").style.display="none",document.getElementById("jsonBody").parentElement.style.display="none",document.getElementById("formDataContainer").style.display="none";break}document.getElementById("rawBody").value=t.body||"",document.getElementById("jsonBody").value=t.body||"",he("request")}async function Te(t){var o;const e=(o=document.getElementById("testScript"))==null?void 0:o.value;if(!(e!=null&&e.trim()))return;const n=e.split(/\r?\n/).map(s=>s.trim()).filter(s=>s!==""&&!s.startsWith("//")),r=[];try{for(const s of n){const d=_e(s,t);r.push({name:s,passed:d.passed,error:d.error})}ae(r)}catch(s){console.error("Test script 実行エラー:",s),r.push({name:"Script Execution Error",passed:!1,error:s.message}),ae(r)}}async function Be(t){try{if(se(!0),!t.url||!t.url.trim()){x("URL is required");return}let n=$e(t);n=await Pe(n.preRequestScript,n);const r={timestamp:new Date().toISOString(),method:n.method,url:n.url,headers:n.headers,params:n.params,body:n.body,auth:n.auth,folder:n.folder||"",description:n.description||"",bodyType:n.bodyType||"none",preRequestScript:n.preRequestScript||""},o=Ie(n);if(!o)return;const{method:s,headers:d,bodyData:i}=o,c=n.url,l=Date.now(),h=await new Promise((f,b)=>{const g=new XMLHttpRequest;g.open(s,c,!0),g.timeout=3e4,Object.entries(d).forEach(([E,C])=>{g.setRequestHeader(E,C)}),g.onreadystatechange=()=>{if(g.readyState!==4)return;const E=Date.now()-l;if(g.status!==0){const k=g.getAllResponseHeaders().trim().split(/[\r\n]+/),O={};k.forEach(st=>{const pe=st.split(": "),it=pe.shift(),ct=pe.join(": ");O[it]=ct});const _=g.responseText||"",at={status:g.status,statusText:g.statusText,headers:O,text:async()=>_,json:async()=>{try{return JSON.parse(_)}catch{return{}}}};f({response:at,duration:E})}else b(new Error("Network error or CORS issue (status 0)."))},g.ontimeout=()=>{b(new Error("Request timeout"))},g.onerror=()=>{b(new Error("Network error"))},g.send(i)}),{response:p,duration:y}=h,m=await qe(p,y);if(de(m),await Te(m),await De(n,m),a.currentCollection){const f=a.collections.find(b=>b.id===a.currentCollection);if(f){const b=f.requests.find(g=>g.id===t.id);b&&(b.lastRequestExecution=r,b.lastResponseExecution={status:m.status,duration:m.duration,size:m.size,timestamp:new Date().toISOString(),headers:m.headers,body:m.body},await I())}}return a.currentRequest&&a.currentRequest.id===t.id&&(a.currentRequest.lastRequestExecution=r,a.currentRequest.lastResponseExecution={status:m.status,duration:m.duration,size:m.size,timestamp:new Date().toISOString(),headers:m.headers,body:m.body}),p||""}catch(n){x("Request failed: "+n.message),console.error("Request error:",n)}finally{se(!1)}return{status:"",statusText:"",headers:{},duration:"",size:0,body:null,bodyText:""}}function Ie(t){var o;const e=(t.method||"GET").toUpperCase(),n={};let r=null;switch(t.headers&&Object.assign(n,t.headers),Oe(n,t.auth),t.bodyType){case"json":{const d=(o=t.body)==null?void 0:o.trim();if(d)try{JSON.parse(d),r=d,!n["Content-Type"]&&!n["content-type"]&&(n["Content-Type"]="application/json")}catch{return x("不正な JSON です"),null}break}case"raw":{r=t.body||"";break}case"form-data":{const d=new FormData,i=K("formDataContainer");Object.entries(i).forEach(([c,l])=>{d.append(c,l)}),r=d,delete n["Content-Type"];break}case"urlencoded":{const d=new URLSearchParams,i=K("formDataContainer");Object.entries(i).forEach(([c,l])=>{d.append(c,l)}),r=d.toString(),n["Content-Type"]="application/x-www-form-urlencoded";break}}return{method:e,headers:n,bodyData:r}}function Oe(t,e){switch(e.type){case"basic":if(e.username&&e.password){const n=btoa(`${e.username}:${e.password}`);t.Authorization=`Basic ${n}`}break;case"bearer":e.token&&(t.Authorization=`Bearer ${e.token}`);break;case"apikey":e.key&&e.value&&e.addTo==="header"&&(t[e.key]=e.value);break;case"oauth2":e.accessToken&&(t.Authorization=`${e.tokenType||"Bearer"} ${e.accessToken}`);break}}async function qe(t,e){const n={status:t.status,statusText:t.statusText,headers:{},duration:e,size:0,body:null,bodyText:""};if(t.headers)if(typeof t.headers.forEach=="function")t.headers.forEach((o,s)=>{n.headers[s]=o});else if(t._headerObj&&typeof t._headerObj=="object")Object.entries(t._headerObj).forEach(([o,s])=>{n.headers[o]=s});else if(t.headers.get){const o=t.headers.get("all");o&&o.trim().split(/[\r\n]+/).forEach(d=>{const i=d.split(": "),c=i.shift(),l=i.join(": ");n.headers[c]=l})}else for(const[o,s]of Object.entries(t.headers))o==="get"&&typeof s=="function"||(n.headers[o]=s);const r=n.headers["content-type"]||"";try{if(n.bodyText=await t.text(),n.size=new Blob([n.bodyText]).size,r.includes("application/json"))try{n.body=JSON.parse(n.bodyText)}catch{n.body=n.bodyText}else n.body=n.bodyText}catch{n.bodyText="Error reading response body",n.body=null}return n}function de(t,e="pretty"){window.lastResponse=t;const n=document.getElementById("responseStats");n.innerHTML=`
        <span class="status-${t.status<400?"success":"error"}">
            ${t.status} ${t.statusText}
        </span>
        <span>${t.duration}ms</span>
        <span>${Ue(t.size)}</span>
    `,Ae(t,e),Re(t.headers),Le(t.headers)}function Ae(t,e){const n=document.getElementById("responseBody");let r="";const o=t.headers["content-type"]||"";switch(e){case"pretty":o.includes("application/json")&&t.body&&typeof t.body=="object"?r=JSON.stringify(t.body,null,2):r=t.bodyText;break;case"raw":r=t.bodyText;break;case"preview":if(o.includes("text/html")){n.innerHTML=`<iframe srcdoc="${B(t.bodyText)}" style="width:100%;height:300px;border:1px solid #ccc;"></iframe>`;return}else r=t.bodyText;break}n.textContent=r}function Re(t){const e=document.getElementById("response-headers");let n='<div class="headers-list">';Object.entries(t).forEach(([r,o])=>{n+=`
            <div class="header-item">
                <strong>${B(r)}:</strong> ${B(o)}
            </div>
        `}),n+="</div>",e.innerHTML=n}function Le(t){const e=document.getElementById("response-cookies"),n=t["set-cookie"];if(n){const r=Array.isArray(n)?n:[n];let o='<div class="cookies-list">';r.forEach(s=>{o+=`<div class="cookie-item">${B(s)}</div>`}),o+="</div>",e.innerHTML=o}else e.innerHTML='<p class="empty-message">No cookies in response</p>'}function _e(t,e){const[n,...r]=t.trim().split(/\s+/);switch(n){case"status":{const o=parseInt(r[0],10);return e.status!==o?{passed:!1,error:`Expected status ${o}, got ${e.status}`}:{passed:!0}}case"jsonHasProperty":{const o=r[0],s=e.body;return typeof s!="object"||s===null?{passed:!1,error:"レスポンスボディが JSON オブジェクトではありません"}:o in s?{passed:!0}:{passed:!1,error:`JSON にプロパティ "${o}" が見つかりません`}}case"jsonArrayLengthEquals":{const[o,s]=r,d=parseInt(s,10),i=e.body;if(typeof i!="object"||i===null)return{passed:!1,error:"レスポンスボディが JSON オブジェクトではありません"};const c=o.split(".").reduce((l,h)=>l&&l[h]!==void 0?l[h]:void 0,i);return Array.isArray(c)?c.length!==d?{passed:!1,error:`Expected ${o}.length === ${d}, got ${c.length}`}:{passed:!0}:{passed:!1,error:`パス "${o}" に対応する値が配列ではありません`}}case"bodyContains":{const o=r.join(" ");return(e.bodyText??"").includes(o)?{passed:!0}:{passed:!1,error:`レスポンスボディに "${o}" が含まれていません`}}case"setVarFromHeader":{const o=r[0],s=r.slice(1).join(" "),d=e.headers||{},i=s.toLowerCase();let c;for(const l in d)if(l.toLowerCase()===i){c=d[l];break}return c===void 0?{passed:!1,error:`レスポンスヘッダー "${s}" が見つかりません`}:(console.log("取得したAuthorizationヘッダ：varName=",o),console.log("取得したAuthorizationヘッダ：headerValue=",c),A(async()=>{const{setVariable:l}=await Promise.resolve().then(()=>Lt);return{setVariable:l}},void 0).then(({setVariable:l})=>{l("environment",o,c).catch(console.error)}),q("environment"),{passed:!0})}case"jsonValueEquals":{const o=r[0],s=r.slice(1).join(" "),d=isNaN(s)?s:Number(s);let i;if(typeof e.bodyText=="string")try{i=JSON.parse(e.bodyText)}catch{return{passed:!1,error:"レスポンスボディが有効な JSON ではありません"}}else i=e.body;const c=o.split(".").reduce((l,h)=>{if(console.log("obj=".obj),console.log("key=".key),l&&h in l)return l[h];if(h==="length"&&Array.isArray(l))return l.length},i);return c===void 0?{passed:!1,error:`パス "${o}" が見つかりません`}:c!==d?{passed:!1,error:`期待値: ${d} ですが、実際の値: ${c} です`}:{passed:!0}}case"headerExists":{const o=r[0].toLowerCase();return Object.keys(e.headers).some(d=>d.toLowerCase()===o)?{passed:!0}:{passed:!1,error:`ヘッダー "${r[0]}" が存在しません`}}case"headerValueEquals":{const o=r[0].toLowerCase(),s=r.slice(1).join(" ");let d;for(const[i,c]of Object.entries(e.headers))if(i.toLowerCase()===o){d=c;break}if(d===void 0)throw new Error(`ヘッダー "${r[0]}" が存在しません`);if(d!==s)throw new Error(`"${r[1]}" の値が期待値と異なります (期待: ${s}, 実際: ${d})`);return{passed:!0}}default:return{passed:!1,error:`Unknown test command: ${n}`}}}function Pe(t,e){if(!t)return e;const n=t.split(`
`);for(const r of n){const o=r.trim();if(!o||o.startsWith("//"))continue;const s=o.indexOf(" ");if(s===-1){console.warn(`Invalid command format: ${o}`);continue}const d=o.substring(0,s),i=o.substring(s+1).trim();console.log("Executing command:",d,i);try{switch(d){case"setUrlWithVar":if(!i){console.warn("setUrlWithVar requires a variable name");continue}const c=U(i);if(c===void 0)throw new Error(`変数「${i}」が変数ではありません`);e.url=c;break;case"addHeader":if(!i){console.warn("addHeader requires a header name and value");continue}const l=i.indexOf(" ");if(l===-1){console.warn("addHeader requires both header name and value");continue}const h=i.substring(0,l),p=i.substring(l+1).trim();e.headers[h]=p;break;case"addHeaderWithVar":if(!i){console.warn("addHeaderWithVar requires a header name and variable name");continue}const y=i.indexOf(" ");if(y===-1){console.warn("addHeaderWithVar requires both header name and variable name");continue}const m=i.substring(0,y),f=i.substring(y+1).trim(),b=U(f);if(b===void 0)throw new Error(`変数「${f}」が変数ではありません`);e.headers[m]=b;break;case"setBodyWithVar":if(!i){console.warn("setBodyWithVar requires a variable name");continue}console.log("argsString",i);const g=U(i);if(g===void 0)throw new Error(`変数「${i}」が変数ではありません`);e.body=g;break;default:console.warn(`Unknown command: ${d}`)}}catch(c){throw console.error("Pre-request script 実行エラー:",c),c}}return e}function ae(t){const e=document.getElementById("response-tests");if(t.length===0){e.innerHTML='<p class="empty-message">No tests executed</p>';return}const n=t.filter(s=>s.passed).length,r=t.filter(s=>!s.passed).length;let o=`
        <div class="test-summary">
            <span class="test-passed">✓ ${n} passed</span>
            <span class="test-failed">✗ ${r} failed</span>
        </div>
        <div class="test-results">
    `;t.forEach(s=>{o+=`
            <div class="test-result ${s.passed?"passed":"failed"}">
                <span class="test-icon">${s.passed?"✓":"✗"}</span>
                <span class="test-name">${B(s.name)}</span>
                ${s.error?`<span class="test-error">${B(s.error)}</span>`:""}
            </div>
        `}),o+="</div>",e.innerHTML=o}function $e(t){const e=JSON.parse(JSON.stringify(t));e.url=z(e.url),e.headers=M(e.headers),e.params=M(e.params),e.body&&(typeof e.body=="string"?e.body=z(e.body):e.body=M(e.body));const n=new URL(e.url);return Object.entries(e.params).forEach(([r,o])=>{n.searchParams.set(r,o)}),e.auth.type==="apikey"&&e.auth.addTo==="query"&&n.searchParams.set(e.auth.key,e.auth.value),e.url=n.toString(),e}async function De(t,e){const{saveToHistory:n}=await A(async()=>{const{saveToHistory:r}=await Promise.resolve().then(()=>He);return{saveToHistory:r}},void 0);await n(t,e)}async function je(){const t=a.currentRequest;if(!t||!t.id){x("No request to save.");return}try{t.method=document.getElementById("methodSelect").value,t.name=document.getElementById("nameInput").value.trim(),t.url=document.getElementById("urlInput").value.trim();const e=document.querySelectorAll("#headersContainer .key-value-row"),n={};e.forEach(i=>{const c=i.querySelector(".key-input").value.trim(),l=i.querySelector(".value-input").value.trim();c&&(n[c]=l)}),t.headers=n;const r=document.querySelectorAll("#paramsContainer .key-value-row"),o={};r.forEach(i=>{const c=i.querySelector(".key-input").value.trim(),l=i.querySelector(".value-input").value.trim();c&&(o[c]=l)}),t.params=o;const s=document.querySelector('input[name="bodyType"]').value;if(s==="raw")t.body=document.getElementById("rawBody").value;else if(s==="json")t.body=document.getElementById("jsonBody").value;else if(s==="form-data"){const i=document.querySelectorAll("#formDataContainer .key-value-row"),c={};i.forEach(l=>{const h=l.querySelector(".key-input").value.trim(),p=l.querySelector(".value-input").value.trim();h&&(c[h]=p)}),t.body=c}else if(s==="urlencoded"){const i=document.querySelectorAll("#urlEncodedContainer .key-value-row"),c={};i.forEach(l=>{const h=l.querySelector(".key-input").value.trim(),p=l.querySelector(".value-input").value.trim();h&&(c[h]=p)}),t.body=c}else t.body=null;const d=document.getElementById("authType").value;if(t.auth={type:d},d==="basic"?(t.auth.username=document.getElementById("authUsername").value,t.auth.password=document.getElementById("authPassword").value):d==="bearer"?t.auth.token=document.getElementById("authToken").value:d==="apikey"&&(t.auth.key=document.getElementById("authKey").value,t.auth.value=document.getElementById("authValue").value,t.auth.addTo=document.getElementById("authAddTo").value),a.currentCollection){const i=a.collections.find(c=>c.id===a.currentCollection);if(i&&i.requests){const c=i.requests.findIndex(l=>l.id===t.id);if(c!==-1){i.requests[c]=JSON.parse(JSON.stringify(t)),await I(),S("Request saved to collection.");return}}}if(a.currentScenario){const i=a.scenarios.find(c=>c.id===a.currentScenario);if(i&&i.requests){const c=i.requests.findIndex(l=>l.id===t.id);if(c!==-1){i.requests[c]=JSON.parse(JSON.stringify(t)),await j(),S("Request saved to scenario.");return}}}await saveCurrentRequestToStorage(t),S("Request saved.")}catch(e){console.error("Error saving request:",e),x("Failed to save request: "+e.message)}}const ee=Object.freeze(Object.defineProperty({__proto__:null,addAuthenticationHeaders:Oe,buildFetchOptions:Ie,displayResponse:de,displayResponseBody:Ae,displayResponseCookies:Le,displayResponseHeaders:Re,displayTestResults:ae,executePreRequestScript:Pe,executeTestScript:Te,loadRequestIntoEditor:ke,processResponse:qe,processVariables:$e,runTestCommand:_e,saveCurrentRequest:je,saveToHistory:De,sendRequest:Be},Symbol.toStringTag,{value:"Module"}));function te(){const t=document.getElementById("historyContainer");if(a.history.length===0){t.innerHTML='<p class="empty-message">No request history</p>';return}t.innerHTML="",a.history.forEach(e=>{var d,i,c;const n=document.createElement("div");n.className="history-item",n.dataset.id=e.id;const r=((d=e.request)==null?void 0:d.method)||e.method||"GET",o=((i=e.request)==null?void 0:i.url)||e.url||"",s=((c=e.response)==null?void 0:c.status)||e.status||0;n.innerHTML=`
            <span class="history-method method-${r}">${r}</span>
            <span class="history-url">${B(o)}</span>
            <span class="history-status status-${s<400?"success":"error"}">${s||"N/A"}</span>
            <span class="history-time">${new Date(e.timestamp).toLocaleTimeString()}</span>
        `,n.addEventListener("click",()=>Ne(e.id)),t.appendChild(n)})}async function _t(t,e){const n={id:Date.now(),timestamp:new Date().toISOString(),request:{method:t.method,url:t.url,headers:t.headers,params:t.params,body:t.body,auth:t.auth},response:{status:e.status,duration:e.duration,size:e.size}};a.history.unshift(n),a.history.length>100&&a.history.splice(100),await Ye(),te()}async function Ne(t){const e=a.history.find(r=>r.id==t);if(!e||!e.request)return;const{loadRequestIntoEditor:n}=await A(async()=>{const{loadRequestIntoEditor:r}=await Promise.resolve().then(()=>ee);return{loadRequestIntoEditor:r}},void 0);n(e.request),S("Request loaded from history")}async function Me(){confirm("Are you sure you want to clear all request history?")&&(a.history.length=0,await Ye(),te(),S("History cleared"))}function Pt(){const t=document.getElementById("historySearch").value.toLowerCase();document.querySelectorAll(".history-item").forEach(n=>{const r=n.querySelector(".history-url").textContent.toLowerCase(),o=n.querySelector(".history-method").textContent.toLowerCase();r.includes(t)||o.includes(t)?n.style.display="flex":n.style.display="none"})}const He=Object.freeze(Object.defineProperty({__proto__:null,clearHistory:Me,filterHistory:Pt,loadHistoryItem:Ne,renderHistory:te,saveToHistory:_t},Symbol.toStringTag,{value:"Module"}));let Y=!1;function $t(){if(Y)return;const t=jt();chrome.runtime.sendMessage({action:"startInterceptor",filters:t},e=>{e!=null&&e.success&&(Y=!0,document.getElementById("startInterceptorBtn").disabled=!0,document.getElementById("stopInterceptorBtn").disabled=!1,S("Interceptor started"))}),chrome.runtime.onMessage.addListener(Ve)}function Dt(){Y&&(chrome.runtime.sendMessage({action:"stopInterceptor"},t=>{t!=null&&t.success&&(Y=!1,document.getElementById("startInterceptorBtn").disabled=!1,document.getElementById("stopInterceptorBtn").disabled=!0,S("Interceptor stopped"))}),chrome.runtime.onMessage.removeListener(Ve))}function jt(){const t=[];document.querySelectorAll(".method-filters input:checked").forEach(n=>{t.push(n.value)});const e=document.getElementById("domainFilter").value.trim();return{methods:t,domain:e}}function Ve(t){t.action==="requestIntercepted"&&Nt(t.request)}function Nt(t){const e=document.getElementById("interceptorContainer"),n=document.createElement("div");for(n.className="intercepted-request",n.innerHTML=`
        <span class="history-method method-${t.method}">${t.method}</span>
        <span class="history-url">${B(t.url)}</span>
        <span class="history-status status-${t.status<400?"success":"error"}">${t.status||"Pending"}</span>
        <span class="history-time">${new Date().toLocaleTimeString()}</span>
    `,n.addEventListener("click",()=>{Mt(t)}),e.insertBefore(n,e.firstChild);e.children.length>50;)e.removeChild(e.lastChild)}async function Mt(t){const e={method:t.method,url:t.url,headers:t.headers||{},params:{},body:t.body||null,auth:{type:"none"}},{loadRequestIntoEditor:n}=await A(async()=>{const{loadRequestIntoEditor:r}=await Promise.resolve().then(()=>ee);return{loadRequestIntoEditor:r}},void 0);n(e),S("Request loaded from interceptor")}function B(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}function Ue(t){if(t===0)return"0 B";const e=1024,n=["B","KB","MB","GB"],r=Math.floor(Math.log(t)/Math.log(e));return parseFloat((t/Math.pow(e,r)).toFixed(2))+" "+n[r]}function ue(t,e="info"){const n=document.getElementById("notificationArea"),r=document.createElement("div");r.className=`notification notification-${e}`,r.textContent=t,n.appendChild(r),setTimeout(()=>{r.classList.add("fade-out"),setTimeout(()=>r.remove(),300)},3e3)}function S(t){ue(t,"success")}function x(t){ue(t,"error")}function Ht(t,e){return e.split(".").reduce((n,r)=>n==null?void 0:n[r],t)}function T(t,e){const n=document.createElement("div");n.className="key-value-row",n.innerHTML=`
        <input type="text" placeholder="Key" class="key-input">
        <input type="text" placeholder="Value" class="value-input">
        <input type="text" placeholder="Description" class="description-input">
        <button type="button" class="delete-btn">×</button>
    `;const r=n.querySelector(".key-input"),o=n.querySelector(".value-input"),s=n.querySelector(".delete-btn");r.addEventListener("input",async()=>await Q(e)),o.addEventListener("input",async()=>await Q(e)),s.addEventListener("click",()=>{n.remove(),Q(e)}),t.appendChild(n)}function K(t){const n=document.getElementById(t).querySelectorAll(".key-value-row"),r={};return n.forEach(o=>{const s=o.querySelector(".key-input").value.trim(),d=o.querySelector(".value-input").value.trim();s&&(r[s]=d)}),r}async function Q(t){if(!a.currentRequest){console.warn("updateRequestData: state.currentRequest が未定義です");return}t==="param"?a.currentRequest.params=K("paramsContainer"):t==="header"&&(a.currentRequest.headers=K("headersContainer"))}function Vt(){document.querySelectorAll('input[name="bodyType"]').forEach(t=>{t.addEventListener("change",async()=>{const e=document.querySelector('input[name="bodyType"]:checked').value;a.currentRequest.bodyType=e;const n=a.collections.find(r=>r.id===a.currentCollection);if(n){const r=n.requests.find(o=>o.id===a.currentRequest.id);r&&(r.bodyType=e)}switch(await I(),S(`Body Type を "${e}" に切り替えました`),e){case"raw":document.getElementById("rawBody").style.display="block",document.getElementById("jsonBody").parentElement.style.display="none",document.getElementById("formDataContainer").style.display="none";break;case"json":document.getElementById("rawBody").style.display="none",document.getElementById("jsonBody").parentElement.style.display="block",document.getElementById("formDataContainer").style.display="none";break;case"form-data":document.getElementById("rawBody").style.display="none",document.getElementById("jsonBody").parentElement.style.display="none",document.getElementById("formDataContainer").style.display="block";break;case"urlencoded":document.getElementById("rawBody").style.display="none",document.getElementById("jsonBody").parentElement.style.display="none",document.getElementById("formDataContainer").style.display="block";break;default:document.getElementById("rawBody").style.display="none",document.getElementById("jsonBody").parentElement.style.display="none",document.getElementById("formDataContainer").style.display="none";break}})})}function ze(){Vt();const t=document.getElementById("saveBtn");t&&t.addEventListener("click",e=>{e.preventDefault(),je()}),document.getElementById("sendBtn").addEventListener("click",async()=>{var o;const{sendRequest:e}=await A(async()=>{const{sendRequest:s}=await Promise.resolve().then(()=>ee);return{sendRequest:s}},void 0);let n=a.currentRequest;const r=((o=document.querySelector('input[name="bodyType"]:checked'))==null?void 0:o.value)||"none";switch(n.body=null,r){case"raw":n.body=document.getElementById("rawBody").value;break;case"json":n.body=document.getElementById("jsonBody").value;break}e(n)}),document.getElementById("methodSelect").addEventListener("change",e=>{a.currentRequest.method=e.target.value}),document.getElementById("urlInput").addEventListener("input",e=>{a.currentRequest.url=e.target.value,a.currentRequest&&(a.currentRequest.url=e.target.value)}),document.getElementById("importBtn").addEventListener("click",()=>{A(()=>Promise.resolve().then(()=>Ee),void 0).then(e=>e.openImportModal())}),document.getElementById("exportBtn").addEventListener("click",()=>{A(()=>Promise.resolve().then(()=>Ee),void 0).then(e=>e.exportData())}),document.getElementById("settingsBtn").addEventListener("click",()=>{x("Settings panel not yet implemented")}),document.getElementById("createCollectionBtn").addEventListener("click",async()=>{Zt()}),document.getElementById("historySearch").addEventListener("input",()=>{A(()=>Promise.resolve().then(()=>He),void 0).then(e=>e.filterHistory())}),document.getElementById("clearHistoryBtn").addEventListener("click",async()=>{Me()}),document.getElementById("startInterceptorBtn").addEventListener("click",async()=>{$t()}),document.getElementById("stopInterceptorBtn").addEventListener("click",async()=>{Dt()}),document.querySelectorAll('input[name="bodyType"]').forEach(e=>{e.addEventListener("change",n=>{H(n)})}),document.getElementById("rawBody").addEventListener("input",e=>{a.currentRequest.body=e.target.value})}function Ke(){document.querySelectorAll(".tab-btn").forEach(t=>{t.addEventListener("click",function(){const e=this.dataset.tab;he(e)})}),document.querySelectorAll(".sub-tab-btn").forEach(t=>{t.addEventListener("click",function(){const e=this.dataset.subtab;Fe(e)})}),document.querySelectorAll(".response-tab-btn").forEach(t=>{t.addEventListener("click",function(){const e=this.dataset.restab;We(e)})}),document.querySelectorAll(".format-btn").forEach(t=>{t.addEventListener("click",function(){document.querySelectorAll(".format-btn").forEach(n=>n.classList.remove("active")),this.classList.add("active");const e=this.dataset.format;window.lastResponse&&de(window.lastResponse,e)})})}function he(t){console.log(t),document.querySelectorAll(".tab-btn").forEach(e=>e.classList.remove("active")),document.querySelectorAll(".tab-content").forEach(e=>e.classList.remove("active")),document.querySelector(`.tab-btn[data-tab="${t}"]`).classList.add("active"),document.getElementById(`${t}-tab`).classList.add("active")}function Fe(t){document.querySelectorAll(".sub-tab-btn").forEach(e=>e.classList.remove("active")),document.querySelectorAll(".sub-tab-content").forEach(e=>e.classList.remove("active")),document.querySelector(`[data-subtab="${t}"]`).classList.add("active"),document.getElementById(`${t}-subtab`).classList.add("active")}function We(t){document.querySelectorAll(".response-tab-btn").forEach(e=>e.classList.remove("active")),document.querySelectorAll(".response-tab-content").forEach(e=>e.classList.remove("active")),document.querySelector(`[data-restab="${t}"]`).classList.add("active"),document.getElementById(`response-${t}`).classList.add("active")}function Ge(t){const e=document.getElementById("authDetails");switch(e.innerHTML="",t){case"basic":e.innerHTML=`
                <div class="auth-field">
                    <label>Username</label>
                    <input type="text" id="authUsername" placeholder="Enter username">
                </div>
                <div class="auth-field">
                    <label>Password</label>
                    <input type="password" id="authPassword" placeholder="Enter password">
                </div>
            `;break;case"bearer":e.innerHTML=`
                <div class="auth-field">
                    <label>Token</label>
                    <input type="text" id="authToken" placeholder="Enter bearer token">
                </div>
            `;break;case"apikey":e.innerHTML=`
                <div class="auth-field">
                    <label>Key</label>
                    <input type="text" id="authKey" placeholder="Enter API key name">
                </div>
                <div class="auth-field">
                    <label>Value</label>
                    <input type="text" id="authValue" placeholder="Enter API key value">
                </div>
                <div class="auth-field">
                    <label>Add to</label>
                    <select id="authAddTo">
                        <option value="header">Header</option>
                        <option value="query">Query Params</option>
                    </select>
                </div>
            `;break;case"oauth2":e.innerHTML=`
                <div class="auth-field">
                    <label>Access Token</label>
                    <input type="text" id="authAccessToken" placeholder="Enter access token">
                </div>
                <div class="auth-field">
                    <label>Token Type</label>
                    <select id="authTokenType">
                        <option value="Bearer">Bearer</option>
                        <option value="MAC">MAC</option>
                    </select>
                </div>
                <button class="btn btn-sm" onclick="getOAuth2Token()">Get New Access Token</button>
            `;break}e.querySelectorAll("input, select").forEach(n=>{n.addEventListener("input",Z),n.addEventListener("change",Z)})}function Z(){var e,n,r,o,s,d,i,c,l;if(!a.currentRequest){console.error("updateAuthData: state.currentRequest が undefined です");return}const t=((e=a.currentRequest.auth)==null?void 0:e.type)||"none";switch(a.currentRequest.auth={type:t},t){case"basic":a.currentRequest.auth.username=((n=document.getElementById("authUsername"))==null?void 0:n.value)||"",a.currentRequest.auth.password=((r=document.getElementById("authPassword"))==null?void 0:r.value)||"";break;case"bearer":a.currentRequest.auth.token=((o=document.getElementById("authToken"))==null?void 0:o.value)||"";break;case"apikey":a.currentRequest.auth.key=((s=document.getElementById("authKey"))==null?void 0:s.value)||"",a.currentRequest.auth.value=((d=document.getElementById("authValue"))==null?void 0:d.value)||"",a.currentRequest.auth.addTo=((i=document.getElementById("authAddTo"))==null?void 0:i.value)||"header";break;case"oauth2":a.currentRequest.auth.accessToken=((c=document.getElementById("authAccessToken"))==null?void 0:c.value)||"",a.currentRequest.auth.tokenType=((l=document.getElementById("authTokenType"))==null?void 0:l.value)||"Bearer";break}}function se(t){const e=document.getElementById("sendBtn");t?(e.disabled=!0,e.textContent="Sending..."):(e.disabled=!1,e.textContent="Send")}function H(t){const e=t.target.value,n=document.getElementById("rawBody"),r=document.getElementById("jsonEditor"),o=document.getElementById("formDataContainer");switch(n.style.display="none",r.style.display="none",o.style.display="none",e){case"raw":n.style.display="block";break;case"json":r.style.display="block";break;case"form-data":case"urlencoded":o.style.display="block",o.children.length||T(o,"body");break}}const Ut=Object.freeze(Object.defineProperty({__proto__:null,addKeyValueRow:T,collectKeyValues:K,escapeHtml:B,formatBytes:Ue,getValueByPath:Ht,handleBodyTypeChange:H,renderAuthDetails:Ge,setupEventListeners:ze,setupTabSwitching:Ke,showError:x,showLoading:se,showNotification:ue,showSuccess:S,switchMainTab:he,switchResponseTab:We,switchSubTab:Fe,updateAuthData:Z,updateRequestData:Q},Symbol.toStringTag,{value:"Module"}));async function zt(){try{const t=await chrome.storage.local.get(["scenarios"]);!t.scenarios||t.scenarios.length===0?(a.scenarios.splice(0,a.scenarios.length,...pt),await chrome.storage.local.set({scenarios:a.scenarios})):a.scenarios.splice(0,a.scenarios.length,...t.scenarios),F()}catch(t){console.error("Error initializing scenarios:",t)}}function F(){const t=document.getElementById("scenarioList");t.innerHTML="",a.scenarios.forEach(e=>{const n=document.createElement("li");n.textContent=e.name,n.dataset.id=e.id,a.currentScenario===e.id&&n.classList.add("active"),n.addEventListener("click",()=>Xe(e.id)),t.appendChild(n)})}function Xe(t){a.currentScenario=t,F();const e=a.scenarios.find(n=>n.id===t);document.getElementById("scenarioTitle").textContent=e.name,W(t),document.getElementById("runScenarioBtn").disabled=!1}async function Kt(t,e){const n=a.scenarios.find(d=>d.id===t);if(!n){x("Scenario not found.");return}const r=prompt("Insert request ID from any collection:");if(!r)return;let o=null;for(const d of a.collections){if(!d.requests)continue;const i=d.requests.find(c=>String(c.id)===r);if(i){o=i;break}}if(!o){x("Request ID not found in any collection.");return}const s=JSON.parse(JSON.stringify(o));s.id=`req_${Date.now()}_${Math.random().toString(36).substring(2)}`,n.requests.splice(e,0,s),await j(),S(`Inserted "${s.name}" at position ${e+1}`),W(t)}function W(t){const e=document.getElementById("scenarioRequestsList");e.innerHTML="";const n=a.scenarios.find(r=>r.id===t);if(!n||!n.requests.length){const r=document.createElement("li");r.textContent="No requests in this scenario.",e.appendChild(r);return}n.requests.forEach((r,o)=>{const s=document.createElement("li");s.className="scenario-request-item";const d=document.createElement("span");d.className="req-name",d.textContent=r.name||"Untitled Request",s.appendChild(d);const i=document.createElement("button");i.textContent="Load",i.title="Load this request into editor",i.addEventListener("click",()=>{const y=a.scenarios.find(m=>m.id===a.currentScenario);if(y&&y.requests){const m=y.requests.findIndex(f=>f.id===r.id);m!==-1&&ke(y.requests[m])}}),s.appendChild(i);const c=document.createElement("button");c.textContent="↑",c.title="Move up",c.disabled=o===0,c.addEventListener("click",()=>{ge(t,o,o-1)}),s.appendChild(c);const l=document.createElement("button");l.textContent="↓",l.title="Move down",l.disabled=o===n.requests.length-1,l.addEventListener("click",()=>{ge(t,o,o+1)}),s.appendChild(l);const h=document.createElement("button");h.textContent="+",h.title="Insert a request here",h.addEventListener("click",()=>{Kt(t,o)}),s.appendChild(h);const p=document.createElement("button");p.textContent="×",p.title="Delete this request",p.addEventListener("click",()=>{Ft(t,o)}),s.appendChild(p),e.appendChild(s)})}async function ge(t,e,n){const r=a.scenarios.find(s=>s.id===t);if(!r)return;const[o]=r.requests.splice(e,1);r.requests.splice(n,0,o),await j(),W(t)}async function Ft(t,e){const n=a.scenarios.find(r=>r.id===t);n&&(n.requests.splice(e,1),await j(),W(t))}async function Wt(){const t=prompt("Enter scenario name:");if(!t)return;const e=`scenario_${Date.now()}_${Math.random().toString(36).substring(2)}`,n={id:e,name:t,requests:[]};a.scenarios.push(n),await j(),Xe(e),F()}async function Gt(t){if(!a.currentScenario){x("Please select a scenario first.");return}const e=a.scenarios.find(r=>r.id===a.currentScenario);if(!e)return;const n=JSON.parse(JSON.stringify(t));n.id=`req_${Date.now()}_${Math.random().toString(36).substring(2)}`,e.requests.push(n),await j(),W(a.currentScenario)}async function Xt(){if(!a.currentScenario){x("No scenario selected.");return}const t=a.scenarios.find(n=>n.id===a.currentScenario);if(!t||!t.requests.length){x("Scenario has no requests.");return}const e=document.getElementById("scenarioResultContainer");e.innerHTML="";for(let n=0;n<t.requests.length;n++){const r=t.requests[n],o=document.createElement("div");o.className="result-item",o.textContent=`Executing ${n+1}/${t.requests.length}: ${r.name}`,e.appendChild(o);try{const s=await Be(r),d=await s.text();o.textContent=`[${n+1}] ${r.name} → ${s.status} ${s.statusText}`;const i=document.createElement("pre");i.textContent=d,o.appendChild(i)}catch(s){o.textContent=`[${n+1}] ${r.name} → ERROR: ${s.message}`}}S("Scenario execution completed.")}async function Qt(){try{const t=await chrome.storage.local.get(["collections"]);!t.collections||t.collections.length===0?(a.collections.splice(0,a.collections.length,...ut),await chrome.storage.local.set({collections:a.collections})):a.collections.splice(0,a.collections.length,...t.collections),L(),R()}catch(t){console.error("Error initializing collections:",t)}}async function Yt(t){const e=prompt("Enter request name:");if(!e)return;const n=a.collections.find(o=>o.id==t);if(!n)return;n.requests||(n.requests=[]);const r={id:`req_${Date.now()}_${Math.random().toString(36).substring(2)}`,name:e,method:"GET",url:"",headers:{},params:{},body:null,bodyType:"none",auth:{},type:"none",preRequestScript:""};n.requests.push(r),await I(),Qe(r)}async function Qe(t){const{loadRequestIntoEditor:e}=await A(async()=>{const{loadRequestIntoEditor:n}=await Promise.resolve().then(()=>ee);return{loadRequestIntoEditor:n}},void 0);e(t),S("Request loaded from collection")}function Zt(){const t=prompt("Enter collection name:");if(!t)return;const e={id:Date.now(),name:t,description:"",requests:[]};a.collections.push(e),chrome.storage.local.set({collections:a.collections}),L(),R(),S("Collection created: "+t)}async function Jt(t){if(!confirm("本当にこのコレクションを削除しますか？"))return;const e=a.collections.findIndex(n=>n.id==t);e!==-1&&(a.collections.splice(e,1),await I(),a.currentCollection==t&&(a.currentCollection=null,await Ze()),L(),S("コレクションを削除しました"))}async function en(t,e){if(!confirm("本当にこのリクエストを削除しますか？"))return;const n=a.collections.find(r=>r.id==t);!n||!n.requests||e<0||e>=n.requests.length||(n.requests.splice(e,1),await I(),L(),S("リクエストを削除しました"))}function L(){const t=document.getElementById("collectionsTree");t.innerHTML="",a.collections.forEach(e=>{const n=document.createElement("div");n.className="collection-item",n.dataset.id=e.id;const r=document.createElement("span");r.className="toggle-icon",r.textContent="▶",n.appendChild(r);const o=document.createElement("span");o.className="collection-icon",o.textContent="📁",n.appendChild(o);const s=document.createElement("span");s.className="collection-name",s.textContent=e.name,n.appendChild(s);const d=document.createElement("span");d.className="request-collection-request-create-btn",d.textContent="🌱",d.addEventListener("click",l=>{l.stopPropagation(),Yt(a.currentCollection)}),n.appendChild(d);const i=document.createElement("span");i.className="collection-delete-btn",i.textContent="🗑️",i.addEventListener("click",l=>{l.stopPropagation(),Jt(e.id)}),n.appendChild(i),t.appendChild(n);const c=document.createElement("ul");if(c.className="request-list",c.style.display="none",e.requests&&e.requests.length>0)e.requests.forEach((l,h)=>{const p=document.createElement("li");p.className="request-item",p.dataset.id=l.id;const y=document.createElement("span");y.className=`method-badge method-${l.method}`,y.textContent=l.method,p.appendChild(y);const m=document.createElement("span");m.className="request-name",m.textContent=l.name,p.appendChild(m);const f=document.createElement("span");f.className="request-delete-btn",f.textContent="🗑️",f.addEventListener("click",g=>{g.stopPropagation(),en(e.id,h)}),p.appendChild(f);const b=document.createElement("span");b.className="request-scenario-create-btn",b.textContent="🌱",b.addEventListener("click",g=>{g.stopPropagation();const E=a.collections.find(C=>C.id===a.currentCollection);if(E&&E.requests){const C=E.requests.findIndex(k=>k.id===l.id);C!==-1&&Gt(E.requests[C])}}),p.appendChild(b),p.addEventListener("click",g=>{g.stopPropagation();const E=a.collections.find(C=>C.id===a.currentCollection);if(E&&E.requests){const C=E.requests.findIndex(k=>k.id===l.id);C!==-1&&Qe(E.requests[C])}}),c.appendChild(p)});else{const l=document.createElement("li");l.className="request-item empty-message",l.textContent="No requests",c.appendChild(l)}t.appendChild(c),n.addEventListener("click",()=>{if(c.style.display==="none"){c.style.display="block",r.textContent="▼",document.querySelectorAll(".collection-item").forEach(h=>{h.classList.toggle("active",h.dataset.id==e.id)}),a.currentCollection=e.id,Ze(e.id);const l=document.getElementById("collectionVarSelect");l&&(l.value=e.id,q("collection"))}else c.style.display="none",r.textContent="▶"})})}const a={currentRequest:{method:"GET",url:"",headers:{},params:{},body:null,auth:{type:"none"},folder:"",description:"",bodyType:"none",preRequestScript:"",lastRequestExecution:null,lastResponseExecution:null},collections:[],history:[],variables:{global:{},environment:{},collection:{}},environments:[],currentEnvironment:null,currentCollection:null,testScripts:[],settings:{},isInterceptorActive:!1,scenarios:[],currentScenario:null};async function I(){await chrome.storage.local.set({collections:a.collections});const t=await chrome.storage.local.get(["collections"]);a.collections.splice(0,a.collections.length,...t.collections),L(),R()}async function Ye(){await chrome.storage.local.set({history:a.history})}async function D(){await chrome.storage.local.set({variables:{global:a.variables.global,collection:a.variables.collection,environment:a.variables.environment}})}async function ne(){await chrome.storage.local.set({environments:a.environments})}async function tn(){await chrome.storage.local.set({currentEnvironment:a.currentEnvironment})}async function me(t){await chrome.storage.local.set({[`env_${t}`]:a.variables.environment})}async function Ze(){await chrome.storage.local.set({currentCollection:a.currentCollection})}async function j(){await chrome.storage.local.set({scenarios:a.scenarios}),F()}function Je(){const t=document.getElementById("testScript");t&&!t.value.trim()&&(t.value=mt)}function nn(){document.getElementById("importExportModal").classList.add("active"),document.getElementById("modalTitle").textContent="Import Data"}function ie(t){const e=t.target.files[0];if(!e)return;const n=new FileReader;n.onload=function(r){document.getElementById("importText").value=r.target.result},n.readAsText(e)}async function et(){const t=document.getElementById("importType").value,e=document.getElementById("importText").value.trim();if(!e){x("Please select a file or paste content to import");return}try{let n;try{n=JSON.parse(e)}catch{if(t==="curl")n=rt(e);else throw new Error("Invalid JSON format")}switch(t){case"postman":await on(n);break;case"apitester":await an(n);break;case"openapi":await sn(n);break;case"har":await cn(n);break;case"curl":ot(n);break;case"talentedapitester":nt(n);break}document.getElementById("importExportModal").classList.remove("active"),S("Import completed successfully")}catch(n){x("Import failed: "+n.message)}}function rn(t){var n,r,o;const e={type:t.type||"none"};switch(t.type){case"basic":const s=(n=t.basic)==null?void 0:n.reduce((c,l)=>(c[l.key]=l.value,c),{});e.username=(s==null?void 0:s.username)||"",e.password=(s==null?void 0:s.password)||"";break;case"bearer":const d=(r=t.bearer)==null?void 0:r.reduce((c,l)=>(c[l.key]=l.value,c),{});e.token=(d==null?void 0:d.token)||"";break;case"apikey":const i=(o=t.apikey)==null?void 0:o.reduce((c,l)=>(c[l.key]=l.value,c),{});e.key=(i==null?void 0:i.key)||"",e.value=(i==null?void 0:i.value)||"",e.addTo=(i==null?void 0:i.in)==="query"?"query":"header";break}return e}function tt(t,e=""){const n=[];return t.forEach(r=>{var o,s,d;if(r.request){const i={id:`req_${Date.now()}_${Math.random().toString(36).substring(2)}`,name:r.name||"Untitled Request",method:r.request.method||"GET",url:typeof r.request.url=="string"?r.request.url:((o=r.request.url)==null?void 0:o.raw)||"",headers:{},params:{},body:null,auth:{type:"none"},folder:e};if(r.request.header&&r.request.header.forEach(c=>{c.disabled||(i.headers[c.key]=c.value)}),(s=r.request.url)!=null&&s.query&&r.request.url.query.forEach(c=>{c.disabled||(i.params[c.key]=c.value)}),r.request.body)switch(r.request.body.mode){case"raw":i.body=r.request.body.raw;break;case"formdata":i.body=(d=r.request.body.formdata)==null?void 0:d.reduce((c,l)=>(l.disabled||(c[l.key]=l.value),c),{});break}r.request.auth&&(i.auth=rn(r.request.auth)),n.push(i)}else if(r.item){const i=e?`${e}/${r.name}`:r.name;n.push(...tt(r.item,i))}}),n}async function on(t){var n,r;const e={id:`collection_${Date.now()}_${Math.random().toString(36).substring(2)}`,name:((n=t.info)==null?void 0:n.name)||"Imported Collection",description:((r=t.info)==null?void 0:r.description)||"",requests:[]};t.item&&(e.requests=tt(t.item)),t.variable&&(t.variable.forEach(o=>{o.key&&!o.disabled&&(a.variables.global[o.key]={value:o.value||"",description:o.description||""})}),await D()),a.collections.push(e),await I(),R(),L()}async function nt(t){const e=t.entities.find(i=>i.entity.type==="Project");if(!e)throw new Error("Talend JSON に Project が見つかりません");const n=e.children||[],r=[],o=[],s=[];n.forEach(i=>{const{entity:c,children:l}=i;if(c.type==="Service"){const h=c,p=(l||[]).filter(y=>y.entity.type==="Request").map(y=>{const m=y.entity;return{id:m.id,name:m.name,method:m.method.name,url:m.uri.path,headers:(m.headers||[]).filter(f=>f.enabled).reduce((f,b)=>(f[b.name]=b.value,f),{}),params:{},body:m.body&&m.body.textBody||"",auth:{type:"none"}}});r.push({id:h.id,name:h.name,description:"",requests:p})}else if(c.type==="Scenario"){const h=c,p=(l||[]).filter(y=>y.entity.type==="Request").map(y=>{const m=y.entity;return{id:m.id,name:m.name,method:m.method.name,url:m.uri.path,headers:(m.headers||[]).filter(f=>f.enabled).reduce((f,b)=>(f[b.name]=b.value,f),{}),params:{},body:m.body&&m.body.textBody||"",auth:{type:"none"}}});o.push({id:h.id,name:h.name,description:"",requests:p})}}),(t.environments||[]).forEach(i=>{const c=i,l={};Object.values(c.variables||{}).forEach(h=>{h.enabled&&(l[h.name]={value:h.value,description:""})}),s.push({id:c.id,name:c.name,variables:l})}),r.length>0&&(a.collections.push(...r),await I()),Array.isArray(a.scenarios)||(a.scenarios=[]),o.length>0&&(a.scenarios.push(...o),await j()),Array.isArray(a.environments)||(a.environments=[]),a.variables.environment||(a.variables.environment={});for(const i of s)a.environments.push({id:i.id,name:i.name,variables:{...i.variables}}),a.variables.environment[i.id]=i.variables,await chrome.storage.local.set({[`env_${i.id}`]:i.variables});s.length>0&&(await ne(),await D()),R(),V(),J(),L(),F()}async function an(t){t.collections&&a.collections.push(...t.collections),t.variables&&(Object.assign(a.variables.global,t.variables.global||{}),Object.assign(a.variables.collection,t.variables.collection||{})),t.environments&&a.environments.push(...t.environments),await I(),await D(),await ne(),V(),R(),J(),L()}async function sn(t){var r,o;const e={id:`collection_${Date.now()}_${Math.random().toString(36).substring(2)}`,name:((r=t.info)==null?void 0:r.title)||"OpenAPI Import",description:((o=t.info)==null?void 0:o.description)||"",requests:[]},n=getOpenApiBaseUrl(t);t.paths&&Object.entries(t.paths).forEach(([s,d])=>{Object.entries(d).forEach(([i,c])=>{var l,h;if(["get","post","put","delete","patch","head","options"].includes(i)){const p={id:`req_${Date.now()}_${Math.random().toString(36).substring(2)}`,name:c.summary||`${i.toUpperCase()} ${s}`,method:i.toUpperCase(),url:n+s,headers:{},params:{},body:null,auth:{type:"none"},description:c.description||""};if(c.parameters&&c.parameters.forEach(y=>{y.in==="query"?p.params[y.name]=y.example||"":y.in==="header"&&(p.headers[y.name]=y.example||"")}),(l=c.requestBody)!=null&&l.content){const y=c.requestBody.content["application/json"];y!=null&&y.example?p.body=JSON.stringify(y.example,null,2):(h=y==null?void 0:y.schema)!=null&&h.example&&(p.body=JSON.stringify(y.schema.example,null,2))}e.requests.push(p)}})}),collections.push(e),await I(),R(),L()}async function cn(t){const e={id:`collection_${Date.now()}_${Math.random().toString(36).substring(2)}`,name:"HAR Import - "+new Date().toLocaleString(),description:"Imported from HAR file",requests:[]};t.log&&t.log.entries&&t.log.entries.forEach(n=>{const r=n.request;if(r){const o={id:`req_${Date.now()}_${Math.random().toString(36).substring(2)}`,name:`${r.method} ${new URL(r.url).pathname}`,method:r.method,url:r.url,headers:{},params:{},body:null,auth:{type:"none"}};r.headers&&r.headers.forEach(s=>{o.headers[s.name]=s.value}),r.queryString&&r.queryString.forEach(s=>{o.params[s.name]=s.value}),r.postData&&(o.body=r.postData.text),e.requests.push(o)}}),collections.push(e),await I(),R(),L()}function rt(t){const e={method:"GET",url:"",headers:{},body:null,auth:{type:"none"}},n=t.replace(/\\\n/g," ").replace(/\s+/g," ").trim(),r=n.match(/curl\s+(?:'([^']+)'|"([^"]+)"|(\S+))/);r&&(e.url=r[1]||r[2]||r[3]);const o=n.match(/-X\s+(\w+)/);o&&(e.method=o[1].toUpperCase());const s=/-H\s+(?:'([^']+)'|"([^"]+)")/g;let d;for(;d=s.exec(n);){const l=d[1]||d[2],[h,...p]=l.split(":");h&&p.length&&(e.headers[h.trim()]=p.join(":").trim())}const i=n.match(/(?:-d|--data)\s+(?:'([^']+)'|"([^"]+)"|(\S+))/);i&&(e.body=i[1]||i[2]||i[3]);const c=n.match(/-u\s+(?:'([^']+)'|"([^"]+)"|(\S+))/);if(c){const l=c[1]||c[2]||c[3],[h,p]=l.split(":");h&&(e.auth={type:"basic",username:h,password:p||""})}return e}function ot(t){document.getElementById("methodSelect").value=t.method,document.getElementById("urlInput").value=t.url,a.currentRequest.method=t.method,a.currentRequest.url=t.url,a.currentRequest.headers={...t.headers},a.currentRequest.params={},a.currentRequest.body=t.body||null,a.currentRequest.auth=t.auth||{type:"none"};const e=document.getElementById("headersContainer");if(e.innerHTML="",Object.entries(t.headers).forEach(([n,r])=>{T(e,"header");const o=e.querySelectorAll(".key-value-row"),s=o[o.length-1];s.querySelector(".key-input").value=n,s.querySelector(".value-input").value=r}),Object.keys(t.headers).length===0&&T(e,"header"),t.body&&(document.querySelector('input[name="bodyType"][value="raw"]').checked=!0,H({target:{value:"raw"}}),document.getElementById("rawBody").value=t.body),t.auth&&t.auth.type!=="none"){document.getElementById("authType").value=t.auth.type;const{renderAuthDetails:n,updateAuthData:r}=A(()=>Promise.resolve().then(()=>Ut),void 0);n(t.auth.type),r()}document.getElementById("importExportModal").classList.remove("active")}async function ln(){const t={version:"1.0",exportDate:new Date().toISOString(),collections:a.collections,variables:{global:a.variables.global,collection:a.variables.collection},environments:a.environments,currentEnvironment:a.currentEnvironment,history:a.history.slice(0,50)},e=JSON.stringify(t,null,2),n=new Blob([e],{type:"application/json"}),r=URL.createObjectURL(n),o=document.createElement("a");o.href=r,o.download=`api-tester-export-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(r),S("Data exported successfully")}const Ee=Object.freeze(Object.defineProperty({__proto__:null,exportData:ln,handleFileSelect:ie,handleImport:et,importCurlCommand:ot,importTalendData:nt,initializeTestScript:Je,openImportModal:nn,parseCurlCommand:rt},Symbol.toStringTag,{value:"Module"}));function dn(){document.getElementById("authType").addEventListener("change",function(){const e=this.value;a.currentRequest.auth.type=e,renderAuthDetails(e)})}function un(){const t=document.getElementById("importExportModal");t.querySelectorAll(".modal-close").forEach(o=>{o.addEventListener("click",function(){t.classList.remove("active")})}),t.addEventListener("click",function(o){o.target===t&&t.classList.remove("active")});const n=document.getElementById("importFile"),r=document.getElementById("fileDropZone");n.addEventListener("change",ie),r.addEventListener("click",function(){n.click()}),r.addEventListener("dragover",function(o){o.preventDefault(),this.classList.add("dragover")}),r.addEventListener("dragleave",function(){this.classList.remove("dragover")}),r.addEventListener("drop",function(o){o.preventDefault(),this.classList.remove("dragover");const s=o.dataTransfer.files;s.length>0&&ie({target:{files:s}})}),document.getElementById("importSubmitBtn").addEventListener("click",et)}function hn(){mn(),pn(),yn()}function mn(){const t=document.getElementById("paramsContainer");t.children.length===0&&T(t,"param")}function pn(){const t=document.getElementById("headersContainer");t.children.length===0&&T(t,"header")}function yn(){document.querySelector(".add-param").addEventListener("click",function(){const t=document.getElementById("paramsContainer");T(t,"param")}),document.querySelector(".add-header").addEventListener("click",function(){const t=document.getElementById("headersContainer");T(t,"header")})}async function fn(){try{ze(),Ke(),un(),await Qt(),await zt(),document.getElementById("newScenarioBtn").addEventListener("click",()=>{Wt()}),document.getElementById("runScenarioBtn").addEventListener("click",()=>{Xt()}),await ve(),te(),hn(),dn(),Je(),console.log("API Tester initialized successfully")}catch(t){console.error("Initialization error:",t),x("Failed to initialize: "+t.message)}}document.addEventListener("DOMContentLoaded",async()=>{await fn()});
