# 外部設計文書：PostPro API Tester Chrome 拡張

## 1. 文書概要

### 1.1 文書の目的
本外部設計文書は、PostPro API Tester Chrome拡張機能のシステム全体構造を理解し、各機能の詳細仕様を設計するものです。システムのユーザーインターフェース、外部システムとの連携、データベース設計、API仕様を含む包括的な外部設計を定義します。

### 1.2 文書の範囲
- システム外部インターフェース仕様
- API設計とプロトコル定義
- データベース・ストレージ設計
- 外部サービス連携仕様
- セキュリティ・認証設計
- 運用・監視インターフェース

### 1.3 参照文書
- システム企画書（docs/01.sp.md）
- 要求定義文書（docs/02.sa.md）
- 要件定義文書（docs/03.rd.md）
- 基本設計文書（docs/03.bd.md）
- UI基本設計文書（docs/04.ui.md）
- プロジェクト構成ファイル（CLAUDE.md）

---

## 2. システム外部環境

### 2.1 実行環境

#### 2.1.1 Chrome拡張機能環境
```typescript
interface RuntimeEnvironment {
  // Chrome拡張機能基盤
  platform: {
    browser: 'Chrome 100+';
    manifestVersion: 3;
    serviceWorker: true;
    contentScripts: true;
    webAccessibleResources: true;
  };
  
  // 実行コンテキスト
  contexts: {
    popup: 'index.html - メインUI';
    background: 'background.ts - Service Worker';
    content: 'content.ts - Webページ統合';
    injected: 'injected.ts - ページスクリプト注入';
  };
  
  // ストレージ制限
  storage: {
    maxSize: '5MB - Chrome Storage API制限';
    syncStorage: '100KB - 同期ストレージ制限';
    localStorage: 'unlimited - ローカルストレージ';
  };
  
  // 権限
  permissions: [
    'activeTab',
    'contextMenus', 
    'storage',
    'unlimitedStorage',
    'background',
    'webRequest',
    'declarativeNetRequest',
    'cookies',
    'tabs'
  ];
}
```

#### 2.1.2 技術スタック依存関係
```json
{
  "runtime": {
    "typescript": "5.8.3",
    "vite": "5.0.0",
    "jsonpath-plus": "8.0.0"
  },
  "development": {
    "jest": "29.5.0",
    "puppeteer": "21.0.0",
    "@types/chrome": "0.0.326"
  },
  "build": {
    "rollup": "bundled with vite",
    "babel": "7.27.1"
  }
}
```

### 2.2 外部システム依存関係

#### 2.2.1 エコーAPIサービス
```typescript
interface EchoAPIService {
  // サービス概要
  name: 'reply.tukutano.jp';
  purpose: 'HTTPリクエスト内容の検証用エコーAPI';
  
  // エンドポイント
  endpoint: {
    baseUrl: 'https://reply.tukutano.jp';
    method: 'ANY';
    path: '/*';
  };
  
  // レスポンス形式
  responseFormat: {
    method: 'string';      // 送信されたHTTPメソッド
    url: 'string';         // 送信されたURL
    headers: 'object';     // 送信されたヘッダー
    body: 'string';        // 送信されたボディ（文字列化）
    timestamp: 'string';   // サーバータイムスタンプ
  };
  
  // 可用性要件
  availability: {
    target: '99.0%';
    fallback: 'ローカルエコー機能';
    monitoring: '自動死活監視';
  };
}
```

#### 2.2.2 Chrome Web Store
```typescript
interface ChromeWebStoreIntegration {
  // 配布プラットフォーム
  platform: 'Chrome Web Store';
  packageFormat: 'CRX3';
  
  // メタデータ
  metadata: {
    name: 'PostPro API Tester';
    version: '3.0.0';
    category: 'Developer Tools';
    minChromeVersion: '100';
  };
  
  // 審査要件
  reviewRequirements: {
    privacyPolicy: 'required';
    permissions: 'justified';
    security: 'CSP compliant';
    functionality: 'working as described';
  };
}
```

---

## 3. 外部インターフェース設計

### 3.1 Chrome Extensions API

#### 3.1.1 Storage API
```typescript
interface ChromeStorageInterface {
  // ストレージキー設計
  keys: {
    APP_STATE: 'postpro_state';
    COLLECTIONS: 'postpro_collections';
    ENVIRONMENTS: 'postpro_environments';
    GLOBAL_VARIABLES: 'postpro_global_variables';
    HISTORY: 'postpro_history';
    SETTINGS: 'postpro_settings';
    BACKUPS: 'postpro_backups';
  };
  
  // データ構造
  schemas: {
    state: AppState;
    collections: Collection[];
    environments: Environment[];
    variables: Record<string, VariableData>;
    history: HistoryItem[];
    settings: AppSettings;
    backups: BackupData[];
  };
  
  // 操作メソッド
  operations: {
    get: '(keys: string[]) => Promise<Record<string, any>>';
    set: '(items: Record<string, any>) => Promise<void>';
    remove: '(keys: string[]) => Promise<void>';
    clear: '() => Promise<void>';
    getBytesInUse: '(keys?: string[]) => Promise<number>';
  };
}
```

#### 3.1.2 Runtime API（メッセージパッシング）
```typescript
interface ChromeRuntimeInterface {
  // メッセージタイプ定義
  messageTypes: {
    SEND_REQUEST: 'SEND_REQUEST';
    REQUEST_RESPONSE: 'REQUEST_RESPONSE';
    STATE_UPDATE: 'STATE_UPDATE';
    EXECUTE_SCRIPT: 'EXECUTE_SCRIPT';
    INTERCEPT_REQUEST: 'INTERCEPT_REQUEST';
    BACKGROUND_TASK: 'BACKGROUND_TASK';
  };
  
  // メッセージ構造
  messageStructure: {
    type: string;
    id: string;
    timestamp: number;
    data: any;
    sender?: string;
    target?: string;
  };
  
  // 通信経路
  communication: {
    'popup -> background': 'chrome.runtime.sendMessage()';
    'background -> content': 'chrome.tabs.sendMessage()';
    'content -> injected': 'window.postMessage()';
    'injected -> content': 'window.addEventListener("message")';
  };
}
```

#### 3.1.3 Tabs API
```typescript
interface ChromeTabsInterface {
  // タブ操作
  operations: {
    query: '(queryInfo: object) => Promise<Tab[]>';
    sendMessage: '(tabId: number, message: any) => Promise<any>';
    executeScript: '(tabId: number, details: object) => Promise<any>';
    insertCSS: '(tabId: number, details: object) => Promise<void>';
  };
  
  // タブ情報取得
  tabInfo: {
    id: 'number';
    url: 'string';
    title: 'string';
    active: 'boolean';
    status: 'loading | complete';
  };
  
  // イベント監視
  events: {
    onUpdated: 'Tab状態変更';
    onActivated: 'アクティブタブ変更';
    onRemoved: 'タブクローズ';
  };
}
```

### 3.2 Web Standards API

#### 3.2.1 XMLHttpRequest（HTTPクライアント）
```typescript
interface XMLHttpRequestInterface {
  // リクエスト設定
  configuration: {
    method: 'GET | POST | PUT | DELETE | PATCH | HEAD | OPTIONS';
    url: 'string - 完全なURL';
    async: 'boolean - 非同期フラグ（常にtrue）';
    timeout: 'number - ミリ秒（デフォルト30000）';
    responseType: 'text | json | blob | arraybuffer';
  };
  
  // ヘッダー管理
  headers: {
    setRequestHeader: '(name: string, value: string) => void';
    getResponseHeader: '(name: string) => string | null';
    getAllResponseHeaders: '() => string';
  };
  
  // 送信データ
  sendData: {
    string: 'Raw text data';
    FormData: 'Multipart form data';
    URLSearchParams: 'URL encoded data';
    Blob: 'Binary data';
    File: 'File upload';
  };
  
  // レスポンス処理
  response: {
    status: 'number - HTTPステータスコード';
    statusText: 'string - ステータステキスト';
    responseText: 'string - レスポンスボディ';
    responseXML: 'Document | null';
    response: 'any - responseTypeに応じた形式';
  };
}
```

#### 3.2.2 Web Crypto API（暗号化）
```typescript
interface WebCryptoInterface {
  // 暗号化アルゴリズム
  algorithms: {
    encryption: 'AES-GCM';
    keyDerivation: 'PBKDF2';
    hash: 'SHA-256';
  };
  
  // 鍵管理
  keyManagement: {
    deriveKey: '(password: string, salt: Uint8Array) => Promise<CryptoKey>';
    generateKey: '(algorithm: object) => Promise<CryptoKey>';
    exportKey: '(format: string, key: CryptoKey) => Promise<ArrayBuffer>';
    importKey: '(format: string, keyData: ArrayBuffer) => Promise<CryptoKey>';
  };
  
  // 暗号化・復号化
  cryptoOperations: {
    encrypt: '(algorithm: object, key: CryptoKey, data: ArrayBuffer) => Promise<ArrayBuffer>';
    decrypt: '(algorithm: object, key: CryptoKey, data: ArrayBuffer) => Promise<ArrayBuffer>';
  };
  
  // セキュリティ仕様
  security: {
    keyLength: 256; // AES-256
    iterations: 100000; // PBKDF2 iterations
    ivLength: 12; // GCM IV length
  };
}
```

---

## 4. データベース・ストレージ設計

### 4.1 Chrome Storage Schema

#### 4.1.1 アプリケーション状態（postpro_state）
```typescript
interface AppStateSchema {
  version: string; // データバージョン
  lastUpdated: string; // 最終更新日時
  currentRequest: RequestData | null; // 現在編集中のリクエスト
  currentCollection: string | null; // 選択中のコレクションID
  currentEnvironment: string | null; // 選択中の環境ID
  currentScenario: string | null; // 選択中のシナリオID
  
  // UI状態
  ui: {
    activeTab: string; // メインタブの状態
    sidebarExpanded: boolean; // サイドバー展開状態
    expandedCollections: string[]; // 展開されたコレクションID
    expandedScenarios: string[]; // 展開されたシナリオID
    selectedHistoryId: string | null; // 選択中の履歴ID
  };
  
  // 設定
  settings: {
    theme: 'light' | 'dark' | 'auto';
    fontSize: 'small' | 'medium' | 'large';
    autoSave: boolean;
    timeout: number; // リクエストタイムアウト（ミリ秒）
    maxHistoryItems: number;
    enableLogging: boolean;
  };
}
```

#### 4.1.2 コレクション（postpro_collections）
```typescript
interface CollectionSchema {
  [collectionId: string]: {
    id: string;
    name: string;
    description: string;
    created: string; // ISO8601日時
    updated: string; // ISO8601日時
    
    // フォルダ構造
    folders: {
      id: string;
      name: string;
      parentId: string | null;
      expanded: boolean;
    }[];
    
    // リクエスト
    requests: RequestData[];
    
    // コレクション変数
    variables: Record<string, VariableData>;
    
    // メタデータ
    metadata: {
      author: string;
      version: string;
      tags: string[];
      exportedFrom: 'postman' | 'insomnia' | 'openapi' | 'native';
    };
  };
}
```

#### 4.1.3 環境（postpro_environments）
```typescript
interface EnvironmentSchema {
  [environmentId: string]: {
    id: string;
    name: string;
    description: string;
    created: string;
    updated: string;
    
    // 環境変数
    variables: Record<string, VariableData>;
    
    // 環境設定
    settings: {
      baseUrl: string;
      timeout: number;
      retryCount: number;
      sslVerify: boolean;
    };
    
    // 認証設定
    auth: AuthConfig;
  };
}
```

#### 4.1.4 リクエスト履歴（postpro_history）
```typescript
interface HistorySchema {
  maxItems: number; // 最大保持件数
  autoCleanup: boolean; // 自動クリーンアップ有効
  lastCleanup: string; // 最終クリーンアップ日時
  
  items: {
    id: string;
    timestamp: string;
    
    // リクエスト実行情報
    execution: {
      request: RequestExecution;
      response: ResponseExecution;
      duration: number;
      error: string | null;
    };
    
    // テスト結果
    testResults: {
      total: number;
      passed: number;
      failed: number;
      results: TestResult[];
    };
    
    // メタデータ
    metadata: {
      collectionId: string | null;
      environmentId: string | null;
      scenarioId: string | null;
      tags: string[];
    };
  }[];
}
```

### 4.2 データ操作インターフェース

#### 4.2.1 ストレージマネージャー
```typescript
class StorageManager {
  // 基本操作
  async get<T>(key: string): Promise<T | null>;
  async set(key: string, value: any): Promise<void>;
  async remove(key: string): Promise<void>;
  async clear(): Promise<void>;
  
  // バッチ操作
  async getBatch(keys: string[]): Promise<Record<string, any>>;
  async setBatch(items: Record<string, any>): Promise<void>;
  async removeBatch(keys: string[]): Promise<void>;
  
  // 検索・フィルタ
  async findCollections(query: string): Promise<Collection[]>;
  async findRequests(query: string): Promise<RequestData[]>;
  async getHistory(filter: HistoryFilter): Promise<HistoryItem[]>;
  
  // データ整合性
  async validateData(): Promise<ValidationResult>;
  async migrateData(fromVersion: string, toVersion: string): Promise<void>;
  async repairCorruptedData(): Promise<RepairResult>;
  
  // 監視・イベント
  onDataChange(callback: (key: string, newValue: any, oldValue: any) => void): void;
  onStorageQuotaExceeded(callback: () => void): void;
}
```

#### 4.2.2 バックアップ・復旧
```typescript
interface BackupManager {
  // バックアップ作成
  createBackup: {
    manual: '(name: string) => Promise<BackupData>';
    auto: '() => Promise<BackupData>';
    scheduled: '(interval: number) => void';
  };
  
  // 復旧操作
  restore: {
    full: '(backupId: string) => Promise<void>';
    partial: '(backupId: string, keys: string[]) => Promise<void>';
    preview: '(backupId: string) => Promise<BackupPreview>';
  };
  
  // バックアップ管理
  management: {
    list: '() => Promise<BackupInfo[]>';
    delete: '(backupId: string) => Promise<void>';
    cleanup: '(retentionDays: number) => Promise<void>';
    export: '(backupId: string) => Promise<Blob>';
    import: '(file: File) => Promise<BackupData>';
  };
}
```

---

## 5. 外部API設計

### 5.1 エコーAPIプロトコル

#### 5.1.1 リクエスト仕様
```typescript
interface EchoAPIRequest {
  // エンドポイント
  endpoint: 'https://reply.tukutano.jp/*';
  
  // 対応メソッド
  methods: [
    'GET', 'POST', 'PUT', 'DELETE', 
    'PATCH', 'HEAD', 'OPTIONS'
  ];
  
  // リクエストヘッダー
  headers: {
    'Content-Type': 'application/json | application/x-www-form-urlencoded | multipart/form-data | text/plain';
    'User-Agent': 'PostPro-API-Tester/3.0.0';
    'Authorization': 'Bearer <token> | Basic <credentials> | <custom>';
    [key: string]: string;
  };
  
  // リクエストボディ
  body: {
    json: 'JSON形式のオブジェクト';
    formData: 'FormDataオブジェクト';
    urlencoded: 'URLSearchParamsオブジェクト';
    text: 'プレーンテキスト';
    binary: 'Fileオブジェクト';
  };
}
```

#### 5.1.2 レスポンス仕様
```typescript
interface EchoAPIResponse {
  // 基本情報
  method: string; // 送信されたHTTPメソッド
  url: string; // 送信されたURL（クエリパラメータ含む）
  protocol: string; // HTTPプロトコルバージョン
  
  // ヘッダー情報
  headers: Record<string, string>; // 送信されたリクエストヘッダー
  
  // ボディ情報
  body: string; // 送信されたリクエストボディ（文字列化）
  bodySize: number; // ボディサイズ（バイト）
  
  // サーバー情報
  serverTimestamp: string; // サーバー受信日時（ISO8601）
  serverVersion: string; // エコーAPIバージョン
  processingTime: number; // サーバー処理時間（ミリ秒）
  
  // 追加情報
  clientIp: string; // クライアントIPアドレス
  userAgent: string; // User-Agentヘッダー
  contentType: string; // Content-Typeヘッダー
}
```

#### 5.1.3 エラーハンドリング
```typescript
interface EchoAPIErrorHandling {
  // HTTPエラー
  httpErrors: {
    400: 'Bad Request - 不正なリクエスト形式';
    413: 'Payload Too Large - リクエストサイズ制限超過';
    429: 'Too Many Requests - レート制限';
    500: 'Internal Server Error - サーバーエラー';
    503: 'Service Unavailable - サービス停止';
  };
  
  // ネットワークエラー
  networkErrors: {
    timeout: 'リクエストタイムアウト';
    dns: 'DNS解決失敗';
    ssl: 'SSL証明書エラー';
    connection: '接続エラー';
  };
  
  // フォールバック戦略
  fallback: {
    localEcho: 'ローカルエコー機能に切り替え';
    retry: '指数バックオフによる自動リトライ';
    cache: 'キャッシュされたレスポンス使用';
    offline: 'オフラインモード移行';
  };
}
```

### 5.2 内部API設計

#### 5.2.1 RequestManager API
```typescript
interface RequestManagerAPI {
  // リクエスト実行
  sendRequest: {
    method: '(request: RequestData) => Promise<ResponseData>';
    description: 'HTTPリクエストを送信し、レスポンスを取得';
    parameters: {
      request: 'リクエストデータオブジェクト';
    };
    returns: 'レスポンスデータオブジェクト';
    errors: ['NetworkError', 'TimeoutError', 'ValidationError'];
  };
  
  // リクエスト検証
  validateRequest: {
    method: '(request: RequestData) => ValidationResult';
    description: 'リクエストデータの妥当性を検証';
    parameters: {
      request: '検証対象のリクエストデータ';
    };
    returns: '検証結果オブジェクト';
  };
  
  // プリリクエストスクリプト
  executePreRequestScript: {
    method: '(script: string, context: ScriptContext) => Promise<void>';
    description: 'プリリクエストスクリプトを実行';
    parameters: {
      script: 'JavaScriptコード文字列';
      context: 'スクリプト実行コンテキスト';
    };
    returns: 'void';
    errors: ['ScriptError', 'SecurityError', 'TimeoutError'];
  };
  
  // テストスクリプト
  executeTestScript: {
    method: '(script: string, response: ResponseData) => Promise<TestResult[]>';
    description: 'テストスクリプトを実行';
    parameters: {
      script: 'テストスクリプトコード';
      response: 'レスポンスデータ';
    };
    returns: 'テスト結果配列';
    errors: ['ScriptError', 'AssertionError', 'TimeoutError'];
  };
}
```

#### 5.2.2 VariableManager API
```typescript
interface VariableManagerAPI {
  // 変数取得
  getVariable: {
    method: '(name: string, scope?: VariableScope) => any';
    description: '変数値を取得（優先順位: コレクション > 環境 > グローバル）';
    parameters: {
      name: '変数名';
      scope: '検索スコープ（オプション）';
    };
    returns: '変数値';
  };
  
  // 変数設定
  setVariable: {
    method: '(name: string, value: any, scope: VariableScope) => void';
    description: '変数値を設定';
    parameters: {
      name: '変数名';
      value: '設定値';
      scope: '設定スコープ';
    };
    returns: 'void';
  };
  
  // 変数置換
  replaceVariables: {
    method: '(text: string) => string';
    description: 'テキスト内の変数参照を実際の値に置換';
    parameters: {
      text: '変数参照を含むテキスト';
    };
    returns: '置換後のテキスト';
  };
  
  // 動的変数
  builtInVariables: {
    '$timestamp': 'number - 現在のUnixタイムスタンプ';
    '$isoTimestamp': 'string - ISO8601形式の現在日時';
    '$randomInt': 'number - 0-999のランダムな整数';
    '$guid': 'string - UUIDv4形式のランダムなGUID';
    '$randomString': 'string - ランダムな文字列（10文字）';
  };
}
```

#### 5.2.3 CollectionManager API
```typescript
interface CollectionManagerAPI {
  // コレクション操作
  createCollection: {
    method: '(name: string, description?: string) => Promise<Collection>';
    description: '新しいコレクションを作成';
  };
  
  updateCollection: {
    method: '(id: string, updates: Partial<Collection>) => Promise<Collection>';
    description: 'コレクションを更新';
  };
  
  deleteCollection: {
    method: '(id: string) => Promise<void>';
    description: 'コレクションを削除';
  };
  
  // リクエスト操作
  addRequest: {
    method: '(collectionId: string, request: RequestData) => Promise<void>';
    description: 'コレクションにリクエストを追加';
  };
  
  moveRequest: {
    method: '(requestId: string, targetCollectionId: string, targetFolderId?: string) => Promise<void>';
    description: 'リクエストを移動';
  };
  
  // コレクション実行
  runCollection: {
    method: '(id: string, options?: RunOptions) => Promise<CollectionRunResult>';
    description: 'コレクション内の全リクエストを順次実行';
  };
  
  // インポート・エクスポート
  exportCollection: {
    method: '(id: string, format: ExportFormat) => Promise<string>';
    description: 'コレクションを指定形式でエクスポート';
  };
  
  importCollection: {
    method: '(data: string, format: ImportFormat) => Promise<Collection>';
    description: '外部データからコレクションをインポート';
  };
}
```

---

## 6. セキュリティ設計

### 6.1 認証・認可

#### 6.1.1 認証方式サポート
```typescript
interface AuthenticationSupport {
  // Basic認証
  basic: {
    method: 'Basic Authentication';
    implementation: 'Base64(username:password)';
    storage: 'encrypted in Chrome Storage';
    transmission: 'Authorization header';
  };
  
  // Bearer Token認証
  bearer: {
    method: 'Bearer Token Authentication';
    implementation: 'Bearer <token>';
    storage: 'encrypted in Chrome Storage';
    transmission: 'Authorization header';
  };
  
  // API Key認証
  apiKey: {
    method: 'API Key Authentication';
    implementation: 'Custom header or query parameter';
    storage: 'encrypted in Chrome Storage';
    transmission: 'Configurable location';
  };
  
  // OAuth2（将来実装）
  oauth2: {
    method: 'OAuth 2.0 Authorization Code Flow';
    implementation: 'PKCE with code challenge';
    storage: 'encrypted access/refresh tokens';
    transmission: 'Authorization header';
  };
}
```

#### 6.1.2 機密データ暗号化
```typescript
interface EncryptionSpecification {
  // 暗号化アルゴリズム
  algorithm: {
    encryption: 'AES-256-GCM';
    keyDerivation: 'PBKDF2';
    hash: 'SHA-256';
    randomGenerator: 'Crypto.getRandomValues()';
  };
  
  // 鍵管理
  keyManagement: {
    masterKey: 'User device specific';
    salt: 'Random 32 bytes per encryption';
    iterations: 100000; // PBKDF2 iterations
    keyLength: 256; // bits
  };
  
  // 暗号化対象
  encryptedData: [
    'AuthConfig credentials',
    'Bearer tokens',
    'API keys',
    'OAuth2 tokens',
    'Sensitive environment variables'
  ];
  
  // ストレージ形式
  storageFormat: {
    algorithm: 'string';
    iv: 'number[]'; // Initialization Vector
    salt: 'number[]';
    data: 'number[]'; // Encrypted data
    timestamp: 'number';
  };
}
```

### 6.2 スクリプト実行セキュリティ

#### 6.2.1 サンドボックス環境
```typescript
interface ScriptSandbox {
  // 実行環境制限
  environment: {
    context: 'Isolated JavaScript context';
    timeout: '10 seconds maximum';
    memoryLimit: '10MB per script';
    cpuLimit: 'Throttled execution';
  };
  
  // 許可されたAPI
  allowedAPIs: [
    'JSON.parse', 'JSON.stringify',
    'Date constructor and methods',
    'Math object and methods',
    'String methods',
    'Array methods',
    'Object methods',
    'pm object (Postman API)',
    'console.log (limited)'
  ];
  
  // 禁止されたAPI
  blockedAPIs: [
    'eval', 'Function constructor',
    'XMLHttpRequest', 'fetch',
    'WebSocket', 'SharedArrayBuffer',
    'postMessage', 'importScripts',
    'Worker', 'ServiceWorker',
    'localStorage', 'sessionStorage',
    'document', 'window',
    'chrome extension APIs'
  ];
  
  // セキュリティ検証
  validation: {
    staticAnalysis: 'Pre-execution code scanning';
    patternDetection: 'Dangerous pattern detection';
    runtimeMonitoring: 'Execution behavior monitoring';
  };
}
```

#### 6.2.2 Content Security Policy
```typescript
interface ContentSecurityPolicy {
  // 拡張機能ページ
  extensionPages: {
    scriptSrc: "'self'";
    objectSrc: "'self'";
    imgSrc: "'self' data: chrome-extension:";
    styleSrc: "'self' 'unsafe-inline'";
    fontSrc: "'self'";
    connectSrc: "'self' https:";
  };
  
  // 注入されたスクリプト
  injectedScripts: {
    scriptSrc: "'self'";
    objectSrc: "'none'";
    baseUri: "'none'";
  };
  
  // セキュリティヘッダー
  securityHeaders: {
    'X-Content-Type-Options': 'nosniff';
    'X-Frame-Options': 'DENY';
    'X-XSS-Protection': '1; mode=block';
  };
}
```

### 6.3 データ保護

#### 6.3.1 プライバシー保護
```typescript
interface PrivacyProtection {
  // データ収集制限
  dataCollection: {
    userConsent: 'Required for any data collection';
    minimization: 'Collect only necessary data';
    purpose: 'Clear purpose specification';
    retention: 'Automatic data deletion';
  };
  
  // 外部送信制限
  dataTransmission: {
    userRequests: 'Only user-initiated requests';
    encryption: 'TLS 1.2+ for all external communication';
    logFiltering: 'No sensitive data in logs';
    tracking: 'No analytics or tracking';
  };
  
  // ローカルデータ保護
  localData: {
    encryption: 'Sensitive data encrypted at rest';
    isolation: 'Data isolated per user profile';
    cleanup: 'Secure deletion on uninstall';
    backup: 'User-controlled backup only';
  };
}
```

#### 6.3.2 セキュアな通信
```typescript
interface SecureCommunication {
  // HTTPS強制
  httpsEnforcement: {
    policy: 'All external requests must use HTTPS';
    fallback: 'No HTTP fallback allowed';
    validation: 'Certificate validation required';
    minTLS: 'TLS 1.2 minimum';
  };
  
  // リクエストフィルタリング
  requestFiltering: {
    allowedProtocols: ['https:', 'wss:'];
    blockedDomains: ['Private IP ranges', 'localhost (except development)'];
    headerValidation: 'Malicious header detection';
    sizeLimit: '10MB maximum request size';
  };
  
  // レスポンス検証
  responseValidation: {
    contentType: 'Content-Type header validation';
    sizeLimit: '50MB maximum response size';
    malwareScanning: 'Basic malware pattern detection';
    encoding: 'Safe encoding validation';
  };
}
```

---

## 7. 運用インターフェース

### 7.1 ログ・監視

#### 7.1.1 ログシステム
```typescript
interface LoggingSystem {
  // ログレベル
  levels: {
    ERROR: 0; // エラー・例外
    WARN: 1;  // 警告
    INFO: 2;  // 情報
    DEBUG: 3; // デバッグ（開発時のみ）
  };
  
  // ログ形式
  format: {
    timestamp: 'ISO8601 UTC';
    level: 'ERROR | WARN | INFO | DEBUG';
    category: 'string'; // request, auth, storage, etc.
    message: 'string';
    data: 'object'; // 追加データ（個人情報除外）
    stack: 'string'; // エラースタックトレース
  };
  
  // ログ出力先
  outputs: {
    console: 'Browser console (development)';
    storage: 'Chrome Storage (limited)';
    memory: 'In-memory buffer (最新100件)';
  };
  
  // ログ管理
  management: {
    rotation: 'Automatic log rotation (1000 entries max)';
    cleanup: 'Automatic cleanup (7 days retention)';
    export: 'User-initiated log export';
    privacy: 'No sensitive data in logs';
  };
}
```

#### 7.1.2 パフォーマンス監視
```typescript
interface PerformanceMonitoring {
  // メトリクス収集
  metrics: {
    requestLatency: 'HTTP request response time';
    scriptExecution: 'Pre-request and test script execution time';
    uiResponse: 'UI operation response time';
    memoryUsage: 'Chrome extension memory usage';
    storageUsage: 'Chrome Storage usage';
  };
  
  // しきい値アラート
  thresholds: {
    requestTimeout: '30 seconds';
    scriptTimeout: '10 seconds';
    memoryLimit: '50MB';
    storageLimit: '4MB (80% of 5MB limit)';
  };
  
  // パフォーマンス最適化
  optimization: {
    lazyLoading: 'Defer loading of non-critical components';
    virtualScrolling: 'Virtual scrolling for large lists';
    caching: 'Intelligent caching strategies';
    debouncing: 'User input debouncing';
  };
}
```

### 7.2 エラーハンドリング

#### 7.2.1 エラー分類
```typescript
interface ErrorClassification {
  // ネットワークエラー
  networkErrors: {
    ConnectionError: 'ネットワーク接続エラー';
    TimeoutError: 'リクエストタイムアウト';
    DNSError: 'DNS解決エラー';
    SSLError: 'SSL/TLS証明書エラー';
    CORSError: 'CORS (Cross-Origin) エラー';
  };
  
  // 認証エラー
  authErrors: {
    InvalidCredentials: '認証情報が無効';
    TokenExpired: 'トークンの有効期限切れ';
    InsufficientPermissions: '権限不足';
    AuthenticationFailed: '認証失敗';
  };
  
  // アプリケーションエラー
  applicationErrors: {
    ValidationError: 'データ検証エラー';
    ScriptError: 'スクリプト実行エラー';
    StorageError: 'ストレージ操作エラー';
    ImportError: 'データインポートエラー';
  };
  
  // システムエラー
  systemErrors: {
    OutOfMemory: 'メモリ不足';
    QuotaExceeded: 'ストレージ容量超過';
    PermissionDenied: '権限拒否';
    ExtensionDisabled: '拡張機能無効';
  };
}
```

#### 7.2.2 エラー復旧戦略
```typescript
interface ErrorRecoveryStrategy {
  // 自動復旧
  automaticRecovery: {
    retry: {
      maxAttempts: 3;
      backoffStrategy: 'Exponential backoff';
      retryableErrors: ['NetworkError', 'TimeoutError'];
    };
    
    fallback: {
      echoAPI: 'Local echo fallback';
      storage: 'Memory fallback';
      auth: 'Re-authentication prompt';
    };
    
    gracefulDegradation: {
      offlineMode: 'Limited functionality without network';
      readOnlyMode: 'Read-only when storage fails';
      basicMode: 'Core functionality only';
    };
  };
  
  // ユーザー通知
  userNotification: {
    errorMessage: 'User-friendly error description';
    suggestedAction: 'Clear next steps for user';
    supportInfo: 'How to get help';
    reportOption: 'Error reporting mechanism';
  };
  
  // データ保護
  dataProtection: {
    autoSave: 'Auto-save before risky operations';
    backup: 'Automatic backup creation';
    rollback: 'Rollback to last known good state';
    validation: 'Data integrity validation';
  };
}
```

### 7.3 バージョン管理・更新

#### 7.3.1 バージョニング戦略
```typescript
interface VersioningStrategy {
  // セマンティックバージョニング
  versioning: {
    format: 'MAJOR.MINOR.PATCH';
    major: 'Breaking changes or major new features';
    minor: 'New features, backward compatible';
    patch: 'Bug fixes, backward compatible';
  };
  
  // データマイグレーション
  dataMigration: {
    schemaVersion: 'Separate schema versioning';
    migration: 'Automatic migration scripts';
    fallback: 'Backward compatibility layer';
    validation: 'Post-migration validation';
  };
  
  // 機能フラグ
  featureFlags: {
    implementation: 'Runtime feature toggles';
    gradualRollout: 'Phased feature rollout';
    killSwitch: 'Emergency feature disable';
    userControl: 'User opt-in for experimental features';
  };
}
```

#### 7.3.2 更新プロセス
```typescript
interface UpdateProcess {
  // Chrome Web Store更新
  storeUpdate: {
    automatic: 'Chrome handles automatic updates';
    notification: 'User notification of updates';
    rollback: 'Ability to rollback problematic updates';
    testing: 'Staged rollout for testing';
  };
  
  // 設定移行
  settingsMigration: {
    preservation: 'Preserve user settings across updates';
    defaultUpdate: 'Update defaults for new settings';
    cleanup: 'Remove obsolete settings';
    validation: 'Validate migrated settings';
  };
  
  // データ互換性
  dataCompatibility: {
    forwardCompatibility: 'New versions read old data';
    backwardCompatibility: 'Limited backward compatibility';
    migration: 'Automatic data format migration';
    backup: 'Pre-migration backup creation';
  };
}
```

---

## 8. API仕様詳細

### 8.1 Postman互換API

#### 8.1.1 pm オブジェクト
```typescript
interface PostmanAPICompatibility {
  // pm.test() - テスト定義
  test: {
    signature: '(testName: string, testFunction: () => void) => void';
    description: 'テストケースを定義';
    example: `pm.test("Status code is 200", function () {
      pm.expect(pm.response.code).to.equal(200);
    });`;
  };
  
  // pm.expect() - アサーション
  expect: {
    signature: '(actual: any) => ChaiExpect';
    description: 'Chaiライクなアサーション';
    methods: [
      'to.equal(expected)',
      'to.be.a(type)',
      'to.have.property(prop)',
      'to.include(value)',
      'to.be.above(value)',
      'to.be.below(value)'
    ];
  };
  
  // pm.response - レスポンスアクセス
  response: {
    code: 'number - HTTPステータスコード';
    status: 'string - ステータステキスト';
    headers: 'object - レスポンスヘッダー';
    responseTime: 'number - レスポンス時間（ミリ秒）';
    responseSize: 'number - レスポンスサイズ（バイト）';
    json: '() => object - JSONレスポンスをパース';
    text: '() => string - レスポンスをテキストで取得';
  };
  
  // pm.variables - 変数操作
  variables: {
    get: '(name: string) => any - 変数値取得';
    set: '(name: string, value: any) => void - 変数値設定';
    unset: '(name: string) => void - 変数削除';
    has: '(name: string) => boolean - 変数存在確認';
  };
}
```

#### 8.1.2 従来形式コマンド
```typescript
interface LegacyTestCommands {
  // ステータスコード検証
  status: {
    command: 'status 200';
    description: 'HTTPステータスコードが指定値と一致するか検証';
    syntax: 'status <expected_code>';
  };
  
  // ヘッダー検証
  headerEquals: {
    command: 'headerEquals Content-Type application/json';
    description: 'レスポンスヘッダーが指定値と一致するか検証';
    syntax: 'headerEquals <header_name> <expected_value>';
  };
  
  // ボディ検証
  bodyContains: {
    command: 'bodyContains "success"';
    description: 'レスポンスボディに指定文字列が含まれるか検証';
    syntax: 'bodyContains <expected_string>';
  };
  
  // JSONパス検証
  jsonPath: {
    command: 'jsonPath $.users[0].name "John"';
    description: 'JSONパスで指定した値が期待値と一致するか検証';
    syntax: 'jsonPath <path> <expected_value>';
  };
  
  // エコーAPI検証
  echoRequestMethodEquals: {
    command: 'echoRequestMethodEquals POST';
    description: 'エコーAPIで送信メソッドを検証';
    syntax: 'echoRequestMethodEquals <expected_method>';
  };
  
  echoRequestHeaderEquals: {
    command: 'echoRequestHeaderEquals Authorization "Bearer token123"';
    description: 'エコーAPIで送信ヘッダーを検証';
    syntax: 'echoRequestHeaderEquals <header_name> <expected_value>';
  };
  
  echoRequestBodyEquals: {
    command: 'echoRequestBodyEquals {"test":"data"}';
    description: 'エコーAPIで送信ボディを検証';
    syntax: 'echoRequestBodyEquals <expected_body>';
  };
}
```

### 8.2 内部メッセージング API

#### 8.2.1 Chrome Extension メッセージ
```typescript
interface ChromeExtensionMessaging {
  // Popup -> Background
  popupToBackground: {
    SEND_REQUEST: {
      type: 'SEND_REQUEST';
      data: {
        request: RequestData;
        options: RequestOptions;
      };
    };
    
    UPDATE_STATE: {
      type: 'UPDATE_STATE';
      data: {
        key: string;
        value: any;
      };
    };
    
    EXECUTE_SCRIPT: {
      type: 'EXECUTE_SCRIPT';
      data: {
        script: string;
        context: ScriptContext;
      };
    };
  };
  
  // Background -> Popup
  backgroundToPopup: {
    REQUEST_RESPONSE: {
      type: 'REQUEST_RESPONSE';
      data: {
        requestId: string;
        response: ResponseData;
        error?: string;
      };
    };
    
    STATE_UPDATED: {
      type: 'STATE_UPDATED';
      data: {
        key: string;
        newValue: any;
      };
    };
    
    SCRIPT_RESULT: {
      type: 'SCRIPT_RESULT';
      data: {
        scriptId: string;
        result: any;
        error?: string;
      };
    };
  };
  
  // Content Script -> Background
  contentToBackground: {
    INTERCEPT_REQUEST: {
      type: 'INTERCEPT_REQUEST';
      data: {
        url: string;
        method: string;
        headers: Record<string, string>;
        body?: string;
      };
    };
    
    PAGE_LOADED: {
      type: 'PAGE_LOADED';
      data: {
        url: string;
        title: string;
      };
    };
  };
}
```

#### 8.2.2 エラー通信プロトコル
```typescript
interface ErrorCommunicationProtocol {
  // エラーレポート形式
  errorReport: {
    id: 'string - エラーID';
    timestamp: 'string - ISO8601タイムスタンプ';
    level: 'error | warning | info';
    category: 'network | auth | script | storage | ui';
    message: 'string - エラーメッセージ';
    stack: 'string - スタックトレース';
    context: {
      userAgent: 'string';
      extensionVersion: 'string';
      chromeVersion: 'string';
      url: 'string - 現在のURL（個人情報除外）';
      action: 'string - 実行中のアクション';
    };
    metadata: {
      requestId?: 'string';
      collectionId?: 'string';
      environmentId?: 'string';
    };
  };
  
  // エラー通知
  errorNotification: {
    user: {
      level: 'error | warning';
      message: 'ユーザーフレンドリーなメッセージ';
      suggestion: 'エラー解決のための提案';
      action: 'retry | ignore | report';
    };
    
    system: {
      level: 'critical | error | warning';
      component: 'string - エラー発生コンポーネント';
      recovery: 'auto | manual | none';
      escalation: 'boolean - エスカレーション必要';
    };
  };
}
```

---

## 9. 性能・品質要件

### 9.1 性能要件詳細

#### 9.1.1 レスポンス時間要件
```typescript
interface ResponseTimeRequirements {
  // UI操作
  uiOperations: {
    buttonClick: '< 100ms - ボタンクリックからレスポンスまで';
    tabSwitch: '< 150ms - タブ切り替え';
    modalOpen: '< 200ms - モーダル表示';
    listScroll: '< 16ms - スムーズなスクロール（60fps）';
  };
  
  // データ操作
  dataOperations: {
    requestSend: '< 1000ms - リクエスト送信処理開始';
    stateSave: '< 500ms - 状態保存';
    historyLoad: '< 300ms - 履歴読み込み';
    collectionLoad: '< 400ms - コレクション読み込み';
  };
  
  // スクリプト実行
  scriptExecution: {
    preRequest: '< 5000ms - プリリクエストスクリプト';
    testScript: '< 10000ms - テストスクリプト';
    validation: '< 100ms - 入力値検証';
  };
  
  // ネットワーク
  networkOperations: {
    httpRequest: 'user-defined timeout (default 30s)';
    echoAPI: '< 5000ms - エコーAPI応答';
    dns: '< 2000ms - DNS解決';
  };
}
```

#### 9.1.2 スループット要件
```typescript
interface ThroughputRequirements {
  // 同時リクエスト
  concurrentRequests: {
    maximum: 10; // 同時実行可能なHTTPリクエスト数
    queueSize: 100; // 待機キューサイズ
    processing: 'FIFO with priority';
  };
  
  // データ処理
  dataProcessing: {
    collections: '1000 collections maximum';
    requestsPerCollection: '1000 requests maximum';
    historyItems: '10000 items maximum';
    variableCount: '500 variables per scope';
  };
  
  // ストレージ操作
  storageOperations: {
    readThroughput: '> 10MB/s - ストレージ読み込み';
    writeThroughput: '> 5MB/s - ストレージ書き込み';
    batchOperations: '100 operations per batch';
  };
}
```

### 9.2 品質要件詳細

#### 9.2.1 可用性要件
```typescript
interface AvailabilityRequirements {
  // システム稼働率
  uptime: {
    target: '99.9% - 年間8.76時間のダウンタイム以下';
    measurement: '拡張機能の正常動作時間';
    excludes: [
      'ユーザーによる無効化',
      'Chromeブラウザの異常終了',
      '意図的なアップデート時間'
    ];
  };
  
  // 障害復旧
  recovery: {
    automaticRecovery: '< 30秒 - 自動復旧時間';
    manualRecovery: '< 5分 - 手動復旧時間';
    dataRecovery: '< 10分 - データ復旧時間';
    gracefulDegradation: 'コア機能は常に利用可能';
  };
  
  // エラー率
  errorRates: {
    requestFailure: '< 1% - HTTPリクエスト失敗率';
    scriptFailure: '< 5% - スクリプト実行失敗率';
    storageFailure: '< 0.1% - ストレージ操作失敗率';
    uiError: '< 0.5% - UI操作エラー率';
  };
}
```

#### 9.2.2 セキュリティ要件
```typescript
interface SecurityRequirements {
  // データ暗号化
  encryption: {
    algorithm: 'AES-256-GCM';
    keyManagement: 'PBKDF2 with 100,000 iterations';
    scope: '認証情報、トークン、機密変数';
    storage: 'Chrome Storage API with encryption';
  };
  
  // アクセス制御
  accessControl: {
    principle: 'Least privilege';
    isolation: 'Origin-based isolation';
    permissions: 'Minimal required permissions';
    validation: 'Input validation and sanitization';
  };
  
  // セキュリティ監査
  securityAudit: {
    frequency: 'Monthly automated scans';
    tools: ['ESLint security rules', 'Dependency audit'];
    scope: ['Code vulnerabilities', 'Dependency vulnerabilities'];
    response: '24-48 hours for critical issues';
  };
}
```

### 9.3 互換性要件

#### 9.3.1 ブラウザ互換性
```typescript
interface BrowserCompatibility {
  // 対応ブラウザ
  supportedBrowsers: {
    chrome: {
      minimum: '100.0';
      recommended: 'Latest stable';
      manifestVersion: 3;
      limitations: 'None';
    };
    
    edge: {
      minimum: '100.0 (Chromium-based)';
      recommended: 'Latest stable';
      status: 'Future support planned';
      limitations: 'API differences may apply';
    };
    
    firefox: {
      status: 'Not supported';
      reason: 'Manifest V3 migration required';
      timeline: 'Under consideration';
    };
  };
  
  // Chrome API互換性
  chromeAPICompatibility: {
    storage: 'Chrome Storage API v1';
    runtime: 'Chrome Runtime API v1';
    tabs: 'Chrome Tabs API v1';
    webRequest: 'Declarative Net Request API';
    background: 'Service Worker (Manifest V3)';
  };
}
```

#### 9.3.2 データ互換性
```typescript
interface DataCompatibility {
  // インポート形式
  importFormats: {
    postman: {
      version: 'v2.1';
      support: 'Collections, environments, requests';
      limitations: [
        'Advanced auth flows not supported',
        'Complex scripts may need modification'
      ];
    };
    
    insomnia: {
      version: 'v4';
      support: 'Basic collections and requests';
      limitations: [
        'Plugin-specific features not supported',
        'Environment mapping required'
      ];
    };
    
    openapi: {
      version: '3.0, 3.1';
      support: 'API specification import';
      limitations: [
        'Examples only, no test scripts',
        'Manual environment setup required'
      ];
    };
  };
  
  // エクスポート形式
  exportFormats: {
    native: {
      format: 'JSON';
      includes: 'All data including variables and scripts';
      encryption: 'Optional for sensitive data';
    };
    
    postman: {
      format: 'Postman Collection v2.1';
      includes: 'Collections and basic environments';
      limitations: 'Custom features may be lost';
    };
    
    curl: {
      format: 'cURL commands';
      includes: 'Individual requests only';
      limitations: 'No variables or scripts';
    };
  };
}
```

---

## 10. 運用・保守要件

### 10.1 監視・ログ要件

#### 10.1.1 ログ要件詳細
```typescript
interface DetailedLoggingRequirements {
  // ログレベル運用
  logLevels: {
    production: {
      enabled: ['ERROR', 'WARN'];
      disabled: ['INFO', 'DEBUG'];
      storage: 'Local only';
      retention: '7 days';
    };
    
    development: {
      enabled: ['ERROR', 'WARN', 'INFO', 'DEBUG'];
      output: ['console', 'storage'];
      retention: '1 day';
    };
  };
  
  // ログカテゴリ
  categories: {
    request: 'HTTP request/response operations';
    auth: 'Authentication and authorization';
    script: 'Script execution (pre-request/test)';
    storage: 'Data storage operations';
    ui: 'User interface interactions';
    system: 'System-level events';
    performance: 'Performance metrics';
    security: 'Security-related events';
  };
  
  // センシティブデータフィルタ
  dataFiltering: {
    excluded: [
      'Passwords and tokens',
      'Personal information',
      'API keys',
      'Request/response bodies with PII'
    ];
    
    masked: [
      'URLs with query parameters',
      'Header values (except content-type)',
      'Large response bodies (truncated)'
    ];
  };
}
```

#### 10.1.2 メトリクス収集
```typescript
interface MetricsCollection {
  // パフォーマンスメトリクス
  performance: {
    requestLatency: {
      metric: 'HTTP request response time';
      unit: 'milliseconds';
      aggregation: ['p50', 'p95', 'p99', 'avg'];
      alertThreshold: 'p95 > 30000ms';
    };
    
    memoryUsage: {
      metric: 'Extension memory consumption';
      unit: 'megabytes';
      sampling: 'Every 30 seconds';
      alertThreshold: '> 50MB';
    };
    
    storageUsage: {
      metric: 'Chrome Storage usage';
      unit: 'bytes';
      sampling: 'On each write operation';
      alertThreshold: '> 4MB (80% of limit)';
    };
  };
  
  // 使用状況メトリクス
  usage: {
    activeUsers: {
      metric: 'Daily active users';
      collection: 'Local analytics only';
      privacy: 'No user identification';
    };
    
    requestCount: {
      metric: 'HTTP requests sent per session';
      aggregation: ['total', 'avg', 'max'];
      purpose: 'Performance optimization';
    };
    
    featureUsage: {
      metric: 'Feature adoption rates';
      scope: ['collections', 'environments', 'scripts'];
      purpose: 'Product improvement guidance';
    };
  };
  
  // エラーメトリクス
  errors: {
    errorRate: {
      metric: 'Error occurrence frequency';
      categorization: 'By error type and component';
      alertThreshold: '> 5% error rate';
    };
    
    crashRate: {
      metric: 'Extension crash frequency';
      detection: 'Extension reload events';
      alertThreshold: '> 1% of sessions';
    };
  };
}
```

### 10.2 バックアップ・復旧

#### 10.2.1 バックアップ戦略
```typescript
interface BackupStrategy {
  // 自動バックアップ
  automatic: {
    frequency: 'Daily at 2:00 AM local time';
    retention: '7 daily backups + 4 weekly backups';
    trigger: 'Significant data changes';
    scope: 'All user data except cache';
  };
  
  // 手動バックアップ
  manual: {
    userInitiated: 'On-demand backup creation';
    preUpdate: 'Before extension updates';
    beforeImport: 'Before importing external data';
    scope: 'Configurable data selection';
  };
  
  // バックアップ形式
  format: {
    structure: {
      metadata: {
        version: 'string';
        timestamp: 'ISO8601';
        type: 'auto | manual | export';
        checksum: 'SHA-256 hash';
      };
      
      data: {
        collections: 'Collection[]';
        environments: 'Environment[]';
        globalVariables: 'Record<string, VariableData>';
        settings: 'AppSettings';
        history: 'HistoryItem[] (optional)';
      };
    };
    
    encryption: {
      enabled: 'For sensitive data';
      algorithm: 'AES-256-GCM';
      keyDerivation: 'User password-based';
    };
  };
}
```

#### 10.2.2 災害復旧
```typescript
interface DisasterRecovery {
  // 復旧シナリオ
  scenarios: {
    dataCorruption: {
      detection: 'Automatic data validation on startup';
      response: 'Restore from latest valid backup';
      fallback: 'Reset to factory defaults with user consent';
    };
    
    extensionFailure: {
      detection: 'Extension won\'t start or frequent crashes';
      response: 'Safe mode with minimal functionality';
      recovery: 'Guided troubleshooting wizard';
    };
    
    storageFailure: {
      detection: 'Chrome Storage API errors';
      response: 'In-memory mode with warning';
      recovery: 'Data export for manual backup';
    };
  };
  
  // 復旧手順
  recoveryProcedures: {
    automated: {
      validation: 'Data integrity checks on startup';
      repair: 'Automatic repair of minor corruption';
      notification: 'User notification of recovery actions';
    };
    
    guided: {
      wizard: 'Step-by-step recovery wizard';
      diagnostics: 'Built-in diagnostic tools';
      support: 'Links to troubleshooting documentation';
    };
    
    manual: {
      export: 'Emergency data export functionality';
      import: 'Selective data import capabilities';
      reset: 'Clean slate reset option';
    };
  };
}
```

### 10.3 更新・デプロイメント

#### 10.3.1 リリース管理
```typescript
interface ReleaseManagement {
  // リリースタイプ
  releaseTypes: {
    patch: {
      cadence: 'As needed for bug fixes';
      approval: 'Automated testing + code review';
      rollout: 'Immediate full rollout';
      rollback: 'Automatic on failure detection';
    };
    
    minor: {
      cadence: 'Monthly feature releases';
      approval: 'Extended testing + stakeholder review';
      rollout: 'Staged rollout over 7 days';
      rollback: 'Manual rollback capability';
    };
    
    major: {
      cadence: 'Quarterly major releases';
      approval: 'Full QA cycle + beta testing';
      rollout: 'Staged rollout over 14 days';
      rollback: 'Data migration rollback plan';
    };
  };
  
  // 品質ゲート
  qualityGates: {
    automated: [
      'Unit tests (>80% coverage)',
      'Integration tests',
      'Security scans',
      'Performance benchmarks',
      'Accessibility compliance'
    ];
    
    manual: [
      'User acceptance testing',
      'Cross-browser compatibility',
      'Security review',
      'Documentation review'
    ];
  };
  
  // ロールアウト戦略
  rolloutStrategy: {
    stages: [
      'Internal testing (1% of users)',
      'Beta channel (5% of users)',
      'Gradual rollout (25%, 50%, 75%)',
      'Full rollout (100%)'
    ];
    
    monitoring: [
      'Error rate monitoring',
      'Performance impact assessment',
      'User feedback collection',
      'Support ticket analysis'
    ];
    
    rollbackTriggers: [
      'Error rate > 10%',
      'Performance degradation > 20%',
      'Security vulnerability discovered',
      'Critical user feedback'
    ];
  };
}
```

---

## 11. 付録

### 11.1 用語集

| 用語 | 定義 |
|------|------|
| Chrome Extensions API | Chromeブラウザに拡張機能を追加するためのAPI |
| Manifest V3 | Chrome拡張機能の最新仕様バージョン |
| Service Worker | バックグラウンドで動作するワーカースレッド |
| Content Script | Webページのコンテキストで実行されるスクリプト |
| エコーAPI | 送信されたリクエスト内容をそのまま返すAPI |
| プリリクエストスクリプト | HTTPリクエスト送信前に実行されるJavaScript |
| テストスクリプト | HTTPレスポンス受信後に実行される検証用JavaScript |
| コレクション | 関連するHTTPリクエストをグループ化したもの |
| 環境 | 変数の集合で、開発・ステージング・本番などを表現 |
| シナリオ | 複数のリクエストを順次実行するワークフロー |

### 11.2 参考資料

#### 11.2.1 技術仕様
- [Chrome Extensions API Documentation](https://developer.chrome.com/docs/extensions/)
- [Manifest V3 Migration Guide](https://developer.chrome.com/docs/extensions/migrating/)
- [Web Crypto API Specification](https://www.w3.org/TR/WebCryptoAPI/)
- [JSONPath Specification](https://goessner.net/articles/JsonPath/)

#### 11.2.2 セキュリティ標準
- [OWASP Web Application Security Guide](https://owasp.org/www-project-web-security-testing-guide/)
- [Content Security Policy Level 3](https://www.w3.org/TR/CSP3/)
- [Web Application Security Best Practices](https://developer.mozilla.org/en-US/docs/Web/Security)

#### 11.2.3 アクセシビリティ
- [Web Content Accessibility Guidelines (WCAG) 2.1](https://www.w3.org/WAI/WCAG21/quickref/)
- [ARIA Authoring Practices Guide](https://www.w3.org/WAI/ARIA/apg/)

### 11.3 更新履歴

| 日付 | バージョン | 更新内容 | 更新者 |
|------|-----------|----------|--------|
| 2025-01-10 | 1.0 | 初版作成 | Claude Code |

---

**この外部設計文書は、PostPro API Tester Chrome拡張機能の外部インターフェース、API設計、データベース設計、セキュリティ設計を包括的に定義したものです。システム全体の構造を理解し、外部システムとの連携を適切に設計するための詳細な仕様書として活用してください。**